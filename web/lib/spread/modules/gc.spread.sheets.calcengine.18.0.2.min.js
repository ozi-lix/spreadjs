/*!
 * 
 * SpreadJS Library 18.0.2
 *
 * Copyright(c) MESCIUS inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License.
 * us.sales@mescius.com
 * https://developer.mescius.com/spreadjs
 *
 */
var GC;!function(){"use strict";var i,e,n;function r(n){var t,t,t=e[n];return void 0!==t||(t=e[n]={exports:{}},i[n].call(t.exports,t,t.exports,r)),t.exports}i={"./dist/plugins/sheetsCalc/calc-extra-save.js":function(n,t,i){var a,u,r,s,c,l,h,v,d;function e(f,o,u){for(var s,n,t,n=function(n){var t,n,r,i,e,t=o[n];if(t.l)for(n=w(t.k),r=f.oT(n[1],n[2],!0),t.v&&f.nbt(r),t.b,r.aT=t.l.map(function(n){return parseInt(n,10)}),i=function(n){var e=t.l[n];r[e]=(0,a.createMap)(),null!=(s=t[e])&&s.map(function(n){var t,i,i,t=w(n),i=t[0];"?"!==i[0]&&"!"!==i[0]||(i=i.slice(1)),i=u[i],r[e].set(n,i.oT(t[1],t[2],!0))})},e=0;e<t.l.length;e++)i(e)},t=0;t<o.length;t++)n(t)}function w(n){return n.split(",").map(function(n,t){return n=0<t?parseInt(n,10):n})}function f(n,t,i){var e,r,f,o,u,s,a,c,l,c,e=n.uT(!0);for(r in t.l)if(t.l.hasOwnProperty(r))for(o in f=t[r])if(f.hasOwnProperty(o))for(u=o.split(",").map(function(n,t){return"?"!==n[0]&&"!"!==n[0]||(n=n.slice(1)),parseInt(n,10)}),s=0;s<f[o].length;s++)c=(l=i[c="?"!==(c=(a=w(f[o][s]))[0])[0]&&"!"!==c[0]?c:c.slice(1)]).oT(a[1],a[2],!0),e.processListener(parseInt(r,10),u[0],u[1],u[2],u[3],c,!0)}function o(n){}function m(n,t){var i,e,r,f,o,u,i={};if(t&&t.idMap){for(f in r={},e=n.rO)e.hasOwnProperty(f)&&(r[e[f].getSource().getName()]=e[f]);for(f in o=t.idMap)o.hasOwnProperty(f)&&(u=o[f],i[f]=r[u])}return i}function C(n){var t,i,e,t=n.rO,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e].getSource().getName());return i}function p(n,t){return _(n,t)}function _(n,t){var i,e,r,f,o,o,o,i=n.t;if(4===i||2===i||3===i||8===i||100===i)(e=new a.Expression(i)).value=n.v;else{if(5===i)(e=new a.Expression(5)).value=a.CalcError.ibt(n.v);else if(6===i)(e=new a.Expression(6)).value=new a.CalcArray(n.v);else if(9===i)e=(0,a.rbt)(n.o,_(n.v,t),n.w&&_(n.w,t));else if(10===i)(e=new a.Expression(10)).value=_(n.v,t);else if(11===i)e=new a.Expression(11);else if(7===i)for(e=new a.Expression(7),n.f&&(e.function=_(n,t)),n.n&&(e.function=t.getFunction(n.n),e.functionName=n.n),r=e.arguments=[],f=0;f<n.p.length;f++)n.p[f]&&(r[f]=_(n.p[f],t));else 1===i?(e=new a.ReferenceExpression(1),(o=n.v.split("*"))[0]&&(e.source=t.getExternalSource("",o[0])),o[1]&&(e.endSource=t.getExternalSource("",o[1])),o[2]&&(e.row=parseInt(o[2],10)),o[3]&&(e.column=parseInt(o[3],10)),o[4]&&(e.endRow=parseInt(o[4],10)),o[5]&&(e.endColumn=parseInt(o[5],10)),o=parseInt(o[6],10),e.rowRelative=!!(o&s),e.columnRelative=!!(o&c),e.endRowRelative=!!(o&l),e.endColumnRelative=!!(o&h),e.isFullRow=!!(o&v),e.isFullColumn=!!(o&d),e.isFullRow&&(e.column=e.endColumn=a.BAND_INDEX_CONST),e.isFullColumn&&(e.row=e.endRow=a.BAND_INDEX_CONST)):13===i?(e=new u.obt,o=n.v,e.abt=o[0],e.source=o[1],e.ubt=o[2],e.sbt=o[3],e.lbt=o[6],e.hbt=o[7],e.source=t.getExternalSource("",e.source),e.abt=t.getTableByName(e.abt)):e&&e.type;n.es&&(e.ensureSingle=!0)}return e}function g(n){return b(n)}function b(n){var t,i,e,e;if(!n)return n;if(t={t:n.type},n.ensureSingle&&(t.es=1),4===n.type||2===n.type||3===n.type||8===n.type||100===n.type)t.v=n.value;else if(5===n.type)t.v=n.value._code;else if(6===n.type)t.v=n.value.array;else if(9===n.type)t.o=n.operatorType,t.v=b(n.value),t.w=n.value2&&b(n.value2);else if(10===n.type)t.v=b(n.value);else if(7===n.type)for((0,a.isExpression)(n.function)?t.f=b(n.function):n.functionName&&(t.n=n.functionName),t.p=[],i=0;i<n.arguments.length;i++)t.p[i]=b(n.arguments[i]);else 1===n.type?(e=(n.rowRelative&&s)|(n.columnRelative&&c)|(n.endRowRelative&&l)|(n.endColumnRelative&&h)|(n.isFullRow&&v)|(n.isFullColumn&&d),e=[n.source&&n.source.getName(),n.endSource&&n.endSource.getName(),n.row,n.column,n.endRow,n.endColumn,e],n.isFullRow&&(e[3]=e[5]=r),n.isFullColumn&&(e[2]=e[4]=r),t.v=e.join("*")):13===n.type?t.v=[n.abt.name(),n.source.getName(),n.ubt,n.sbt,0,0,n.lbt,n.hbt]:n.type;return t}Object.defineProperty(t,"__esModule",{value:!0}),t.exprToJSON=t.exprFromJSON=t.dbt=t.vbt=t.mbt=t.gbt=t.pbt=void 0,a=i("CalcEngine"),u=i("./dist/plugins/sheetsCalc/parser-sheets.js"),r=null,s=1,c=2,l=4,h=8,v=16,d=32,t.pbt=e,t.gbt=f,t.mbt=o,t.vbt=m,t.dbt=C,t.exprFromJSON=p,t.exprToJSON=g},"./dist/plugins/sheetsCalc/calc-spreadjs.js":function(N,n,t){var i,P,e,b,g,H,m,q,k,F,s,y,T,V,$,Y,L,X,x,B,z,W,K,Q,I,R,A,O,E,M,j,a,t,t,r,S,u,c,D,J,G,f,r,U,o,l,Z,nn;function h(n,t,i,e,r,f,o){var u=this;u.Zc=n,u.FY=i,u.jpt=e,u.WK=t,B(r)||(u.TZ=r),u.Ale="boolean"==typeof f&&f,u.DJ=o}function v(n,t,i,e,r,f,o){var n,e,n=U.call(this,n,e,r,f,o)||this,e=n;return e.bbt=t,e.ybt=i,n}function tn(n){var t=o.call(this,V)||this;return t.references=n,t}function d(n,t,i,e){var r,t,f,o;for(void 0===e&&(e={}),r=l.call(this,n&&n.Uw(e.sheetArea),t,i,e)||this,n||(n=d.wbt=d.wbt||new P.Worksheet,r.source)||(r.source=n.Uw(e.sheetArea)),r.Mf=n,r.row=i&&i.row||0,r.column=i&&i.col||0,f=(t=n.getCalcService()).getResolvers(),o=0;o<f.length;o++)if(f[o]instanceof g.SheetReferenceResolver)return r;return t.addResolver(new g.SheetReferenceResolver),t.addResolver(new g.StructureReferenceResolver),r}function w(n){this.Xur=n,this.GOi()}function C(n,t,i){var i=Z.call(this,i)||this;return i.getCalcSourceModel=function(){return this.Mbt},i.createSourceModel=function(n){var n=new H.CalcSourceModel(n,this);return n.usedRange=new P.BaseUsedRange,n},i.getRangeKey=function(n,t){return n.id+","+t.row+","+t.col+","+t.rowCount+","+t.colCount},i.getSheetRangeReference=function(n){var t,t,i,e,r,f,o,t=this.Mf,t=t&&t.parent;if(n.endSource&&t&&t.sheets&&n.endSource instanceof C){for(i=t.sheets,e=!1,r=void 0,f=[],o=0;o<i.length;o++){if((r=i[o].Uw())===this)e=!0;else if(r===n.endSource){f.push(r.getReference(n));break}e&&f.push(r.getReference(n))}return new u(f)}},i.Mf=n,i.t8=new k.Z8(i),i.nT=t||3,i}function p(n){var t=nn.call(this,V)||this;return t.createSourceModel=function(n){return new H.CalcSourceModel(n,this)},t.vpt=n,t.Cbt={},t}function en(n,t,i,e,r,f){var n,o,n,n=n&&n instanceof P.Worksheet&&n,o=new H.Parser;return i=i===$?0:i,e=e===$?0:e,n=new c(n,!!r,(0,H.eV)(i,e)),f&&(n.culture=!0),o.parse(n,t)}function rn(n,t,i,e,r,f){var n,o,r,n=n&&n instanceof P.Worksheet&&n,o=new H.Parser;return i=i===$?0:i,e=e===$?0:e,(r=new c(n,!!r,(0,H.eV)(i,e))).Sbt=f,r.Eme=n&&n.Dhe,o.unparse(r,t)}function fn(n,t,i,e,r){var f;return on(n,en(n,t,i=i===$?0:i,e=e===$?0:e,r,!0),i,e)}function on(n,t,i,e,r){var f,o,n,f=n.op();return i===$&&(i=n.getActiveRowIndex()),e===$&&(e=n.getActiveColumnIndex()),o=!0,r&&r.convertNullToZero!==$&&(o=r.convertNullToZero),n=n.Uw(r&&r.sheetArea),f.evaluateParsedFormula(n,t,(0,H.eV)(i,e),!1,o)}function un(n,t,i,e,r){var f,o,r,n,f=n.op();return i===$&&(i=n.getActiveRowIndex()),e===$&&(e=n.getActiveColumnIndex()),o=!0,r&&r.convertNullToZero!==$&&(o=r.convertNullToZero),r=n.Uw(),(n=(0,H.eV)(i,e)).Tbt=Math.random().toString(36).substring(2),f.Abt(r,t,n,o)}function _(n,t,i,e,r){var f,o,u,s,a,c,l,h,v,d,w,f=n.row,o=n.col,u=n.row+n.rowCount-1,s=n.col+n.colCount-1,a=!1,c=!1,l=!1,h=!1;return 4<=arguments.length&&(f-=(a=0!=(1&e))?t:0,u-=(c=0!=(4&e))?t:0,o-=(l=0!=(2&e))?i:0,s-=(h=0!=(8&e))?i:0),r&&(d=an(n,r,t),w=cn(n,r,t),d)&&w?g.StructureReferenceResolver.create(r,d,w,n.col-r.dataRange().col,n.col+n.colCount-r.dataRange().col-1):1===n.rowCount&&1===n.colCount?(0,H.knt)(V,V,f,o,a,l):(n.row<0&&(f=u=m.BAND_INDEX_CONST),n.col<0&&(o=s=m.BAND_INDEX_CONST),(0,H.lJ)(V,V,f,o,u,s,a,l,c,h,t,i))}function sn(n){return 0<=n.indexOf("[")&&1<n.indexOf("]")}function an(n,t,i){if(1===n.rowCount){if(t.hasHeadersRow()&&n.row===t.startRow())return 2;if(t.hasTotalsRow()&&n.row===t.endRow())return 8;if(i===n.row)return 1}else{if(t.hasHeadersRow()&&n.row===t.startRow()){if(n.rowCount===t.dataRange().rowCount+1)return 6;if(t.hasTotalsRow()&&n.rowCount===t.dataRange().rowCount+1+1)return 14}if(n.row===t.dataRange().row){if(n.rowCount===t.dataRange().rowCount)return 3;if(t.hasTotalsRow()&&n.rowCount===t.dataRange().rowCount+1)return 12}}return $}function cn(n,t,i){return n.col===t.startColumn()&&n.colCount===t.dataRange().colCount?1:1===n.colCount?2:n.col>=t.startColumn()&&n.col+n.colCount-1<=t.endColumn()?4:$}function ln(n,t,i,e,r){var n,e,f,r,n=_(n,t,i,e),e=new c(V,!!r,(0,H.eV)(t,i)),f,r=(new H.Parser).unparse(e,n);return e.L0(),r}function hn(n,t,i,e,r,f,o){var t,r,u,t=_(t,i,e,r,o),r=new c(n,!!f,(0,H.eV)(i,e)),u;return(new H.Parser).unparse(r,t)}function vn(n,t,i){if(!n)return!1;var e=!1,r=!1;if(1===t.rowCount){if(n.hasHeadersRow()&&t.row===n.startRow())return!0;if(n.hasTotalsRow()&&t.row===n.endRow())return!0;if(t.row===i&&t.col>=n.startColumn()&&t.col+t.colCount<=n.startColumn()+n.dataRange().colCount)return!0}else n.hasHeadersRow()&&t.row===n.startRow()&&(t.rowCount===n.dataRange().rowCount+1&&(e=!0),n.hasTotalsRow())&&t.rowCount===n.dataRange().rowCount+1+1&&(e=!0),t.row===n.dataRange().row&&(t.rowCount===n.dataRange().rowCount&&(e=!0),n.hasTotalsRow())&&t.rowCount===n.dataRange().rowCount+1&&(e=!0);return t.col+t.colCount<=n.startColumn()+n.dataRange().colCount&&(r=!0),e&&r}function dn(n,t,i,e,r){var f,t,o,u,s,a,c,l,h,s,a;if(!t)return null;if(i=i||0,e=e||0,u=!1,(t=(f=n.op()).parse(n.Uw(),t,i,e,!0,!0))&&(7===t.type&&"ANCHORARRAY"===t.functionName&&(t=t.arguments[0],u=!0),!(o=t.source)||13!==t.type)&&1===t.type&&t.endSource){for(s=t.source,a=t.endSource,c=s.getSources(a),l=!1,h=0;h<c.length;h++)if(c[h]===n.Uw()){l=!0;break}t=l&&t}return t&&t.getRange&&(!o||o===n.Uw())&&(s=t.getRange(i,e,$,r))?(u&&(a=new H.CalcReference(n.qgt,[s]).getSpillRef())&&a.$gt&&(s=a.$gt[0]),new P.Range(s.row,s.col,s.rowCount,s.colCount)):null}function wn(n,t,i,e,r,f,o){var u,s,a,c,l,o,h,v,d,w,m,C,p,_,u=[],s=[];if(t)if(i=i||0,e=e||0,o)try{a=en(n,t,i,e),(c=n.Lp.evaluateExpression(n.qgt,a,{row:i,col:e},!1,!0))&&c.$gt&&(c.$gt.forEach(function(n){s.push(new P.Range(n.row,n.col,n.rowCount,n.colCount))}),u.push({sheetName:c.rT.getName(),ranges:s}))}catch(n){}else for(l={},o=new H.Parser,h=g.Vgt(o,t,n,i,e,$,r,f),v=0;v<h.length;v++)if((d=h[v].sheetRanges)&&!T(d))for(w=0;w<d.sheets.length;w++)for(m=d.sheets[w],(s=l[m])||(l[m]=s=[],u.push({sheetName:m,ranges:s})),C=d[m],p=0;p<C.length;p++)_=C[p],B(_)||s.push(new P.Range(_.row,_.col,_.rowCount,_.colCount));return u}function mn(n,t,i,e,r){var f,r,f,f=new H.Parser,r=new c(V,!!r,(0,H.eV)(t,i)),f=Cn(f,r,n,t,i,e);return r.L0(),f}function Cn(n,t,i,e,r,f,o){for(var u,s,a,a,c,u="",s=0;s<i.length;s++)a=_(i[s],e,r,f),a=n.unparse(t,a),u+=0<s?(c=o&&b.Common.CultureManager.Fe().NumberFormat.listSeparator||",")+" "+a:a;return u}function pn(t,i,e,r,f,o,u,n){var s,a,c,n,l,h,v,d,w,m,C,p,_,g,s=(n=n||{}).maximumIterations||100,a=n.tolerance||.001,c=function(n){return t.setValue(i,e,n),r.mL(f,o,$,$,{realValue:!0})},n=function(n){var t=(R(n)?+n:0)-u;return R(n)&&Math.abs(t)<a};if(t.suspendPaint(),t.suspendEvent(),l=r.mL(i,e,$,$,{realValue:!0}),C=!1,p=.01,v=R(l)?+l:0,h=r.mL(f,o,$,$,{realValue:!0}),w=(R(h)?+h:0)-u,R(h)&&Math.abs(w)<a)C=!0;else if(x(h))C=!1;else for(d=v+(0===v?p:p*v),_=0;!C&&_<s;_++)h=c(d=b.Common.st.E8(d,13)),m=(R(h)?+h:0)-u,R(h)&&Math.abs(m)<a?C=!0:d=x(h)?(v+d)/2:v-d==0?v+(0===v?p:p*v):w-m==0?v+2*(d-v):(g=d-m*(v-d)/(w-m),v=d,w=m,g);return(C=C||_n(c,n,l,u))||t.setValue(i,e,l),t.resumeEvent(),t.resumePaint(),C}function _n(n,t,i,e){var i,r,f,o,u,s,a,a,i=gn(n,i),r=i.find,f=i.left,o=i.right;if(r)for(u=0;u<100;){if(t(a=n(s=(f+o)/2)))return!0;a=a-e,(n(f)-e)*a<0?o=s:(n(o)-e)*a<0&&(f=s),u++}return!1}function gn(n,t){var i,e,r,f,o,u,i=-1e6,e=1e6,r=1e-5,f=t;return R(n(t))?{find:!0,left:o=bn(n,i,f,r),right:u=yn(n,f,e,r)}:{find:!1,left:0,right:0}}function bn(n,t,i,e){for(var r,f,r=0;r<100;){if(i-t<=e)return i;R(n(f=(i+t)/2))?i=f:t=f,r++}}function yn(n,t,i,e){for(var r,f,r=0;r<100;){if(i-t<=e)return t;R(n(f=(i+t)/2))?t=f:i=f,r++}}i=this&&this.__extends||(f=function(n,t){return(f=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,t){n.__proto__=t}:function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}))(n,t)},function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=n}f(n,t),n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Object.defineProperty(n,"__esModule",{value:!0}),n.goalSeek=n.RangeReferenceRelative=n.Ibt=n.rangesToFormula=n.formulaToRanges=n.formulaToRange=n.isStructureReference=n.rangeToFormulaWithStructReference=n.rangeToFormula=n.isValidExternalReference=n.rangeToExpression=n.xbt=n.evaluateExpression=n.evaluateFormula=n.expressionToFormula=n.formulaToExpression=n.SpreadSource=n.SheetSource=n.SheetParserContext=n.SheetRangeReference=n.FormatterNameInfo=n.NameInfo=n.ReferenceStyle=void 0,P=t("Core"),e=t("Core"),b=t("Common"),g=t("./dist/plugins/sheetsCalc/parser-sheets.js"),H=t("CalcEngine"),m=t("./dist/plugins/sheetsCalc/calc.ns.js"),q=t("./dist/plugins/sheetsCalc/calc-extra-save.js"),k=t("./dist/plugins/sheetsCalc/dynamic-array.js"),F=b.Common.lt,s=b.Common.zf,y=F.Dh,T=F._h,V=null,$=void 0,(Y=["v","n","s","b","d","sn"])[11]="an",L=H.Errors.Value,X=b.Formatter&&b.Formatter.GeneralFormatter,x=H.Convert.BJ,B=F.ht,z=P.mt.xr,W=P.range_parser.jc,K=P.mt.vo,Q=P.Util.addXLFNPrefix,I=b.Common.rbush,R=function(n){return H.Convert.q8(n,!0)},A=P.Range.prototype.contains,O=s.Gmt,E="number",M=P.UsedRangeUtil.updateUsedRangeByData,j="__hyperlink__",a={},(t=H.CalcSource.prototype).referenceToArray=function(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,s=this,l=1,h=1,m=[],w=n.getRangeCount();if(0===w)m.isError=!0;else{for(_=s.getRowCount(),g=s.getColumnCount(),i=i===$||i,b=0;b<w;b++){if(i||m.push(p=[]),0===(l=n.getRowCount(b)))return m.isError=!0,m;if(0===(h=n.getColumnCount(b)))return m.isError=!0,m;if(v=n.getRow(b),d=n.getColumn(b),2!==i){if(_<=v||g<=d)return(m=[V]).rowCount=1,m.colCount=1,m.rangeCount=1,m;g<d+h&&(h=g-d)}for(_<v+l&&(l=_-v),y=void 0,x=0;x<l;x++)for(a=v+x,i||p.push(y=[]),R=0;R<h;R++){if(C=s.getValue(a,c=d+R),e&&H.Convert.BJ(C))return(m=[C]).isError=!0,m;if(C=H.Convert.Nbt(C,t,!H.ExcelCompatibleCalcMode,f,u),r&&C===H.Convert.CalcConvertedError)return(m=[L]).isConvertError=!0,m;C===V&&f||(2===i?m[x*h+R]=C:(i?m:y).push(C))}}(m=i||1!==w?m:m[0]).rowCount=l,m.colCount=h,m.rangeCount=w}return m},t.getSheetReference=function(){var n=this;return n.kbt=n.kbt||new H.CalcReference(n),n.kbt},(r=t=n.ReferenceStyle||(n.ReferenceStyle={}))[r.a1=0]="a1",r[r.r1c1=1]="r1c1",e.ReferenceStyle=t,h.prototype.getName=function(){return this.Zc},h.prototype.set=function(n,t,i,e,r){this.DJ.dBe(this.Zc,n,t,i,e,r),this.TZ=r},h.prototype.btV=function(n){this.Zc=n},h.prototype.getRow=function(){return this.FY},h.prototype.getColumn=function(){return this.jpt},h.prototype.getExpression=function(){return this.WK},h.prototype.getComment=function(){return this.TZ},h.prototype.X_r=function(n){this.TZ=n},h.prototype.SB=function(n,t,i,e,r){t&&t.push({type:"customName",nameInfo:this,expr:this.WK}),this.WK=n,B(i)||(this.FY=i),B(e)||(this.jpt=e),null!=r&&r.ignoreModelChange||this.DJ.q_r(this)},h.prototype.isReadOnly=function(n){return"boolean"==typeof n&&(this.Ale=n),this.Ale},n.NameInfo=r=h,e.NameInfo=r,i(v,U=r),v.prototype.getFormatter=function(){return this.bbt},v.prototype.getSheetTabName=function(){return this.ybt},n.FormatterNameInfo=v,H.CalcSource.prototype.createSourceModel=function(n){return new H.CalcSourceModel(n,this)},o=H.CalcReference,i(tn,o),tn.prototype.toArray=function(n,t,i,e,r){for(var f,o,u,s,f=this.references,o=[],u=0;u<f.length;u++){if((s=f[u].rT.referenceToArray(f[u],n,t,i,e,r)).isError&&i)return s;t?Array.prototype.push.apply(o,s):o.push(s),u||(o.rowCount=s.rowCount,o.colCount=s.colCount)}return o.rangeCount=f.length,o},u=tn,n.SheetRangeReference=u,l=H.ParserContext,i(d,l),d.prototype.getExternalSource=function(n,t){var i,e,r,f,o,u,i=this,e=i.Mf.parent,r=i.Mf.Uw();if(n&&(!e||e.name!==n))return V;if(!e)return s.Dbt(i.Mf.name(),t)?r:V;if(sn(t))return e._p.parseSource(t,r.G3);if((f=e.sheets)&&0<f.length)for(o=0;o<f.length;o++)if(u=f[o],s.Dbt(u.name(),t))return u.Uw();return H.ParserContext.prototype.getExternalSource.call(this,n,t)},d.prototype.getExternalSourceToken=function(n){return n.getName(this)},d.prototype.getTableByName=function(n){var t,i,e,r,f,t=this.Mf.tables,i=!0,e=t?t._bt(n,!0):V;if(!e&&(r=this.Mf.parent&&this.Mf.parent.sheets))for(f=0;f<r.length&&(!(t=r[f].tables)||!(e=t._bt(n,!0)));f++);return e||this.Mf.parent&&this.Mf.parent.Ofe(n)},d.prototype.getTableByIndex=function(n,t){var i=this.Mf.tables;return i?i.Hq(n,t,!0):V},d.prototype.setSource=function(n){var n=this.source=n;n&&n.getSheet&&(this.Mf=n.getSheet())},d.prototype.L0=function(){this.Mf&&this.Mf!==d.wbt&&this.Mf.L0(),this.Mf=V},c=d,n.SheetParserContext=c,w.prototype.Oy=function(){return 0===this.qur.data.length},w.prototype.GOi=function(){var t,n,n,t=this,n=null==(n=this.Xur.Mf)?void 0:n.tables;this.qur=new I,n&&(n.all().forEach(function(n){n.$ur(t.qur)}),this.Oy())&&(this.qur=$),this.rsr=!0},w.prototype.osr=function(n,t,i,e,r){var f,o,u,f,o=this.qur;o&&(a.minX=n,a.minY=t,a.maxX=n+i-1,a.maxY=t+e-1,(u=o.search(a)).forEach(function(n){r(n.expr,n.nodes)}))},w.prototype.o_t=function(t,n,i,e){var r,f,o;void 0===i&&(i=1),void 0===e&&(e=1),(f=(r=this).qur)&&(a.minX=t,a.minY=n,a.maxX=t+i-1,a.maxY=n+e-1,(o=f.search(a)).forEach(function(n){n.currentRow?n.nodes.forEach(function(n){n.row>=t&&t+i>n.row&&n.vyt()}):n.nodes.forEach(function(n){n.vyt()})}))},w.prototype.J_t=function(t){var n,n,n=null==(n=this.Xur.Mf)?void 0:n.tables;this.qur&&n&&n.all().forEach(function(n){var n;null!=(n=n.aT)&&n.forEach(function(n){n.forEach(function(n){n&&n.w3&&n.w3!==t&&n.vyt&&n.vyt()})})})},w.prototype.a_t=function(i,n,t){var e,r,f,o,e,r=this.qur;r&&(f=t?1:-1,a.minX=a.maxX=i,a.minY=a.maxY=n,(o=r.search(a)).forEach(function(t){var n;t.currentRow?t.bUr?null!=(n=t.bUr[i])&&n.forEach(function(n){n.row===i&&(n.delay+=f)}):(t.bUr={},t.nodes.forEach(function(n){n.row===i&&(n.delay+=f),t.bUr[n.row]=t.bUr[n.row]||[],t.bUr[n.row].push(n)})):t.nodes.forEach(function(n){n.delay+=f})}))},D=w,Z=H.CalcSource,i(C,Z),C.prototype.getReferenceSheetNames=function(){return this.Ebt||{}},C.prototype.addReferenceSheetName=function(n){var t=this;t.Ebt||(t.Ebt={}),t.Ebt[n]=1},C.prototype.setReferenceSheetNames=function(n){this.Ebt=n},C.prototype.startCalculation=function(){this.jbt,this.Obt(),this.K5=[]},C.prototype.endCalculation=function(n){this.jbt=V,this.Rbt=V,!1!==n&&this.Bbt(),this.K5=V},C.prototype.ggr=function(n,t){n?(this.mgr||(this.mgr=this.jbt,this.wgr=this.Rbt),this.startCalculation()):(this.endCalculation(t),this.jbt=this.mgr,this.mgr=null,this.Rbt=this.wgr,this.wgr=null)},C.prototype._F=function(){var n=this;n.Fbt?n.K5&&(n.Pbt=n.Pbt.concat(n.K5),n.K5=[]):(n.Pbt=n.K5||[],n.Fbt=setTimeout(function(){n.Bbt(n.Pbt),delete n.Pbt,delete n.Fbt},0))},C.prototype.Bbt=function(n){var t,i,i,n,e,t,n=n||this.K5;n&&0<n.length&&(t=null==(t=(e=this.Mf).Ut)?void 0:t.W_(3).B8,!e.Ut||null!=(i=null==(i=e.parent)?void 0:i.Lp)&&i.lb||e.ki(P.Events.RangeChanged,{isUndo:!B(t&&t.vE),sheet:e,sheetName:e.name(),row:0,col:0,rowCount:e.getRowCount(),colCount:e.getColumnCount(),changedCells:n,action:6},e.QI))},C.prototype.clearValueCache=function(){this.Obt()},C.prototype.Obt=function(){var n=this.getRowCount(),t=this.getColumnCount();this.jbt={rowCount:n,colCount:t},this.Rbt={arrayInfo:[]}},C.prototype.Gw=function(){this.jbt=V,this.Rbt=V,this.K5=V},C.prototype.getValue=function(n,t){for(var i,e,r,f,o,u,s,n,a,c,l,h,v,d,w,i=[],e=2;e<arguments.length;e++)i[e-2]=arguments[e];if(f=(r=this).Mf,typeof n==E)o=n,u=arguments[1],t=arguments[2],s=arguments[3];else if(n.row!==$)o=n.row,u=n.col;else if(n.name)return null;return n=r.nT,o<0||u<0?L:f.Gbt&&f.Ubt===o&&f.Hbt===u?f.zbt:(a=r.jbt,c=Y[t=t||0],a?(l=a.rowCount,h=a.colCount,w=d=v=void 0,l<=o||h<=u?V:((w=(d=(d=(v=(v=a[o])||(a[o]={}))[u])||(v[u]={v:s?f.getValueIgnoreDefault(o,u,n,$,!0):r.Mf.mL(o,u,n,$,{realValue:!0})}))[c])===$&&(w=H.Convert.Nbt(d.v,t,!H.ExcelCompatibleCalcMode),d[c]=w),P.mt.V0(w))):o>=r.getRowCount()||u>=r.getColumnCount()?V:s?r.Mf.getValueIgnoreDefault(o,u,n,$,!0):r.Mf.mL(o,u,n,$,{realValue:!0}))},C.prototype.getIdentity=function(n,t){var i,e,r,f,t,i=this,e=t.row,r=t.rowCount||1,f=t.column,t=t.columnCount||1;return-1===e&&(e=0,r=i.getRowCount()),-1===f&&(f=0,t=i.getColumnCount()),i.getName()+"."+e+"."+r+"."+f+"."+t},C.prototype.getReference=function(n){var t=this,i=n.row,e=n.col;return-1===i&&(n.row=0,n.rowCount=t.getRowCount(),n.rowUndefine=!0),-1===e&&(n.col=0,n.colCount=t.getColumnCount(),n.colUndefine=!0),new H.CalcReference(t,[n])},C.prototype.getSources=function(n){var t,i,e,r,f;if(this.Mf&&this.Mf.parent&&this.Mf.parent.sheets&&n instanceof C){for(t=this.Mf.parent.sheets,i=!1,e=void 0,r=[],f=0;f<t.length;f++){if((e=t[f].Uw())===this&&(i=!0),e===n){r.push(e);break}i&&r.push(e)}return r}},C.prototype.Vbt=function(e,r){var n,f,o,u,n,f=this.Rbt,o=f&&f.arrayInfo;o&&(u=!1,o.forEach(function(n,t){var i,n;n&&(i=n.reference,n=n.key,A.call(i.$gt[0],e,r))&&(delete f[n],o[t]=$,u=!0)}),u)&&(f.arrayInfo=[],o.forEach(function(n){n&&f.arrayInfo.push(n)}))},C.prototype.referenceToArray=function(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,j,N,k,I,A,O,E,M,S,D,h=l=1,m=[],_=(s=this).Mf,g=s.jbt,b=s.Rbt,R=Y[t=t||0];if(0===(w=n.getRangeCount()))m.isError=!0;else{if(b&&(C=b[x=n.getRangeCount()+"_"+n.getRow(0)+"_"+n.getColumn(0)+"_"+n.getRowCount(0)+"_"+n.getColumnCount(0)+"_"+t+"_"+i]))return C;for(j=this.getRowCount(),N=this.getColumnCount(),i=i===$||i,k=0;k<w;k++){if(i||m.push(p=[]),0===(l=n.getRowCount(k)))return m.isError=!0,m;if(0===(h=n.getColumnCount(k)))return m.isError=!0,m;if(v=n.getRow(k),d=n.getColumn(k),2!==i){if(j<=v||N<=d)return(m=i?[V]:[[V]]).rowCount=1,m.colCount=1,m.rangeCount=1,m;N<d+h&&(h=N-d)}for(j<v+l&&(l=j-v),A=I=void 0,O=_.Gbt,E=0;E<l;E++)for(a=v+E,i||p.push(I=[]),g&&(g[a]||(g[a]={}),y=g[a]),M=0;M<h;M++){if(c=d+M,O&&_.Ubt===a&&_.Hbt===c)C=_.zbt,O=!1;else{if(g?(A=y[c])?C=A.v:(C=_.mL(a,c,s.nT,$,{realValue:!0}),A=y[c]={v:C}):C=_.mL(a,c,s.nT,$,{realValue:!0}),o&&(D=void 0,"@"===(D=(S=_.getFormatter())instanceof X?S.formatString():S)?C=_.getText(a,c):C instanceof Date&&(C=F.uJ(C)),T(A)||(A=y[c]={v:C})),e&&H.Convert.BJ(C))return(m=[C]).isError=!0,m;if(A&&A[R]!==$)C=A[R];else{if(C=H.Convert.Nbt(C,t,!H.ExcelCompatibleCalcMode,f,u),r&&H.Convert.CalcConvertedError===C)return(m=[L]).isConvertError=!0,m;A&&(A[R]=C)}}H.Convert.Ybt(C,f)||(2===i?m[E*h+M]=C:(i?m:I).push(C))}}(m=i||1!==w?m:m[0]).rowCount=l,m.colCount=h,m.rangeCount=w,b&&(n.Zbt&&b.arrayInfo.length<200||!isNaN(w)&&!isNaN(l)&&!isNaN(h)&&100<w*l*h&&w*l*h<1e6&&b.arrayInfo.length<50)&&(b[x]=m,b[x].rowCount=l,b[x].colCount=h,b[x].rangeCount=w,b.arrayInfo.push({reference:n,key:x}))}return m},C.prototype.getColumnCount=function(){var n=this.Mf;return n.xT?0:n.getColumnCount(this.nT)},C.prototype.getRowCount=function(){var n=this.Mf;return n.xT?0:n.getRowCount(this.nT)},C.prototype.isHiddenRow=function(n,t){var i=this.Mf,e;return!!(i.iA&&i.iA()||!t)&&0===i.getRowHeight(n)},C.prototype.getName=function(){var n,t,n=this.nT,t=B(this.Wbt)?this.Mf.name():this.Wbt;return n===P.SheetArea.colHeader?t+"CH":n===P.SheetArea.rowHeader?t+"RH":t},C.prototype.setArray=function(n,t,i,e,r){return this.t8.setArray(n,t,i,e,r)},C.prototype.updateItem=function(n,t,i){return this.t8.updateItem(this,n,t)},C.prototype.HE=function(n,t){this.t8.HE(n,t)},C.prototype.setValue=function(n,t,i,e,r,f){var o,u,s,a,c,l,h,h,l,v,d,d,w,m,w,d,m,C,a,a,C,p,_,o=this,u=o.Mf,s=o.nT,a=o.jbt;a&&(l=a[n])&&(h=l[t])&&(!B(i)&&B(i[j])?(h.v=i,c=!0,h.b!==$&&(h.b=$),h.d!==$&&(h.d=$),h.n!==$&&(h.n=$),h.s!==$&&(h.s=$),h.sn=$,h.an=$):delete l[t]),h=P.mt.Z0(i),l=u.Ut,v=!1,d=(d=u.tables)&&d.find(n,t),3===s&&d&&(w=d.showHeader()&&n===d.headerIndex(),m=d.showFooter()&&n===d.footerIndex(),w||m||(v=d.Kbt(n,t,h))),w=u.H3,3===s&&!v&&w&&w._dataSource&&(m=!1,(d=w.getValue(n,t)).hasBinding&&(C=void 0,C=a?(C=(a=a.bindingRows=a.bindingRows||{})[n])||(a[n]=y({},u.getDataItem(n))):y({},u.getDataItem(n)),l.dE(n,t,{gE:C,d6:d.value}),m=w.setValue(n,t,h,l.G8)),v="dataManagerBindingSource"===w.K$?m:d.hasBinding),a=u.pivotTables,3===s&&!v&&a&&(v=a.eJt(n,t,h)),o.j5e&&!f&&c?o.j5e[_=s+" "+n+" "+t]=[n,t,s,h]:(v||(!B(h)&&h[j]&&(C=h[j],l.setHyperlink&&l.do("setHyperlink",n,t,p={url:C}),h=h.toString()),l.do("setValue",n,t,h,s,!0,!0,r,!0,!0)),u.iL=!0,this.K5?this.K5.push({row:n,col:t,sheetArea:s}):u.ki(P.Events.CellChanged,{sheet:u,sheetName:u.name(),row:n,col:t,sheetArea:s,propertyName:"value",oldValue:e,newValue:i,KO:!0}))},C.prototype.startIterativeCalc=function(){this.j5e={}},C.prototype.endIterativeCalc=function(){var n,t,i,e,r,f,o,u,r,s,a,n=this,t=n.Mf,i=t.Ut;for(e in n.j5e)Object.prototype.hasOwnProperty.call(n.j5e,e)&&(f=(r=n.j5e[e])[3],o=r[0],u=r[1],r=r[2],!B(f)&&f[j]&&(s=f[j],i.setHyperlink&&i.do("setHyperlink",o,u,a={url:s}),f=f.toString()),i.do("setValue",o,u,f,r,!0,!0,!1,!0,!0),t.iL=!0,this.K5?this.K5.push({row:o,col:u,sheetArea:r}):t.ki(P.Events.CellChanged,{sheet:t,sheetName:t.name(),row:o,col:u,sheetArea:r,propertyName:"value",KO:!0}));delete n.j5e},C.prototype.getCustomFunction=function(n){return this.Mf?this.Mf.Jbt(n):V},C.prototype.getCustomName=function(n){var n=this.getCustomNameInfo(n);return n?n.getExpression():V},C.prototype.getCustomNameInfo=function(n){return n=O(n),this.Mf?this.Mf.getCustomName(n):V},C.prototype.getSheet=function(){return this.Mf},C.prototype.setFormula=function(n,t,i,e,r,f){var o,u,s,a,c,u,c,a,o=this;if(o.Mf.Ut.G8&&(a=o.Mf.Ut.G8.formulas,s=o.getCalcSourceModel(),a=a||(o.Mf.Ut.G8.formulas={}),-1<=n)&&-1<=t){if((c=o.getCalcService()).backupR1C1Formula&&(u=o.Mbt.pB(n,t),i=rn(o.Mf,u,n,t,!0,!1)),!e&&c.allowDynamicArray&&(e=o.Mbt.sT(n,t)),u=(u=a[n])||(a[n]={}),i&&"="===i[0]&&(i=i.substring(1)),c=u[t]&&u[t].formula,r)return void(u[t]&&void 0!==u[t].oldFormula||(e=y({},e),u[t]=y({},u[t],{oldFormula:i,oldArrayInfo:e}),i)||delete u[t].oldArrayInfo);u[t]=y({},u[t],{formula:i,arrayInfo:e}),i||delete u[t].arrayInfo,s.usedRange&&M(s.usedRange,n,t,c,i)}!r&&o.LGr(n,t,f)&&(a=null!=i?i:V,o.$Dr(n,t,a,e))},C.prototype.isFormulaHidden=function(n,t){var i,e,i,r,f,i=this,e;return!!(i.getCalcSourceModel().getFormula(n,t)&&(i=i.Mf)&&(r=i.isActualProtected())&&(f=i.l0(n,t,"hidden")))},C.prototype.setArrayFormula=function(n,t,i,e,r){var f;this.setFormula(n,t,r,{row:n,col:t,rowCount:i,colCount:e})},C.prototype.setFormulaByName=function(n,t,i){var e,r,e,e=this;e.Mf.Ut.G8&&((e=(e=(r=(r=e.Mf.Ut.G8.formulas)||(e.Mf.Ut.G8.formulas={})).names)||(r.names={}))[n]=y({},e[n],{formula:t,oldFormula:i}))},C.prototype.refresh=function(){var n=this.Mf.parent;n&&n.repaint()},C.prototype.toJSON=function(n,t,i,e,r,f){var o,u,s,a,c,l,t,h,v,d,w,m,C,p,_,g,b,y,l,x,R,j,N,k,I,A,O,E,M,M,S,u=t,t=this.Mf,h=n.data||{},v=!0,d=this.op(),w=this===t.qgt,p=0;for(w&&(m=(0,H.createMap)(),t.Xbt=C={}),_=d.forceR1C1Formula&&!t.isReportTemplateSheet,g=0;g<=i;g++)if(o=h.dataTable||{},s=u[g]){for(v=!(c=o[g]),c=c||{},b=0;b<=e;b++)if(y=(a=s[b])&&a.WK,l=a&&a.calc&&a.calc.isDefault(),x=!1===(null==f?void 0:f.Moo),a&&!l&&(y||a.qbt)){l=c[b]||{};try{j=R=void 0,w&&y&&!a.$bt&&!x&&(N=y.tyt=y.tyt||d.unparse(this,y,g,b,$,2)).indexOf("!")<0&&(!(k=m.get(N))||k.baseColumn>b?_?(j=N,m.set(N,{formula:j,baseRow:g,baseColumn:b})):(j=d.unparse(this,a.WK,g,b,!1,!0)).indexOf("[")<0&&m.set(N,{formula:j,baseRow:g,baseColumn:b}):(R=k.obj)?((A=C[R.si]).lastRow=g,A.lastColumn=Math.max(b,A.lastColumn)):(R=k.obj={si:p},C[p]={formula:k.formula,baseRow:k.baseRow,baseColumn:k.baseColumn,lastRow:g,lastColumn:b},(I=g===k.baseRow?c:o[k.baseRow])[k.baseColumn].formula=k.obj,p++)),j=a.qbt||R||j||d.unparse(this,y,g,b,!1,_?2:1),a.$bt?a.$bt.row===g&&a.$bt.col===b&&(l.arrayInfo=a.$bt,l.formula=j):l.formula=j,v=!1,c[b]=l}catch(n){}}if(v){if(o!==h.dataTable)continue}else o[g]=c;h.dataTable=o}if(C&&(C.nextIndex=p),r){for(O=h.columnDataArray||[],E=0;E<r.length;E++)(M=r[E])&&M.WK&&(M=this.op().unparse(this,M.WK,0,E,!1,!0),(S=O[E]||{}).formula=M,O[E]=S);0<O.length&&(h.columnDataArray=O)}T(h)||(n.data=h)},C.prototype.asr=function(){return this.usr=this.usr||new D(this),this.usr.rsr||this.usr.GOi(),this.usr},C.prototype.ssr=function(){this.usr&&(this.usr.rsr=!1)},C.prototype.wh=function(n,T,V,Y,L,t){var e,i,r,f,o,u,s,a,X,c,l,h,v,d,J,w,m,C,p,_,g,G,U,b,y,x,R,j,N,k,I,A,O,E,M,S,D,F,e=z(n,P.XFileConstants.bo),i=this.op();for(i.nyt=!0,s=P.Util.ko(t),h=0,(X=this===(a=this.Mf).qgt)&&(c=(0,H.createMap)(),a.Xbt=l={}),v=n.lossless.exprs=[],d=s&&(null==t?void 0:t.saveR1C1Formula)&&!a.isReportTemplateSheet,J=!s&&!1===(null==t?void 0:t.exportSharedFormula),w=[],n.richValueDataArray=[],m=0;m<=V;m++)if(r=T[m],o=e[m],r)for(o=o||(e[m]={}),C=0;C<=Y;C++)if(f=r[C],u=o[C],p=f&&f.WK,g=!(_=[]),G=f&&f.calc&&f.calc.isDefault(),f&&!G&&p){u=u||{},s||7!==p.type||"IMAGE"!==p.functionName||(g=!0,3<(U=p.arguments).length&&(_=p.arguments.splice(5)));try{x=y=b=void 0,R=-1,(j=f.$bt)||(N=this.t8.Hme(m,C))&&(j={row:m,rowCount:N.maxX-m+1,col:C,colCount:N.maxY-C+1,isDynamicArray:!0},N.isValid||(j.isInvalid=!0)),X&&!j&&!J&&(k=p.tyt=p.tyt||i.unparse(this,p,m,C,$,2),s||k.indexOf("!")<0)&&(!(I=c.get(k))||I.baseColumn>C?d?(y=k,c.set(k,{formula:y,baseRow:m,baseColumn:C})):(y=i.unparse(this,p,m,C,$,1)).indexOf("[")<0&&c.set(k,{formula:y,baseRow:m,baseColumn:C}):((b=I.obj)?((A=l[b.si]).lastRow=m,A.lastColumn=Math.max(C,A.lastColumn)):(b=I.obj={si:h},l[h]={formula:I.formula,baseRow:I.baseRow,baseColumn:I.baseColumn,lastRow:m,lastColumn:C},h++),x=b.si,y=void 0)),B(x)&&(y=f.qbt||y||i.unparse(this,p,m,C,!1,d?2:1),t&&t.includeCalcModelCache&&(O=(0,q.exprToJSON)(p),f.eyt||(O.nw=1),v.push(O),R=v.length-1),y=K(Q(y))),j?(j.row===m&&j.col===C&&(E=W(j),(j.isInvalid||!j.rowCount)&&0<E.indexOf(":")&&(E=E.substring(0,E.indexOf(":"))),u.f=y,u.r=E),j.isDynamicArray&&(u.a="1",j.isInvalid||t.fileType!==P.OpenSaveFileType.excel||w.push(j))):(u.f=y,u.g=x,u.c=1,g&&(M=u.v&&u.v.value.imageBase64Data,B(M)||(S={url:p.arguments[0]&&p.arguments[0].value,ref:P.IndexHelper.nr(C)+(m+1),f:y,structureMap:{}},p.arguments[1]&&!B(p.arguments[1].value)&&(S.structureMap.a=p.arguments[1].value),p.arguments[2]&&!B(p.arguments[2].value)&&(S.structureMap.s=p.arguments[2].value),p.arguments[3]&&!B(p.arguments[3].value)&&(S.structureMap.h=p.arguments[3].value),p.arguments[4]&&!B(p.arguments[4].value)&&(S.structureMap.w=p.arguments[4].value),S.imageBase64Data=M,n.richValueDataArray.push(S)),u.v="#VALUE!",u.t="e")),-1!==R&&(u.x=R)}catch(n){}g&&0<_.length&&(p.arguments=p.arguments.concat(_)),o[C]=u}for(D in l)Object.prototype.hasOwnProperty.call(l,D)&&(F=l[D],E=W(new P.Range(F.baseRow,F.baseColumn,F.lastRow-F.baseRow+1,F.lastColumn-F.baseColumn+1)),(u=e[F.baseRow][F.baseColumn]).r=E,u.g=parseInt(D,10));w.forEach(function(n){for(var t,i,t=n.row;t<n.row+n.rowCount;t++)for(i=n.col;i<n.col+n.colCount;i++)(u=e[t]&&e[t][i])&&(u.t2=!0)}),delete i.nyt},C.prototype.LGr=function(n,t,i){return!(n<0||t<0)&&i!==m.SetFormulaTrigger.addDelRowCol},C.prototype.$Dr=function(n,t,i,e){var r,f,r=this,f=r.getCalcService();!e&&f.allowDynamicArray&&(e=r.Mbt.sT(n,t)),r.Mf.$Dr({type:"setRange",setType:"formula",sheetArea:r.nT,row:n,col:t,data:{formula:i,arrayInfo:e},sheet:r.Mf})},(n.SheetSource=J=C).prototype.getParserContext=function(n,t,i){return t=t||(0,H.eV)(0,0),new c(this.Mf,n,t,i)},nn=H.CalcSource,i(p,nn),p.prototype.addUsedCustomName=function(n){this.Cbt[n]=1},p.prototype.getUsedCustomNames=function(){return this.Cbt||{}},p.prototype.getCustomFunction=function(n){return this.vpt?this.vpt.getCustomFunction(n):V},p.prototype.getCustomName=function(n){var n=this.getCustomNameInfo(n);return n?n.getExpression():V},p.prototype.getCustomNameInfo=function(n){return this.vpt?this.vpt.getCustomName(n)||this.vpt.xO(n):V},n.SpreadSource=p,n.formulaToExpression=en,n.expressionToFormula=rn,n.evaluateFormula=fn,n.evaluateExpression=on,n.xbt=un,n.rangeToExpression=_,n.isValidExternalReference=sn,n.rangeToFormula=ln,n.rangeToFormulaWithStructReference=hn,n.isStructureReference=vn,n.formulaToRange=dn,n.formulaToRanges=wn,n.rangesToFormula=mn,n.Ibt=Cn,n.RangeReferenceRelative={allAbsolute:0,startRowRelative:1,startColRelative:2,endRowRelative:4,endColRelative:8,rowRelative:5,colRelative:10,allRelative:15},n.goalSeek=pn},"./dist/plugins/sheetsCalc/calc.ns.js":function(n,t,i){var i,e,i;Object.defineProperty(t,"__esModule",{value:!0}),t.SetFormulaTrigger=t.MAX_COLUMN_COUNT=t.MAX_ROW_COUNT=t.BAND_INDEX_CONST=void 0,i=i("Core"),t.BAND_INDEX_CONST=-2147483648,t.MAX_ROW_COUNT=i.XmlConstants.Io,t.MAX_COLUMN_COUNT=i.XmlConstants.xo,(i=e=t.SetFormulaTrigger||(t.SetFormulaTrigger={})).normal="normal",i.addDelRowCol="addDelRowCol"},"./dist/plugins/sheetsCalc/dynamic-array.js":function(n,t,i){var w,e,v,d,r,m,C,f;function a(n){return n.isValid}function o(n){return{row:n.minX,col:n.minY,rowCount:n.maxX-n.minX+1,colCount:n.maxY-n.minY+1,isValid:n.isValid}}function u(n){this.zme=new e.Common.rbush,this.rT=n}Object.defineProperty(t,"__esModule",{value:!0}),t.Z8=void 0,w=i("Core"),e=i("Common"),v=i("CalcEngine"),d=i("CalcEngine"),r=null,m=void 0,C=e.Common.lt.ht,u.prototype.Vme=function(){return this.rT.Mf.Ut},u.prototype.L0=function(){this.rT=r,this.zme=r},u.prototype.Ume=function(){var n=this.zme.data;if(n&&isFinite(n.minX))return{minRow:n.minX,minCol:n.minY,maxRow:n.maxX,maxCol:n.maxY}},u.prototype.Rme=function(n,t,i,e){return this.zme.search({minX:n,minY:t,maxX:n+(i=void 0===i?1:i)-1,maxY:t+(e=void 0===e?1:e)-1})},u.prototype.Hme=function(t,i){return this.Rme(t,i).filter(function(n){return n.minX===t&&n.minY===i})[0]},u.prototype.Yme=function(n,t){return this.Rme(n,t).filter(a)[0]},u.prototype.Zme=function(){var n,n,n=this.Vme();return n.G8?(n.G8.calc=n.G8.calc||[],(n=n.G8.calc).Wme=n.Wme||[],n.Wme):[]},u.prototype.Fgt=function(t,i,e,r){var f,o,u,n,s,f=this;void 0===e&&(e=1),void 0===r&&(r=1),o=this.Rme(t,i,e,r),u=this,n=o.filter(function(n){return n.minX>=t&&n.minX<t+e&&n.minY>=i&&n.minY<i+r}),s=this.b3(),n.forEach(function(n){n.isValid&&s.gF(n.minX,n.minY,n.maxX-n.minX+1,n.maxY-n.minY+1),u.Fme(n),u.Pme(n,!0)}),o.filter(a).forEach(function(n){u.Fme(n),o=o.concat(f.Rme(n.minX,n.minY,n.maxX-n.minX+1,n.maxY-n.minY+1))}),o.forEach(function(n){n.isValid||(u.Qme(n.minX,n.minY,n.maxX-n.minX+1,n.maxY-n.minY+1)?s.gF(n.minX,n.minY,n.maxX-n.minX+1,n.maxY-n.minY+1):s.gF(n.minX,n.minY,1,1))})},u.prototype.getAnchorCell=function(t,i){var n=this.Rme(t,i).filter(function(n){return n.minX===t&&n.minY===i})[0];return n&&o(n)},u.prototype.getAnchorInfo=function(t,i,n){var e,e,e=this.Rme(t,i),e=e.filter(function(n){return n.minX===t&&n.minY===i})[0]||e.filter(a)[0];return e&&o(e)},u.prototype.setValue=function(n,t,i,e){e?this.Vme().setValue(n,t,i,3,!0,!0,!1,!1,!0):this.pBt().setValue(n,t,i)},u.prototype.b3=function(){return this.rT.Mbt},u.prototype.pBt=function(){return this.rT},u.prototype.Fme=function(n,t,i,e){var r,f;if(n){if(n.isValid){for(r=n.minX;r<=n.maxX;r++)for(f=n.minY+(r===n.minX?1:0);f<=n.maxY;f++)this.setValue(r,f,m,i);n.isValid=!1,i&&this.Zme().push([n,"isValid",!0]),t||this.setValue(n.minX,n.minY,d.Errors.Spill,i)}t&&(this.Pme(n,i),e||this.setValue(n.minX,n.minY,m,i))}},u.prototype.Pme=function(n,t){this.zme.remove(n),t&&this.Zme().push([n])},u.prototype.removeAnchor=function(n,t){for(var i,e,r,i=this.Rme(n,t),e=0;e<i.length;e++)(r=i[e]).minX===n&&r.minY===t&&this.Pme(r,!0)},u.prototype.Gme=function(n,t){this.zme.insert(n),t&&this.Zme().push([m,n])},u.prototype.HE=function(n,t){this.Hme(n,t).isValid=!1},u.prototype.Qme=function(n,t,i,e,r){for(var f,o,u,s,a,c,l,c,h,v,d,f=this.zme.search({minX:n,minY:t,maxX:n+i-1,maxY:t+e-1}),o=this.pBt(),u=this.b3(),s=0;s<f.length;s++)if((a=f[s]).isValid&&(a.minX!==n||a.minY!==t))return!1;if(t+e>o.getColumnCount()||n+i>o.getRowCount())return!1;if(c=(0,w.Ec)(n,t,i,e),(l=o.Mf).Ut.getSpans(c).length)return!1;if((c=l.tables)&&c.Pl&&c.Pl(n,t,i,e))return!1;for(h=n;h<n+i;h++)for(v=t+(h!==n||r?0:1);v<t+e;v++)if(d=o.getValue(h,v,m,!0),!C(d)||u.hasFormula(h,v,!0))return!1;return!0},u.prototype.xji=function(n,t,i,e,r){var f;this.zme.insert({minX:n,minY:t,maxX:n+(i=void 0===i?1:i)-1,maxY:t+(e=void 0===e?1:e)-1,isValid:r})},u.prototype.setArray=function(n,t,i,e,r,f,o){var u,s,a,u,s,c,l,h,a=this,u=null==(u=a.rT)?void 0:u.Mf;if(null==(s=null==u?void 0:u.czr)||!s.call(u)){if((s=this.Hme(n,t))&&s.maxX===n+i-1&&s.maxY===t+e-1&&s.isValid||(a.Fme(s,!0,o),s={minX:n,minY:t,maxX:n+i-1,maxY:t+e-1,isValid:!0},f||(s.isValid=a.Qme(n,t,i,e)),a.Gme(s,o)),s.isValid)for(c=n;c<n+i;c++)for(l=t;l<t+e;l++)r&&r[c-n]&&(h=r[c-n][l-t],C(h)?h=0:(v.Convert.Nh(h)||v.Convert.LE(h))&&(h=1===h.getRowCount()&&1===h.getColumnCount()?v.Convert.Nh(h)?h.getValue(0,0):h.getValue(0,0,0):d.Errors.Calc),this.setValue(c,l,h,o));else this.setValue(n,t,d.Errors.Spill,o);return s.isValid}},u.prototype.updateItem=function(n,t,i){var t=this.Hme(t,i);if(t)return this.Fme(t,!0),!0},u.prototype.rE=function(e,r){var f=this,n;f.Rme(e,-1,v.MAX_ROW_COUNT,-1).forEach(function(n){var t,i;if(n.minX>=e)f.zme.remove(n),n.minX+=r,n.maxX+=r,f.zme.insert(n);else if(n.maxX>=e)if(n.isValid){for(t=e;t<=n.maxX;t++)for(i=n.minY;i<=n.maxY;i++)f.pBt().setValue(t,i,f.pBt().getValue(t+r,i));for(t=n.maxX+1;t<=n.maxX+r;t++)for(i=n.minY;i<=n.maxY;i++)f.pBt().setValue(t,i,m)}else f.b3().Mde(n.minX,n.minY)})},u.prototype.aE=function(f,o,u){var s=this,n;s.Rme(f,-1,v.MAX_ROW_COUNT,-1).forEach(function(n){var t,i,e,r;if(n.minX>=f+o)s.zme.remove(n),n.minX-=o,n.maxX-=o,s.zme.insert(n);else if(n.minX>=f)s.Fme(n,!0,u);else if(n.maxX>=f&&n.isValid)if(t=n.maxX>f+o-1?n.maxX+1:f+o,i=n.maxX>f+o-1?o:n.maxX-f+1,s.Qme(t,n.minY,i,n.maxY-n.minY+1,!0))for(e=n.maxX;f<=e;e--)for(r=n.minY;r<=n.maxY;r++)s.setValue(e+o,r,s.pBt().getValue(e,r),u);else s.Fme(n,!1,u)})},u.prototype.Lme=function(t,i){var e=this,n;e.Rme(t,-1,v.MAX_ROW_COUNT,-1).forEach(function(n){n.minX>=t&&(e.zme.remove(n),n.minX+=i,n.maxX+=i,e.zme.insert(n))})},u.prototype.oE=function(e,r){var f=this,n;this.Rme(-1,e,-1,v.MAX_COLUMN_COUNT).forEach(function(n){var t,i;if(n.minY>=e)f.zme.remove(n),n.minY+=r,n.maxY+=r,f.zme.insert(n);else if(n.maxY>=e)if(n.isValid){for(t=n.minX;t<=n.maxX;t++)for(i=e;i<=n.maxY;i++)f.pBt().setValue(t,i,f.pBt().getValue(t,i+r));for(t=n.minX;t<=n.maxX;t++)for(i=n.maxY+1;i<=n.maxY+r;i++)f.pBt().setValue(t,i,m)}else f.b3().Mde(n.minX,n.minY)})},u.prototype.uE=function(f,o,u){var s=this,n;this.Rme(-1,f,-1,v.MAX_COLUMN_COUNT).forEach(function(n){var t,i,e,r;if(n.minY>=f+o)s.zme.remove(n),n.minY-=o,n.maxY-=o,s.zme.insert(n);else if(n.minY>=f)s.Fme(n,!0,u);else if(n.maxY>=f&&n.isValid)if(t=n.maxY>f+o-1?n.maxY+1:f+o,i=n.maxY>f+o-1?o:n.maxY-f+1,s.Qme(n.minX,t,n.maxX-n.minX+1,i,!0))for(e=n.minX;e<=n.maxX;e++)for(r=n.maxY;f<=r;r--)s.setValue(e,r+o,s.pBt().getValue(e,r),u);else s.Fme(n,!1,u)})},u.prototype.Bme=function(t,i){var e=this,n;this.Rme(-1,t,-1,v.MAX_COLUMN_COUNT).forEach(function(n){n.minY>=t&&(e.zme.remove(n),n.minY+=i,n.maxY+=i,e.zme.insert(n))})},u.prototype.Kme=function(n){for(var t,i,e,r,e,t=this,i=n.length-1;0<=i;i--)r=(e=n[i])[0],2<e.length?r[e[1]]=e[2]:1<e.length?t.zme.remove(e[1]):(e=t.Hme(r.minX,r.minY),t.Fme(e,!0),t.zme.insert(r))},t.Z8=u},"./dist/plugins/sheetsCalc/external-reference.js":function(n,t,i){var e,j,l,M,o,i,N,k,S,D,I,h,A,O,f,r,u,s;function v(n,t){var i,e;if(Array.isArray(n))n.forEach(t);else if("object"==typeof n)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&t(e=n[i],i)}function d(n){return n}function a(n){return"string"==typeof n&&"/OADate("===n.substr(0,8)?parseFloat(n.substr(8,n.length-10)):n}function w(n){var n,t,n=n.value;return n&&n.richText?(t="",n.richText.forEach(function(n){t+=n.text}),t):a(n)}function c(n,t,i){var e,n,r,i,e=s.call(this,D)||this;return e.getSheetRangeReference=function(n){var t,i,e,r,f,t=this.rT.sheetNames;if(n.endSource&&t&&n.source instanceof c){for(i=!1,e=[],r=0;r<t.length&&((i=t[r]===n.source.oyt?!0:i)&&(f=new c("["+this.rT.i+"]"+t[r],this.ayt,!0),e.push(f.getReference(n))),t[r]!==n.endSource.oyt);r++);return new o.SheetRangeReference(e)}return M.Errors.Name},n=n.split("]"),i&&(r=n[0].substring(1)),t.iyt[r]?e.rT=t.iyt[r]:(i=n[0].indexOf("["),e.rT=t.ryt(n[0].substring(i+1),n[0].substring(0,i),!0)),e.oyt=n[1],e.ayt=t,e}function m(n,t){var i,e,r;if(n)for(i in n)I(n,i)&&(r=(e=n[i]).getExpression())&&r.forEachNodes(function(n){(1===n.type||5===n.type||8===n.type)&&n.source instanceof f&&(t[n.source.rT.i]=!0)})}function C(n,t){var t=n.getRange(t.row,t.column);return t.sheetName=n.source.oyt,t}function p(n){this.iyt=n||{},this.uyt={},this.syt()}e=this&&this.__extends||(u=function(n,t){return(u=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,t){n.__proto__=t}:function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}))(n,t)},function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=n}u(n,t),n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalReferenceManager=t.ExternalSource=void 0,j=i("Core"),l=i("Common"),M=i("CalcEngine"),o=i("./dist/plugins/sheetsCalc/calc-spreadjs.js"),i=l.Common.lt,N=j.XFileConstants.Rr,k=j.XFileConstants.Lr,S=void 0,D=null,I=l.Common.kh,h=i.ht,A=j.Util.wr,O=j.Util.Mr,s=M.CalcSource,e(c,s),c.prototype.cyt=function(n,t,i){var e,r,e=n.getKey();this.rT=this.ayt.fyt(this.rT),this.ime(),r=this.ayt.uyt[this.rT.i]=this.ayt.uyt[this.rT.i]||{},t?r[e]?r[e][1].push(i):r[e]=[n,[i]]:r[e]&&delete r[e]},c.prototype.ime=function(){this.rT.data=this.rT.data||{};var n=this.rT.data[this.oyt];return n||(this.rT.sheetNames.push(this.oyt),n=this.rT.data[this.oyt]={isNew:!0}),n},c.prototype.getValue=function(n,t){var i,n,i,i=this.ime(),n=i[n];return!n||h(n[t])?!i.isNew||n&&n.hasOwnProperty(t)?0:M.Errors.Reference:(i=n[t])&&i._code&&(i._error||i._calcError)?new M.CalcError(i._error||i._calcError):i},c.prototype.getRowCount=function(){return M.MAX_ROW_COUNT},c.prototype.getColumnCount=function(){return M.MAX_COLUMN_COUNT},c.prototype.createSourceModel=function(){return D},c.prototype.getCalcSourceModel=function(){return D},c.prototype.setCalcSourceModel=function(){},c.prototype.getPeerSource=function(n){return new c("["+this.rT.i+"]"+n,this.ayt,!0)},c.prototype.getSources=function(n){var t,i,e,r,f,t=this.rT.sheetNames,i=[];if(n&&t&&n.oyt)for(e=!1,r=0;r<t.length&&((e=t[r]===this.oyt?!0:e)&&(f=new c("["+this.rT.i+"]"+t[r],this.ayt,!0),i.push(f)),t[r]!==n.oyt);r++);return i},c.prototype.referenceToArray=function(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,j,N,k,I,A,O,E,s=this,l=1,h=1,m=[],_=s.rT.Rbt,g=s.oyt+n.getRangeCount()+"_"+n.getRow(0)+"_"+n.getColumn(0)+"_"+n.getRowCount(0)+"_"+n.getColumnCount(0)+"_"+t+"_"+i;if(_){if(_.has(g))return _.get(g)}else _=s.rT.Rbt=(0,M.createMap)();if(0===(w=n.getRangeCount()))m.isError=!0;else{for(x in b=-1,y=s.ime())y.hasOwnProperty(x)&&(R=Number(x),!isNaN(R))&&b<R&&(b=R);if(-1===b)(m=[M.Errors.Reference]).isError=!0;else{for(j=b+1,N=s.getColumnCount(),i=i===S||i,k=0;k<w;k++){if(i||m.push(p=[]),v=n.getRow(k),d=n.getColumn(k),0===(l=n.getRowCount(k)))return m.isError=!0,m;if(-1===l&&(v=0,l=j),0===(h=n.getColumnCount(k)))return m.isError=!0,m;if(-1===h&&(d=0,h=N),j<=v||N<=d)return(m=i?[D]:[[D]]).rowCount=1,m.colCount=1,m.rangeCount=1,m;for(j<v+l&&(l=j-v),N<d+h&&(h=N-d),I=void 0,A=!1,O=0;O<l;O++)for(a=v+O,i||p.push(I=[]),E=0;E<h;E++)C=s.getValue(a,c=d+E),A||(C=M.Convert.Nbt(C,t,!M.ExcelCompatibleCalcMode,f,u),e&&M.Convert.BJ(C)&&(A=(m=[C]).isError=!0),M.Convert.Ybt(C,f))||(i?m:I).push(C);if(A)return m}(m=i||1!==w?m:m[0]).rowCount=l,m.colCount=h,m.rangeCount=w,_&&_.set(g,m)}}return m},c.prototype.getName=function(n){var n,n=this.Dfe?"":this.ayt.uyt[this.rT.i]&&(!this.rT||n&&n.lyt)?"[".concat(this.rT.i,"]"):"".concat(this.rT.option.path,"[").concat(this.rT.option.name,"]");return n+this.oyt},c.prototype.getIdentity=function(n,t){var i,e,r,f,t,i=this,e=t.row,r=t.rowCount||1,f=t.column,t=t.columnCount||1;return-1===e&&(e=0,r=i.getRowCount()),-1===f&&(f=0,t=i.getColumnCount()),i.getName(n)+"."+e+"."+r+"."+f+"."+t},c.prototype.getReference=function(n){var t=this,i=n.row,e=n.col;return-1===i&&(n.row=0,n.rowCount=t.getRowCount(),n.rowUndefine=!0),-1===e&&(n.col=0,n.colCount=t.getColumnCount(),n.colUndefine=!0),new M.CalcReference(t,[n])},f=c,t.ExternalSource=f,p.prototype.parseSource=function(n,t){return new f(n,this,t)},p.prototype.ryt=function(n,t,i,e){var r,f;for(r in this.iyt)if(I(this.iyt,r)&&(f=this.iyt[r])&&f.option.name===n&&f.option.path===t)return f;if(!i)for(r in this.iyt)if(I(this.iyt,r)&&(f=this.iyt[r]).option.name===n&&""===t)return f;return e?S:{option:{name:n,path:t},sheetNames:[],data:{}}},p.prototype.syt=function(){for(var n in this.iyt)this.iyt[n]&&(this.iyt[n].i=n)},p.prototype.fyt=function(n){var t,t,t=this.ryt(n.option.name,n.option.path,!0,!0);return t||(t=Object.keys(this.iyt).length+1,(this.iyt[t]=n).i=t,n)},p.prototype.Ep=function(n){var t,i,e,r,f,o,i={},e={},r=1;for(f in this.iyt)I(this.iyt,f)&&(this.uyt[f]&&!j.GC$.isEmptyObject(this.uyt[f])||(t||(t={},m(n.hyt,t),n.sheets.forEach(function(n){m(n.hyt,t)})),t[f]))&&(i[(o=this.iyt[f]).i=r]=o,e[r]=this.uyt[f],r++);this.iyt=i,this.uyt=e},p.prototype.toJSON=function(){var n,t,i,n={};for(t in this.iyt)I(this.iyt,t)&&(i=this.iyt[t],n[t]={option:{name:i.option.name,path:i.option.path},sheetNames:i.sheetNames,data:i.data});return n},p.prototype.wh=function(n){var g,b,t,y,x,R,i,e,g=this.iyt,b=[],t={n_:"externalReferences",c_:b},y={},x=n.workbook.rels,R=0,i=function(n){var t,i,e,n,r,f,o,u,s,a,c,l,h,v,d,w,m,C,p,_;if(I(g,n)){for(R++,i=(t=g[n]).option.id=N+A(x),x.c_.push({n_:k,Id:i,Type:j.RelationshipConstants.uc,Target:O(j.XFileConstants.nu+"/"+j.XFileConstants.tu+n)}),b.push({n_:"externalReference","r:id":i}),n={n_:"sheetNames",c_:e=[]},r={n_:"sheetDataSet",c_:[]},(f=t.sheetNames)&&f.forEach(function(n){e.push({n_:"sheetName",val:j.mt.Nfe(n)})}),o=t.data,u=0,s=f.length;u<s;u++)if(a=o&&o[f[u]]){for(h in c={n_:j.XFileConstants.bo,sheetId:u},a.isNew&&(c.refreshError=1),l=[],a)if(a.hasOwnProperty(h)&&(v=parseInt(h,10)+1,!isNaN(v))){for(C in m={n_:"row",r:v,c_:w=[]},d=a[h])d.hasOwnProperty(C)&&(p=d[C],(_={n_:"cell"}).r=j.IndexHelper.nr(parseInt(C,10))+v,"string"==typeof p?_.t="str":"boolean"==typeof p?(_.t="b",p=p?"1":"0"):p&&p.code&&(_.t="e","#SPILL!"!==(p=p._calcError||p.error)&&"#CALC!"!==p||(p="#VALUE!")),_.c_=[{n_:"v",c_:[p]}],w.push(_));l.push(m)}c.c_=l,r.c_.push(c)}y[i]={n_:"externalLink",r_:[13,14,1,21],c_:[{n_:"externalBook","r:id":"rId1",r_:[8],c_:[n,0<r.c_.length?r:D]}],option:t.option}}};for(e in g)i(e);return{externalReferencesNode:t,externalLinks:y,count:R}},p.prototype.dyt=function(n,i,t,r){var e,f,o,e,n,u,s,a,c,e=i&&i.sheets&&Object.keys(i.sheets),f=e&&i.sheets[e[0]].data&&i.sheets[e[0]].data.dataTable,o=f?w:d,e=this.ryt(n,t||"",S,!0);if(!h(e)){for(c in n=e.i,delete(u=this.iyt[n]).Rbt,s=this.uyt[n]||{},u.rme=new l.Common.rbush,a=function(n){var t;I(s,n)&&((t=s[n][0]).vyt(),s[n][1].forEach(function(n){var n=n.getRange(t.row,t.column);u.rme.insert({minX:n.row,minY:n.col,maxX:n.row+n.rowCount-1,maxY:n.col+n.colCount-1})}))},s)a(c);u.sheetNames.forEach(function(n){var t,e,t=f?i.sheets[n]&&i.sheets[n].data.dataTable:i&&i[n];t&&(u.data[n]&&r?r&&delete u.data[n].isNew:u.data[n]={},e=u.data[n],v(t,function(n,i){u.rme.collides({minX:i,minY:-1,maxX:i,maxY:-1})&&(e[i]=e[i]||{},v(n,function(n,t){u.rme.collides({minX:i,minY:t,maxX:i,maxY:t})&&(e[i][t]=o(n))}))}))})}},p.prototype._6=function(t,n,i,e){var r,f,r=this;"string"==typeof t?r.dyt(t,n,i,e):t&&(f=r.myt(!0)).forEach(function(n){t[n.filePath+n.name]&&r.dyt(n.name,t[n.filePath+n.name],n.filePath,e)})},p.prototype.myt=function(n){var t,i,e,r,f,o,u,t=[];for(i in this.iyt)if(I(this.iyt,i)){if(e=this.iyt[i],r={name:e.option.name,filePath:e.option.path},n)for(u in f=this.uyt[i]||{},r.items=[],o=function(n){var t,i,n,n;I(f,n)&&(i={row:(t=f[n][0]).row,col:t.column,sheetName:t.w3.rT.getName()},n=1===(n=f[n][1]).length?C(n[0],t):n.map(function(n){return C(n,t)}),r.items.push({target:i,source:n}))},f)o(u);t.push(r)}return t},t.ExternalReferenceManager=p},"./dist/plugins/sheetsCalc/formulaOperatorAdjustor.js":function(f,n,t){var fn,u,on,L,x,un,G,t,N,sn,w,an,cn,C,g,k,I,M,Y,a,i,o,m,t;function c(n,t){var i,e,r,n,i=w(n.row,(t=t||this).row),e=w(n.column,t.column),r=sn(n.row+n.rowCount,t.row+t.rowCount),n=sn(n.column+n.columnCount,t.column+t.columnCount);return r<=i||n<=e?cn:{row:i,column:e,rowCount:r-i,columnCount:n-e,intersectWith:c}}function $(n,i,e){var r=[];return n.forEachNodes&&n.forEachNodes(function(n){var t;1===n.type&&((n.endSource?null:n.source||e)===i?r.push(n):i===e&&((n.rowRelative||n.endRowRelative)&&(r.rc=!0),n.columnRelative||n.endColumnRelative)&&(r.cc=!0))}),r}function B(n,t,i,e){var r,f,o,u,s,a,r=(0,fn.createSet)(),f=(0,fn.createSet)(),o=$(n,t,i);if(e)for(u=o.rc,s=0;s<o.length;s++)(a=o[s]).isFullColumn||((a.rowRelative?r:f).add(a.row),a.endRowRelative?r.add(a.endRow):!1===a.endRowRelative&&f.add(a.endRow));else for(u=o.cc,s=0;s<o.length;s++)(a=o[s]).isFullRow||((a.columnRelative?r:f).add(a.column),a.endColumnRelative?r.add(a.endColumn):!1===a.endColumnRelative&&f.add(a.endColumn));return[Array.from(r),Array.from(f),u]}function v(n,t,i,e,r,f){return n?f?i<=r+t&&r+t<i+e?"2":r+t<i&&i<=r||r<i&&i<=r+t?"1":"0":i+e<=r+t?"1":i<=r+t?"2":"0":i+e<=t?"1":i<=t?"2":"0"}function W(n,t,i,e,r,f,o){var u,s,a,c,l,h,u=[],s=!1;if(f&&(o?n.rc:n.cc)&&(u.push("9"),s=!0),o){for(a=0;a<n.length;a++)if(!(c=n[a]).isFullColumn&&("0"!==(l=v(c.rowRelative,c.row,t,i,e,r))&&(s=!0),u.push(l),!G(c.endRow))){if(h=v(c.endRowRelative,c.endRow,t,i,e,r),"2"===l&&"2"!==h&&c.endRowRelative||"2"!==l&&"2"===h&&c.rowRelative)return-1;"0"!==h&&(s=!0),u.push(h)}}else for(a=0;a<n.length;a++)if(!(c=n[a]).isFullRow&&("0"!==(l=v(c.columnRelative,c.column,t,i,e,r))&&(s=!0),u.push(l),!G(c.endColumn))){if(h=v(c.endColumnRelative,c.endColumn,t,i,e,r),"2"===l&&"2"!==h&&c.endColumnRelative||"2"!==l&&"2"===h&&c.columnRelative)return-1;"0"!==h&&(s=!0),u.push(h)}return s?u.join(","):0}function q(n,t,i,e,r){var f,o,u,s,f=[],o=!1;for(n[2]&&r&&(f.push("9"),o=!0),u=0;u<n[0].length;u++)s=n[0][u],e&&(i+s<t&&t<=i||i<t&&t<=i+s)||!e&&t<=i+s?(f.push("1"),o=!0):f.push("0");for(u=0;u<n[1].length;u++)t<=(s=n[1][u])?(f.push("1"),o=!0):f.push("0");return o?f.join(","):0}function e(n,t,i,e,r,f,o,u){var s=this;s.gyt=n,s.pyt=t,s.byt=i,s.yyt=e,s.wyt=r,s.Myt=f,s.Sx=o,s.Cyt=u}function X(n,t,i,e){return(!e||n<t)&&i}function z(n){return[n.row,n.col,n.rowCount,n.colCount].join(",")}function J(n,t,i,e,r){var t=t.rT.id+" "+i+" "+e;n.set(t,r)}function U(n,t,i,e){var t;if(0!==n.size)return t=t.rT.id+" "+i+" "+e,n.has(t)}function s(n,t){var t=new fn.Expression(t);return t.value=n,t}function r(n,t){if(n){for(;10===n.type||12===n.type;)n=n.value;if(1===n.type||13===n.type)t(n);else if(9===n.type)r(n.value,t),n.value2&&r(n.value2,t);else if(7===n.type)for(var i=0;i<n.arguments.length;i++)r(n.arguments[i],t)}}function hn(n,t,i,e,r){var f,o,f,o,n,f=!n&&G(t),o=!i&&G(e);if(f&&!o&&(t=0),o&&!f&&(e=0),!f||!o)return t instanceof Date&&(t=u.Common.ct.o0(t)),e instanceof Date&&(e=u.Common.ct.o0(e)),f=n&&!r.useValue?s(n,fn.ExpressionType.parentheses):s(t,fn.ExpressionType.number),o=i?s(i,fn.ExpressionType.parentheses):s(e,fn.ExpressionType.number),(n=new fn.Expression(fn.ExpressionType.operator)).operatorType=a(r.option),n.value=o,n.value2=f,n}function vn(n){r(n,function(n){var t,t,t,t,t;1===n.type&&(n.rowRelative&&n.columnRelative||n.endRowRelative&&n.endColumnRelative)&&(t=[n.row,n.column],n.column=t[0],n.row=t[1],t=[n.endColumn,n.endRow],n.endRow=t[0],n.endColumn=t[1],t=[n.columnRelative,n.rowRelative],n.rowRelative=t[0],n.columnRelative=t[1],t=[n.endColumnRelative,n.endRowRelative],n.endRowRelative=t[0],n.endColumnRelative=t[1],t=[n.isFullColumn,n.isFullRow],n.isFullRow=t[0],n.isFullColumn=t[1])})}function ln(){}function K(n,t,i,e,r,f){var o,u,s,a,o={};if(n)if(t)for(s in i.QDt)i.QDt[s]&&((u=i.QDt[s]).id===e.id&&(u.row>=r?u.row+=f:u.row+u.rowCount>r&&(u.rowCount+=f)),o[a=u.id+","+u.row+","+u.col+","+u.rowCount+","+u.colCount]=u);else for(s in i.QDt)i.QDt[s]&&((u=i.QDt[s]).id===e.id&&(u.col>=r?u.col+=f:u.col+u.colCount>r&&(u.colCount+=f)),o[a=u.id+","+u.row+","+u.col+","+u.rowCount+","+u.colCount]=u);else if(t){for(s in i.QDt)if(i.QDt[s]){if((u=i.QDt[s]).id===e.id)if(u.row>=r+f)u.row-=f;else if(u.row>=r){if(!(u.row+u.rowCount>r+f))continue;u.row=r,u.rowCount=u.row+u.rowCount-f-r}else u.row+u.rowCount>r+f?u.rowCount-=f:u.row+u.rowCount>r&&(u.rowCount=r-u.row);o[a=u.id+","+u.row+","+u.col+","+u.rowCount+","+u.colCount]=u}}else for(s in i.QDt)if(i.QDt[s]){if((u=i.QDt[s]).id===e.id)if(u.col>=r+f)u.col-=f;else if(u.col>=r){if(!(u.col+u.colCount>r+f))continue;u.col=r,u.colCount=u.col+u.colCount-f-r}else u.col+u.colCount>r+f?u.colCount-=f:u.col+u.colCount>r&&(u.colCount=r-u.col);o[a=u.id+","+u.row+","+u.col+","+u.rowCount+","+u.colCount]=u}i.QDt=o}function A(n,t,i,e,r,f,o,u,s,a,c,l){var h,v,d,n;return 0<=i||!r?(h=e+(r?i:0),v=f+(o?i:0),d=c&&p(u,n,c),n=!c&&p(u,n,c),l&&-1===f?r?s+a<=h&&s<=i&&i<s+a?i-s+s+a<=h&&(h+=a):s<=h&&!(s<=i&&i<s+a)&&(h+=a):s<=h&&(h+=a):((d||n)&&(!l&&s+a<=i||l&&s<=i)&&(h-=r?a:0,v-=o?a:0),d=c&&p(u,t,c),n=!c&&p(u,t,c),(d||n)&&(!l&&s<=h||l&&(r&&s<=i+e||!r&&s<=e)?(h+=a,v+=a):(!l&&s<=v||l&&(o&&s<=i+f||!o&&s<=f))&&(v+=a)),l&&s+a<=i&&(h+=r?a:0,v+=o?a:0)),{index:h-=r?i:0,endIndex:v-=o?i:0}):{index:e,endIndex:f}}function O(n,t,i,e,r,f,o,u,s,a,c,l,h){var h,v,d,w,m;if(t&&!h){if(h=s?r.row:r.column,v=s?r.rowRelative:r.columnRelative,d=void 0,w=r.row+(r.rowRelative&&i),m=r.column+(r.columnRelative&&e),l&&!l(w,m))return r;if(r.rowRelative&&r.columnRelative&&0===r.row&&0===r.column&&0===o&&c&&(s&&c.VSe||!s&&c.zSe))return r;if(s&&0<=i||!s&&0<=e||!v){if(a)d=A(n,t,s?i:e,h,v,-1,!1,f,o,u,s,l).index;else if(d=dn(n,t,s?i:e,h,v,f,o,u,s,l),C(d))return(0,fn.Syt)(d);d!==h&&(r=r.offset(s?d-h:0,s?0:d-h,!0))}}return r}function E(n,t,i,e,r,f,o,u,s,a,c,l){var l,l,h,v,d,w,a,n;if(t&&!l){if(3===(l=r.Tyt())||s&&2===l||!s&&1===l)return r;if(l=s?r.rowRelative:r.columnRelative,h=s?r.endRowRelative:r.endColumnRelative,v=s?r.row:r.column,d=s?r.endRow:r.endColumn,w=void 0,s&&0<=i||!s&&0<=e||!l||!h){if(a)w=A(n,t,s?i:e,v,l,d,h,f,o,u,s,c);else if(w=wn(n,t,s?i:e,v,l,d,h,f,o,u,s,c),C(w))return(0,fn.Syt)(w);a=w.index,n=w.endIndex,a===v&&n===d||(r=r.offset2(s?a-v:0,s?0:a-v,s?n-d:0,s?0:n-d,i,e))}}return r}function D(n,t,i,e,r,f,o,u,s,a){if(t){var t=r;if(t&&f===t.source)return t.offsetWhenInsertRemoveColumn(o,u,s,a)}return r}function F(n,t,i,e,r,f,o,u,s,a,c,l){var h,v,d,w,m,C,p,_,g,b,h=F,v=e;if(e){if(1===e.type&&e.hmt())v=O(n,e.source||n,t,i,e,r,f,o,u,s,a,c,l);else if(1===e.type)v=E(n,e.source||n,t,i,e,r,f,o,u,s,c,l);else if(10===e.type)(d=h(n,t,i,e.value,r,f,o,u,s,a,c,l))!==e.value&&(v=(0,fn.Ayt)(d));else if(9===e.type)w=h(n,t,i,e.value,r,f,o,u,s,a,c,l),m=e.value2&&h(n,t,i,e.value2,r,f,o,u,s,a,c,l),w===e.value&&m===e.value2||(v=(0,fn.rbt)(e.operatorType,w,m));else if(7===e.type){for(C=cn,_=p=void 0,b=(g=e).arguments.length,_=0;_<b;_++)if((d=h(n,t,i,p=g.arguments[_],r,f,o,u,s,a,c,l))!==p){(C=[])[_]=d;break}if(C){for(_=0;_<b;_++)p=g.arguments[_],C[_]!==an&&C[_]!==cn||(C[_]=h(n,t,i,p,r,f,o,u,s,a,c,l));v=(0,fn.YJ)(g,C),g.s8t&&(v.s8t=g.s8t,v.u8t=g.u8t)}}else c&&!n.Iyt||u||13!==e.type||(v=D(n,n,t,i,e,r,f,o,s,c));return e.ensureSingle&&(v.ensureSingle=!0),v}}function d(f,o,u,s,n,t,i,e,a,c,l){var r,h,v,h,r=function(n,t,i,e,r){return o.call(this,n,i,e,t,f,u,s,a,c,r,l)},h=f.getSheet();h&&(v=h.b8&&(h.parent||h).xyt(),h=h.Ut&&h.Ut.pj(),T(v,r,a,h))}function T(n,t,i,e){var r,r,f,o,u,s,a,c,l,h,v,d,w,u,m,C,p,_,g,b,y;if(n)for(s=0;s<n.length;s++){for(c=a=!0,l=x.maxRowCount-1,h=x.maxColumnCount-1,d=0,w=(v=(r=n[s].validator)._S).length;d<w&&(m=(u=v[d]).rowCount,C=u.colCount,o=u.row,u=u.col,-1!==m&&(c=!1,l=o<l?o:l),-1!==C&&(a=!1,h=u<h?u:h),a||c);d++);if(!(i&&c||!i&&a)&&(p=(f=n[s].sheet).Uw(),r=r.condition(),_=void 0,v&&v[0]&&(-1===v[0].row&&(_={VSe:1}),-1===v[0].col)&&(_={zSe:1}),(g=r.getExpressions())&&0<g.length)){for(b=0;b<g.length;b++)y=g[b],g[b]=t(p,y,l,h,_);r.setExpressions(g,e)}}}function l(n){var i,t,e,n,r,f,o,i=[],t=n.parent,e=[].concat(t&&t.sheets||[n]),n=null==t?void 0:t.mp;if(n&&n.length)for(r=0,f=n;r<f.length;r++)(o=f[r])&&o.getSheet&&o.getSheet()&&e.push(o.getSheet());return e.forEach(function(t){var n=t.conditionalFormats,n=n&&n.getRules();n&&n.length&&n.forEach(function(n){n.KK&&i.push({rule:n,sheet:t})})}),i}function V(n){var t,i,e,n,r,f,o,t=[],i=n.parent,e=[].concat(i&&i.sheets||[n]),n=null==i?void 0:i.mp;if(n&&n.length)for(r=0,f=n;r<f.length;r++)(o=f[r])&&o.getSheet&&o.getSheet()&&e.push(o.getSheet());return e.forEach(function(n){n.tables&&(t=t.concat(n.tables.all()))}),t}function Q(f,o,u,s,a,c){var n,t,i,e,n=function(n,t,i,e,r){return o.call(this,n,i,e,t,f,u,s,a,c,r)},t=f.getSheet();t&&h(i=l(t),n,e=t.Ut&&t.Ut.pj(),a,c)}function h(n,t,i,e,r){var f,o,u,s,a,c,l,a,h,v,d,w,m,C,p,_,g,b,y,x,R,j,N,k,R,I,A,O,E;if(n)for(f=0,o=n.length;f<o;f++){if(s=(u=n[f].rule).ranges(),c=(a=M(s)).r,l=a.c,h=(a=n[f].sheet).Uw(),v=u.condition(),(d=a.tables)&&s&&1===s.length&&(m=(w=s[0]).row,C=w.col,p=w.rowCount,_=w.colCount,g=void 0,r&&e?g=d.AJ(m,C,p,_):a.EB&&a.Nyt&&(g=[a.Nyt]),g)&&g.length){for(b=!1,y=0,x=g.length;y<x;y++)if(j=(R=g[y]).row,N=R.col,k=R.rowCount,R=R.colCount,m===j&&p===k&&N<=C&&C+_<=N+R){b=!0;break}if(b)continue}if(v||(u.initCondition(),v=u.condition()),I=v&&v.getExpressions(),A=void 0,s&&s[0]&&(-1===s[0].row&&(A={VSe:1}),-1===s[0].col)&&(A={zSe:1}),I&&0<I.length){for(O=0;O<I.length;O++)E=I[O],I[O]=t(h,E,c,l,A);v.setExpressions(I,i)}}}function Z(n,r,f){var t,n,t=function(n,t,i,e){return P.call(this,n,i,e,t,r,f)},n=n.getSheet();tn(n,t,n.Ut.pj())}function nn(f,o,u,s,a,c){var n,t,i,n=function(n,t,i,e,r){return o.call(this,n,i,e,t,f,u,s,a,c,r)},t=f.getSheet();t&&(i=t.Ut&&t.Ut.pj(),tn(t,n,i,u,s,a,c))}function tn(l,h,n,v,d,w,m){var t=V(l);t&&t.forEach(function(f){var o,n,u,s,a,c;f&&!f.w0r&&(o=f.Mf.Uw(),n=f.dataRange(),u=n.row,s=n.col,c=f.footerIndex(),f.BSt.forEach(function(n,t){var t,i,e,r,t;a=s+t,(t=n.dataAreaFormula())&&(e=(i=h(o,t,u,a))!==t,r=f.NTr(),e&&f.Mf.Ut.YSt(f,k,{column:n.name(),expr:t}),n.dataAreaFormula(i),w&&m&&d&&f.Mf===l&&(!r||e)?f.csr(l,v,d,n,a,e):r&&e&&f.Mf===l&&f.tGr(n,a,e)),(t=n.footerFormula())&&((i=h(o,t,c,a))!==t&&f.Mf.Ut.YSt(f,I,{column:n.name(),expr:t}),n.footerFormula(i))}))})}function en(n,r,f){var t,n,i,t=function(n,t,i,e){return P.call(this,n,i,e,t,r,f)},n=n.getSheet(),i;h(l(n),t,n.Ut.pj())}function rn(n,t,i,e,r,f,o){var u,s,o,a,c,l,h,v,d,w,m,C,p,v,p;if(!o&&(a=(o=(s=(u=n.getSheet()).Ut)&&s.Ehe())&&o._he()))for(c in a)if(a.hasOwnProperty(c)&&(l=a[c]))for(h in l)l.hasOwnProperty(h)&&(d=+c,w=+h,v=l[h])&&v.expr&&!G(u.getValueIgnoreDefault(d,w))&&(m=u.op(),C=v.expr,p=v.oldRow,v=v.oldCol,m)&&p&&v&&C&&(C=t.call(self,n,d,w,C,n,i,e,r,f,an),p=m.unparse(n,C,d,w),s.setDefaultValue(d,w,p,cn,un.DefaultChangeValueType.Expression,cn,!0))}function dn(n,t,i,e,r,f,o,u,s,a){var c,l,n;if(0<=i||!r){if(c=e+(r?i:0),a&&c<i&&c<o)return e;if(l=s&&p(f,n,s),n=!s&&p(f,n,s),(l||n)&&o<=i&&(c+=r?u:0),l=s&&p(f,t,s),n=!s&&p(f,t,s),l||n)if(o+u<=c)c-=u;else if(o<=c)return g;return a&&o<=i&&r&&o<(c-=u)+u&&c<o?g:c-=r?i:0}return e}function p(n,t,i){var i=i?{2:!0}:{1:!0};return n===t||n.Mf===t.Mf&&(3===n.nT&&i[t.nT]||i[n.nT]&&3===t.nT)}function wn(n,t,i,e,r,f,o,u,s,a,c,l){var h,v,d,w,n,u,t;if(0<=i||!r){if(h=e+(r?i:0),v=f+(o?i:0),d=s+a-1,w=c&&p(u,n,c),n=!c&&p(u,n,c),(w||n)&&s<=i&&(h+=r?a:0,v+=o?a:0),w=c&&p(u,t,c),n=!c&&p(u,t,c),w||n)if(u=i+e,t=i+f,!l&&d<h||l&&d<u)h-=a,v-=a;else{if(!l&&s<=h&&v<=d||l&&s<=u&&t<=d)return g;!l&&v<s||l&&t<s||(!l&&d<=v||l&&d<=t?(h=!l&&h<=s||l&&u<=s?h:s,v-=a):v=s-1)}return h-=r?i:0,v-=o?i:0,l&&s<=i&&(h-=r?a:0,v-=r?a:0),{index:h,endIndex:v}}return{index:e,endIndex:f}}function mn(n,t,i){var e,r,f,o,u,s,a,c,a,a,c,a,l,h,c,a,v,d,e=mn,r=t;if(t)if(t.source)if(s=t.source,(a=t.endSource)&&s!==a){if(!(c=s.Mf&&s.Mf.parent))return fn.kyt;a===i?(a=i.S3,r.endSource=c.getSheet(a-1).Uw()):s===i&&(a=i.S3,r.source=c.getSheet(a).Uw()),delete i.S3,r.source===r.endSource&&delete r.endSource}else(n!==i&&s===i||n===i&&s!==i)&&(r=fn.kyt);else if(10===t.type)(f=e(n,t.value,i))!==t.value&&(r=(0,fn.Ayt)(f));else if(9===t.type)c=e(n,t.value,i),a=t.value2&&e(n,t.value2,i),c===t.value&&a===t.value2||(r=(0,fn.rbt)(t.operatorType,c,a));else if(7===t.type){for(l=cn,h=t.arguments.length,u=0;u<h;u++)if((f=e(n,o=t.arguments[u],i))!==o){(l=[])[u]=f;break}if(l){for(u=0;u<h;u++)o=t.arguments[u],l[u]!==an&&l[u]!==cn||(l[u]=e(n,o,i));r=(0,fn.YJ)(t,l)}}else 8===t.type&&(c=n||i,a=N(t.value),s=(v=c.getCustomName(a))&&v.source||(v=(d=c.Lbt.getGlobalSourceModel()||c.getCalcSourceModel()).getSource().getCustomName(a))&&v.source?v.source:s)&&(n!==i&&s===i||n===i&&s!==i)&&(r=fn.kyt);return t.ensureSingle&&(r.ensureSingle=!0),r}function S(n,t,i,e,r){return mn(n,e,r)}function Cn(n,t){return n.yyt===n.gyt&&t!==n.yyt}function pn(n,t,i,e,r,f){var o,u,s,a,c,l,h,v,d,h,w,m,C,m,w,C,d,o=!!e.source,u=e.source||n,s=e.rowRelative,a=e.columnRelative,d=t,h=i,w=r.yyt.Mf;if(r.R0i&&(m=e.row,C=e.column,d=r.wyt+(m-r.pyt)+w.lT(r.wyt,m-r.pyt+1,!0),h=r.Myt+(C-r.byt)+w.lT(r.Myt,C-r.byt+1)),m=r.Dyt(d),w=r._yt(h),(0<=t||!s)&&(0<=i||!a)){if(c=e.row+(s?t:0),l=e.column+(a?i:0),f&&f.isNameID||n===r.gyt&&(v=n===r.yyt?r.Eyt(r.yyt,t,i,1,1)&&!r.R0i:(C=t,d=i,f&&f.crossSheetMoved&&(C-=m,d-=w),r.jyt(r.gyt,C,d,1,1))),v&&(c-=s?m:0,l-=a?w:0),u===r.yyt&&r.Eyt(u,c,l,1,1)&&!r.jyt(u,c,l,1,1))return fn.kyt;if((h=(o&&u===r.gyt||!o&&n===r.gyt)&&r.jyt(r.gyt,c,l,1,1))&&(c+=m,l+=w),l-=a?i:0,u=e.source,r.gyt!==r.yyt&&(h&&v?o&&(u=r.yyt):h?u=r.yyt:v&&!o&&(u=r.gyt)),(c-=s?t:0)!==e.row||l!==e.column||u!==e.source)return(0,fn.knt)(u,cn,c,l,s,a)}else if((0<=t||!s)&&-1===i){if(c=e.row+(s?t:0),r.Eyt(n,t,i,1,1)&&(c-=s?m:0),r.jyt(u,c,-1,1,-1))c+=m;else if(r.Eyt(u,c,-1,1,-1))return fn.kyt;if((c-=s?t:0)!==e.row)return(0,fn.knt)(e.source,cn,c,e.column,s,e.columnRelative)}else if(-1===t&&0<=i&&!a){if(l=e.column+(a?i:0),r.Eyt(n,t,i,1,1)&&(l-=a?w:0),r.jyt(u,c,l,1,1))l+=w;else if(r.Eyt(u,c,l,1,1))return fn.kyt;if(l-=a?i:0,c!==e.row||l!==e.column)return(0,fn.knt)(e.source,e.endSource,e.row,l,e.rowRelative,a)}return e}function b(n,t){var i,e,r,f;return(t=n.getIntersect(t,0,0))?(i=n.row,e=n.col,r=n.rowCount,f=n.colCount,n.rowCount===t.rowCount&&n.colCount===t.colCount||(n.rowCount===t.rowCount?(n.col===t.col&&(e=n.col+t.colCount),f=n.colCount-t.colCount):n.colCount===t.colCount&&(n.row===t.row&&(i=n.row+t.rowCount),r=n.rowCount-t.rowCount)),(0,un.Ec)(i,e,r,f)):cn}function _n(n,t,i,e,r){var n,f;return t&&n&&(!(n=t.getIntersect(n,0,0))&&(f=t.getIntersect(i,0,0))||!(!n||!(n.rowCount===t.rowCount&&0!==r||n.colCount===t.colCount&&0!==e)))}function gn(n,t,i){var n=n.getRange(t,i);return(0,un.Ec)(n.row,n.col,n.rowCount,n.colCount)}function y(n,t,i,e){var t,r,t=b(n,t);return t?(r=t.union(i),e?(r.col=n.col,r.colCount=n.colCount):(r.row=n.row,r.rowCount=n.rowCount)):r=i,{startRow:r.row,endRow:r.row+r.rowCount-1,startColumn:r.col,endColumn:r.col+r.colCount-1}}function R(n,t,i,e,r){var f,n,t,f=b(n,t),n=n.getIntersect(t,0,0);return n?(n.row+=e,n.col+=r,{startRow:(t=f?f.union(n):i).row,endRow:t.row+t.rowCount-1,startColumn:t.col,endColumn:t.col+t.colCount-1}):cn}function bn(n,t){var i,e,r,n,f,o,u,t,i=n.row,e=n.col,r=n.rowCount,n=n.colCount,f=t.row,o=t.col,u=t.rowCount,t=t.colCount;return 1===r&&1!==n?o<e&&e<=o+t-1||o<=e+n-1&&e+n-1<o+t-1:1!==n||1===r||f<i&&i<=f+u-1||f<=i+r-1&&i+r-1<f+u-1}function yn(n,t,i,e,r,f){var e,r,f,o,u,s,a,c,l,h,v,d,n,w,m,C,p,_,e=gn(e,r,f),r=e.row,f=e.row+e.rowCount-1,o=e.col,u=e.col+e.colCount-1,s=n.pyt,a=s+n.Sx-1,c=n.byt,l=c+n.Cyt-1,h=n.wyt,v=n.Myt,d=(0,un.Ec)(s,c,n.Sx,n.Cyt),n=(0,un.Ec)(h,v,n.Sx,n.Cyt),w=e.getIntersect(n,0,0);if(_n(d,e,n,t,i))if(_=p=void 0,C=0!==t)if(_=s<=f&&f<=a,(p=s<=r&&r<=a)&&_)r+=t,f+=t;else if(p&&!_){if(t<=0)r+=t;else if(!(f<s+t)){if(!(a+t<f))return R(e,d,n,t,i);if(s===r)return y(e,d,n,C);r+=t}}else if(!p&&_){if(0<=t)f+=t;else if(!(a+t<r)){if(!(r<h))return R(e,d,n,t,i);if(a===f)return y(e,d,n,C);f+=t}}else w&&!w.equals(n)&&bn(e,n)&&(r=(m=b(e,w)).row,f=m.row+m.rowCount-1,o=m.col,u=m.col+m.colCount-1);else if(_=c<=u&&u<=l,(p=c<=o&&o<=l)&&_)o+=i,u+=i;else if(p&&!_){if(i<0)o+=i;else if(!(u<c+i)){if(!(l+i<u))return R(e,d,n,t,i);if(c===o)return y(e,d,n,C);o+=i}}else if(!p&&_){if(0<i)u+=i;else if(!(l+i<o)){if(!(o<v))return R(e,d,n,t,i);if(l===u)return y(e,d,n,C);u+=i}}else w&&!w.equals(n)&&bn(e,n)&&(r=(m=b(e,w)).row,f=m.row+m.rowCount-1,o=m.col,u=m.col+m.colCount-1);return{startRow:r,endRow:f,startColumn:o,endColumn:u}}function xn(n,t,i,e){return t<i||i+e-1<n}function Rn(n,t,i,e){return i<=n&&t<=i+e-1}function jn(n,t,i,e){return n<i&&i+e-1<t}function Nn(n,t,i,e){return i===n&&i+e-1<t||n<i&&i+e-1===t}function kn(n,t,i,e){return i<n&&n<=i+e-1&&i+e-1<t||n<i&&i<=t&&t<i+e-1}function _(n,t,i,e,r){return i<=n&&r<=n||t<=i+e-1&&t<=r+e-1}function In(n,t,i,e,r){for(var f,o,u,f=[xn,Rn,jn,Nn,kn],u=0;u<f.length;u++)if(f[u](n,t,i,e)){o=u+"_";break}if(i===r)o+="9";else for(u=0;u<f.length;u++)if(i!==r&&f[u](n,t,r,e)){o+=u;break}return o}function An(n,t,i,e,r){return{row:w(n.startRow,t),col:w(n.startColumn,i),endRow:sn(n.endRow,e),endCol:sn(n.endColumn,r)}}function On(n,t,i,e,r){return!r.R0i&&n===r.yyt&&r.wyt<=t&&t<=r.Sx+r.wyt-1&&r.Myt<=i&&i<=r.Cyt+r.Myt-1&&(t=t+r.pyt-r.wyt,i=i+r.byt-r.Myt),{startRow:e.row+(e.rowRelative?t:0),endRow:e.endRow+(e.endRowRelative?t:0),startColumn:e.column+(e.columnRelative?i:0),endColumn:e.endColumn+(e.endColumnRelative?i:0)}}function j(n,t,i,e,r,f,o,u,s){return G(f)&&(f=t.startRow),G(o)&&(o=t.startColumn),G(u)&&(u=t.endRow),G(s)&&(s=t.endColumn),(0,fn.lJ)(r||n.source,cn,n.rowRelative?f-i:f,n.columnRelative?o-e:o,n.endRowRelative?u-i:u,n.endColumnRelative?s-e:s,n.rowRelative,n.columnRelative,n.endRowRelative,n.endColumnRelative,i,e)}function En(n,t,i,e,r){var f,n,o,u,n,s,a,c,l,h,v,d,f=On(n,t,i,e,r),n=e.source||n;if(r.gyt===n&&r.yyt===n)switch(n=(o=In(f.startRow,f.endRow,r.pyt,r.Sx,r.wyt))+"-"+(u=In(f.startColumn,f.endColumn,r.byt,r.Cyt,r.Myt)),s=r.wyt-r.pyt,a=r.Myt-r.byt,c=An(f,r.pyt,r.byt,r.pyt+r.Sx-1,r.byt+r.Cyt-1),d=v=h=l=void 0,n){case m.outToCover+"-"+m.outToCover:case m.crossToCover+"-"+m.outToCover:case m.outToCover+"-"+m.crossToCover:case m.crossToCover+"-"+m.crossToCover:case m.coverToCover+"-"+m.outToCover:case m.outToCover+"-"+m.coverToCover:case m.coverNoMove+"-"+m.outToCover:case m.outToCover+"-"+m.coverNoMove:return fn.kyt;case m.outToCross+"-"+m.outToCover:case m.coverToCross+"-"+m.outToCover:case m.insideToCross+"-"+m.outToCover:case m.partToCross+"-"+m.outToCover:case m.crossToCross+"-"+m.outToCover:case m.crossNoMove+"-"+m.outToCover:case m.outToCross+"-"+m.coverNoMove:case m.outToCross+"-"+m.coverToCover:case m.outToCross+"-"+m.crossToCover:case m.insideToCross+"-"+m.coverNoMove:case m.insideToCross+"-"+m.coverToCover:case m.insideToCross+"-"+m.crossToCover:return r.wyt<=f.startRow?j(e,f,t,i,cn,r.wyt+r.Sx):j(e,f,t,i,cn,cn,cn,r.wyt-1);case m.outToCover+"-"+m.outToCross:case m.outToCover+"-"+m.coverToCross:case m.outToCover+"-"+m.insideToCross:case m.outToCover+"-"+m.partToCross:case m.outToCover+"-"+m.crossToCross:case m.outToCover+"-"+m.crossNoMove:case m.coverNoMove+"-"+m.outToCross:case m.coverToCover+"-"+m.outToCross:case m.crossToCover+"-"+m.outToCross:case m.coverNoMove+"-"+m.insideToCross:case m.coverToCover+"-"+m.insideToCross:case m.crossToCover+"-"+m.insideToCross:return r.Myt<f.startColumn?j(e,f,t,i,cn,cn,r.Myt+r.Cyt):j(e,f,t,i,cn,cn,cn,cn,r.Myt-1);case m.partToOut+"-"+m.coverNoMove:case m.crossToOut+"-"+m.coverNoMove:if(!_(f.startRow,f.endRow,r.pyt,r.Sx,r.wyt))return j(e,f,t,i);case m.coverNoMove+"-"+m.partToOut:case m.coverNoMove+"-"+m.crossToOut:if(o===m.coverNoMove&&!_(f.startColumn,f.endColumn,r.byt,r.Cyt,r.Myt))return j(e,f,t,i);case m.crossToInside+"-"+m.coverNoMove:case m.coverNoMove+"-"+m.crossToInside:return f.startRow>=r.pyt&&u===m.coverNoMove||f.startColumn>=r.byt&&o===m.coverNoMove?j(e,f,t,i,cn,c.row+s,c.col+a):j(e,f,t,i,cn,cn,cn,c.endRow+s,c.endCol+a);case m.partToInside+"-"+m.coverNoMove:return f.startRow>=r.pyt?j(e,f,t,i,cn,sn(c.row+s,c.endRow+1)):j(e,f,t,i,cn,cn,cn,w(c.endRow+s,c.row-1));case m.coverNoMove+"-"+m.partToInside:return f.startColumn>=r.byt&&o===m.coverNoMove?j(e,f,t,i,cn,cn,sn(c.col+a,c.endCol+1)):j(e,f,t,i,cn,cn,cn,cn,w(c.endCol+a,c.col-1));case m.partToCross+"-"+m.coverNoMove:case m.crossToPart+"-"+m.coverNoMove:case m.crossToCross+"-"+m.coverNoMove:if(_(f.startRow,f.endRow,r.pyt,r.Sx,r.wyt))return f.startRow>=r.pyt?j(e,f,t,i,cn,c.row+s):j(e,f,t,i,cn,cn,cn,c.endRow+s);case m.crossToCover+"-"+m.coverNoMove:case m.partToPart+"-"+m.coverNoMove:return r.pyt<r.wyt?j(e,f,t,i,cn,sn(c.row+s,c.endRow+1),cn,c.endRow+s):j(e,f,t,i,cn,c.row+s,cn,w(c.endRow+s,c.row-1));case m.coverNoMove+"-"+m.partToCross:case m.coverNoMove+"-"+m.crossToPart:case m.coverNoMove+"-"+m.crossToCross:if(_(f.startColumn,f.endColumn,r.byt,r.Cyt,r.Myt))return f.startColumn>=r.byt?j(e,f,t,i,cn,cn,c.col+a):j(e,f,t,i,cn,cn,cn,cn,c.endCol+a);case m.coverNoMove+"-"+m.crossToCover:case m.coverNoMove+"-"+m.partToPart:return r.byt<r.Myt?j(e,f,t,i,cn,cn,sn(c.col+a,c.endCol+1),cn,c.endCol+a):j(e,f,t,i,cn,cn,c.col+a,cn,w(c.endCol+a,c.col-1));case m.crossToCross+"-"+m.coverToCover:case m.crossToPart+"-"+m.coverToCover:case m.partToCross+"-"+m.coverToCover:if(_(f.startRow,f.endRow,r.pyt,r.Sx,r.wyt))return j(e,f,t,i);case m.coverToCover+"-"+m.crossToCross:case m.coverToCover+"-"+m.crossToPart:case m.coverToCover+"-"+m.partToCross:if(o===m.coverToCover&&_(f.startColumn,f.endColumn,r.byt,r.Cyt,r.Myt))return j(e,f,t,i);case m.coverToCover+"-"+m.partToPart:case m.partToPart+"-"+m.coverToCover:case m.coverToCover+"-"+m.crossToCover:case m.crossToCover+"-"+m.coverToCover:return j(e,f,t,i,cn,c.row+s,c.col+a,c.endRow+s,c.endCol+a);case m.partToPart+"-"+m.crossToCover:case m.partToCross+"-"+m.crossToCover:case m.crossToPart+"-"+m.crossToCover:case m.crossToCross+"-"+m.crossToCover:return _(f.startRow,f.endRow,r.pyt,r.Sx,r.wyt)?j(e,f,t,i):(h=c.row===f.startRow?c.col===f.startColumn?(v=f.endColumn,d=c.col+a,l=c.endRow+s,c.row+s):(v=f.startColumn,d=c.endCol+a,l=o===m.partToCross||o===m.crossToCross?r.pyt+s-1:f.endRow,f.startRow):c.col===f.startColumn?(v=f.endColumn,d=c.col+a,l=f.endRow,o===m.partToCross||o===m.crossToCross?r.pyt+r.Sx-1+s+1:f.startRow):(v=f.startColumn,d=c.endCol+a,l=o===m.partToCross||o===m.crossToCross?c.row+s:f.startRow,c.endRow+s),j(e,f,t,i,cn,sn(l,h),sn(v,d),w(l,h),w(v,d)));case m.crossToCover+"-"+m.partToPart:case m.crossToCover+"-"+m.partToCross:case m.crossToCover+"-"+m.crossToPart:case m.crossToCover+"-"+m.crossToCross:return _(f.startColumn,f.endColumn,r.byt,r.Cyt,r.Myt)?j(e,f,t,i):(h=c.row===f.startRow?(l=(d=c.col===f.startColumn?(v=c.endCol+a,c.col+a):(v=f.endColumn,u===m.partToCross||u===m.crossToCross?r.byt+r.Cyt-1+a+1:f.startColumn),f.endRow),c.row+s):c.col===f.startColumn?(v=f.startColumn,d=u===m.partToCross||u===m.crossToCross?r.byt+a-1:f.endColumn,l=c.endRow+s,f.startRow):(v=u===m.partToCross||u===m.crossToCross?c.col+a:f.startColumn,d=c.endCol+a,l=f.startRow,c.endRow+s),j(e,f,t,i,cn,sn(l,h),sn(v,d),w(l,h),w(v,d)));case m.coverToOut+"-"+m.coverToOut:case m.coverToOut+"-"+m.coverToCross:case m.coverToOut+"-"+m.coverToCover:case m.coverToOut+"-"+m.coverNoMove:case m.coverToCross+"-"+m.coverToOut:case m.coverToCross+"-"+m.coverToCross:case m.coverToCross+"-"+m.coverToCover:case m.coverToCross+"-"+m.coverNoMove:case m.coverToCover+"-"+m.coverToOut:case m.coverToCover+"-"+m.coverToCross:case m.coverToCover+"-"+m.coverToCover:case m.coverToCover+"-"+m.coverNoMove:case m.coverNoMove+"-"+m.coverToOut:case m.coverNoMove+"-"+m.coverToCross:case m.coverNoMove+"-"+m.coverToCover:return j(e,f,t,i,cn,f.startRow+s,f.startColumn+a,f.endRow+s,f.endColumn+a);default:return j(e,f,t,i)}}function Mn(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,j,N,k,I,g,A,O,g,b,E,M,f,g,b,y,E,M,f,b,y,s=!!e.source,a=s?e.source:n,g=f&&f.isDataValidator,b=Cn(r,n),y=!1,c=e.rowRelative,l=e.columnRelative,h=e.endRowRelative,v=e.endColumnRelative;if(0<=t||!c||!h||0<=i||!l||!v){if(d=e.row+(c?t:0),w=e.endRow+(h?t:0),m=e.column+(l?i:0),p=w-d+1,_=(C=e.endColumn+(v?i:0))-m+1,!g&&b){if(O=r.jyt(a,d,m,p,_))return e.offset(o,u,!0,t,i);if(r.Eyt(a,d,m,p,_))return fn.kyt;if(a!==r.gyt||a!==r.yyt||0!==o&&0!==u)return e;y=!0}if(f&&f.isNameID||n===r.gyt&&(A=n===r.yyt?r.Eyt(r.yyt,t,i,1,1):(g=t,b=i,f&&f.crossSheetMoved&&(g-=o,b-=u),r.jyt(r.gyt,g,b,1,1))),(y||n===a&&n===r.gyt&&n===r.yyt)&&(E=t,M=i,A&&(E-=o,M-=u),0===o||0===u)){if(!(f=yn(r,o,u,e,E,M)))return fn.kyt;if(0===u&&o&&f.endColumn>=C&&f.startColumn<=m||0===o&&u&&f.endRow>=w&&f.startRow<=d)return g=f.startRow,b=f.startColumn,y=f.endRow,E=f.endColumn,g===d&&y===w&&b===m&&E===C?e:(c&&(g-=t),h&&(y-=t),l&&(b-=i),v&&(E-=i),(0,fn.lJ)(e.source,cn,g,b,y,E,c,l,h,v,t,i))}if(A&&(M=r.wyt-r.pyt,f=r.Myt-r.byt,p+=(c?-M:0)+(h?M:0),_+=(l?-f:0)+(v?f:0)),a===r.yyt&&r.Eyt(a,d,m,p,_)&&!_&&(!c&&!l&&!h&&!v||!A))return fn.kyt;if(g=(s&&a===r.gyt||!s&&n===r.gyt)&&(!A&&r.jyt(r.gyt,d,m,p,_)||A&&r.Eyt(r.yyt,c?d:d+o,l?m:m+u,p,_)),A&&(d-=j=c?o:0,w-=N=h?o:0,m-=k=l?u:0,C-=I=v?u:0),b=!1,g)d+=o,w+=o,m+=u,C+=u;else if(r.Eyt(a,d,m,p,_)){if(!(y=r.intersectWith(a,d,m,p,_))||y.rowCount!==p&&y.colCount!==_)return fn.kyt;d=y.row+o,m=y.col+u,w=d+y.rowCount,C=m+y.colCount,b=!0}return w-=h?t:0,m-=l?i:0,C-=v?i:0,r.gyt===r.yyt?a=s?e.source:an:(a=e.source,g&&A&&s?a=r.yyt:g&&A||(g?a=r.yyt:A&&!s&&(a=r.gyt))),(d-=c?t:0)!==e.row||m!==e.column||w!==e.endRow||C!==e.endColumn||b||a!==e.source?(0,fn.lJ)(a,cn,d,m,w,C,c,l,h,v,t,i):void 0}}function Sn(n,t,i,e,r,f){var o,u,n,s,t,n,o,u;return(!!e.source?e.source:n)===r.gyt&&(n=e.row+(e.rowRelative?t:0),(s=e.endRow+(e.endRowRelative?t:0))===f.endRow()&&(n===f.startRow()||f.showHeader()&&n===f.startRow()+1)&&(t=e.column+(e.columnRelative?i:0),n=e.endColumn+(e.endColumnRelative?i:0),t>=f.startColumn())&&n<=f.endColumn())&&(e.endRow+=r.wyt-r.pyt),e}function Dn(n,t,i,e,r,f){var o,u,s,a,c,l,h,v,d,w,m,C,v,d,p,_,g,_,p,g,f,g,b,y,m,x,b,y,x,b,g,v,f,d,o,u=!!e.source?e.source:n,s=e.Tyt(),v=t,d=i,p=r.yyt.Mf;if(r.R0i&&(_=e.row,g=e.column,v=r.wyt+(_-r.pyt)+p.lT(r.wyt,_-r.pyt+1,!0),d=r.Myt+(g-r.byt)+p.lT(r.Myt,g-r.byt+1)),_=r.Dyt(v),p=r._yt(d),0===s){if(g=!r.Oyt&&En(n,t,i,e,r))return g=f&&f.tableExpand?Sn(n,t,i,g,r,f.tableExpand):g;if(g=Mn(n,t,i,e,r,f,_,p))return g}else if(1===s){if(a=e.rowRelative,l=e.endRowRelative,0<=t||!a||!l){if(v=e.row+(a?t:0),(d=e.endRow+(l?t:0))<v)return fn.kyt;if(C=n===r.gyt&&n===r.yyt&&r.Eyt(r.yyt,t,i,1,1),u===r.gyt&&u===r.yyt&&0===r.byt&&0===r.Myt&&r.Cyt===u.getColumnCount()){if(f=r.pyt,g=r.wyt,C&&(v-=_,d-=_),y=f+(b=r.Sx),x=f<=d&&d<y,(m=f<=v&&v<y)&&x)return C?e:e.offset(_,p,!0,t,i);if(b=g+b,m&&g<=d?(v+=_,d<b&&g<=d&&(d=b-1,v=y)):x&&v<=b&&(d+=_,g<=v)&&w<b&&(v=g,d=f-1),d-=l?t:0,(v-=a?t:0)!==e.row||d!==e.endRow)return(0,fn.lJ)(e.source,e.endSource,v,L.BAND_INDEX_CONST,d,L.BAND_INDEX_CONST,a,c,l,h,t,i)}if(C)return e.offset(-_,p,!0,t,i)}}else if(2===s&&(c=e.columnRelative,h=e.endColumnRelative,0<=i||!c||!h)){if(w=e.column+(c?i:0),(m=e.endColumn+(h?i:0))<w)return fn.kyt;if(C=n===r.gyt&&n===r.yyt&&r.Eyt(r.yyt,t,i,1,1),u===r.gyt&&u===r.yyt&&0===r.pyt&&0===r.wyt&&r.Sx===u.getRowCount()){if(y=r.byt,x=r.Myt,C&&(w-=p,m-=p),g=y+(b=r.Cyt),f=y<=m&&m<g,(v=y<=w&&w<g)&&f)return C?e:e.offset(_,p,!0,t,i);if(d=x+b,v&&x<=m?(w+=p,m<d&&x<=m&&(m=d-1,w=g)):f&&w<=d&&(m+=p,x<=w)&&w<d&&(w=x,m=y-1),m-=h?i:0,(w-=c?i:0)!==e.column||m!==e.endColumn)return(0,fn.lJ)(e.source,e.endSource,L.BAND_INDEX_CONST,w,L.BAND_INDEX_CONST,m,a,c,l,h,t,i)}if(C)return e.offset(_,-p,!1,t,i)}return e}function P(n,t,i,e,r,f,o){var u,s,a,c,l,h,v,d,w,u=P,s=e;if(1===e.type&&e.hmt())s=f?pn(n,t,i,e,r,o):Tn(n,t,i,e,r);else if(1===e.type)s=f?Dn(n,t,i,e,r,o):Vn(n,t,i,e,r);else if(10===e.type)(a=u(n,t,i,e.value,r,f,o))!==e.value&&(s=(0,fn.Ayt)(a));else if(13===e.type){if(s=e.offset(0,0,!0),e.ubt&&(s.ubt=e.ubt,-1===(c=e.abt.getColumnIndexInTable(e.ubt))))return fn.kyt;if(e.sbt&&(s.sbt=e.sbt,-1===(c=e.abt.getColumnIndexInTable(e.sbt))))return fn.kyt}else if(9===e.type)l=u(n,t,i,e.value,r,f,o),h=e.value2&&u(n,t,i,e.value2,r,f,o),l===e.value&&h===e.value2||(s=(0,fn.rbt)(e.operatorType,l,h));else if(7===e.type){for(v=cn,c=d=void 0,w=e.arguments.length,c=0;c<w;c++)if((a=u(n,t,i,d=e.arguments[c],r,f,o))!==d){(v=[])[c]=a;break}if(v){for(c=0;c<w;c++)d=e.arguments[c],v[c]!==an&&v[c]!==cn||(v[c]=u(n,t,i,d,r,f,o));s=(0,fn.YJ)(e,v)}(0,fn.isExpression)(e.function)&&(s.function=u(n,t,i,e.function,r,f,o))}return e.ensureSingle&&(s.ensureSingle=!0),s}function Fn(n,t,i){for(var e,r,f,o,u,u,s,a,c,l,u,h,v,d,e,r=t.gyt.getSheet().Ut.pj(),f=0;f<n.length;f++)if((o=n[f].validator).rge)delete o.rge;else if(u=o._S,s=(u=M(u)).r,a=u.c,l=(c=n[f].sheet).Uw(),(h=(u=o.condition()).getExpressions())&&0<h.length){for(v=0;v<h.length;v++)d=h[v],h[v]=P(l,s,a,d,t,i,{isDataValidator:!0});u.setExpressions(h,r)}}function Tn(n,t,i,e,r){var f,o,u,s,a,c,l,f=e.source||n,o=e.rowRelative,u=e.columnRelative,c=r.Dyt(t),l=r._yt(i);if((0<=t||!o)&&(0<=i||!u)){if(s=e.row+(o?t:0),a=e.column+(u?i:0),r.Eyt(n,t,i,1,1)?(s-=o?c:0,a-=u?l:0):r.jyt(n,s,a,1,1)&&(s+=o?c:0,a+=u?l:0),r.jyt(f,s,a,1,1)?(s+=c,a+=l):r.Eyt(f,s,a,1,1)&&(s-=c,a-=l),a-=u?i:0,(s-=o?t:0)!==e.row||a!==e.column)return(0,fn.knt)(e.source,cn,s,a,o,u)}else if((0<=t||!o)&&-1===i){if(s=e.row+(o?t:0),r.Eyt(n,t,-1,1,-1)?s-=o?c:0:r.jyt(n,s,-1,1,-1)&&(s+=o?c:0),r.jyt(f,s,-1,1,-1)?s+=c:r.Eyt(f,s,-1,1,-1)&&(s-=c),(s-=o?t:0)!==e.row||a!==e.column)return(0,fn.knt)(e.source,cn,s,e.column,o,e.columnRelative)}else if(-1===t&&0<=i&&!u&&(a=e.column+0,r.Eyt(n,-1,i,-1,1)?a-=0:r.jyt(n,-1,a,-1,1)&&(a+=0),r.jyt(f,-1,a,-1,1)?a+=l:r.Eyt(f,-1,a,-1,1)&&(a-=l),a-=0,s!==e.row||a!==e.column))return(0,fn.knt)(e.source,cn,e.row,a,e.rowRelative,u);return e}function Vn(n,t,i,e,r){var f,o,u,s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,f=e.source||n,o=e.Tyt(),x=r.Dyt(t),R=r._yt(i);if(0===o){if(v=e.rowRelative,d=e.columnRelative,w=e.endRowRelative,m=e.endColumnRelative,!(0<=t)&&v&&w||!(0<=i)&&d&&m)if(!(0<=t)&&v&&w||-1!==i){if(-1===t&&(0<=i||!d||!m)){if((a=e.column+(d?i:0))<(c=e.endColumn+(m?i:0)))return fn.kyt;if(r.Eyt(n,-1,i,-1,1)?(a-=g=d?R:0,c-=y=m?R:0):r.jyt(n,-1,i,-1,1)&&(a+=g=d?R:0,c+=y=m?R:0),r.jyt(f,-1,a,-1,h=c-a)?(a+=p=R,c+=p):r.Eyt(f,-1,a,-1,h)&&(a-=p=R,c-=p),c-=m?i:0,(a-=d?i:0)!==e.column||c!==e.endColumn)return(0,fn.lJ)(e.source,cn,a,e.endRow,c,e.rowRelative,d,e.endRowRelative,m,t,i)}}else{if((u=e.row+(v?t:0))<(s=e.endRow+(w?t:0)))return fn.kyt;if(r.Eyt(n,t,-1,1,-1)?(u-=_=v?x:0,s-=b=v?x:0):r.jyt(n,t,-1,1,-1)&&(u+=_=v?x:0,s+=b=v?x:0),r.jyt(f,u,-1,l=s-u,-1)?(u+=C=x,s+=C):r.Eyt(f,u,-1,l,-1)&&(u-=C=x,s-=C),s-=w?t:0,(u-=v?t:0)!==e.row||s!==e.endRow)return(0,fn.lJ)(e.source,cn,u,e.column,s,e.endColumn,v,e.columnRelative,w,e.endColumnRelative,t,i)}else if(u=e.row+(v?t:0),s=e.endRow+(w?t:0),a=e.column+(d?i:0),l=s-u,h=(c=e.endColumn+(m?i:0))-a,r.Eyt(n,t,i,1,1)?(u-=_=v?x:0,s-=b=w?x:0,a-=g=d?R:0,c-=y=m?R:0):r.jyt(n,u,a,l,h)&&(u+=_=v?x:0,s+=b=w?x:0,a+=g=d?R:0,c+=y=m?R:0),r.jyt(f,u,a,l,h)?(u+=C=x,s+=C,a+=p=R,c+=p):r.Eyt(f,u,a,l,h)&&(u-=C=x,s-=C,a-=p=R,c-=p),s-=w?t:0,a-=d?i:0,c-=m?i:0,(u-=v?t:0)!==e.row||a!==e.column||s!==e.endRow||c!==e.endColumn)return(0,fn.lJ)(e.source,cn,u,a,s,c,v,d,w,m,t,i)}else if(1===o){if(v=e.rowRelative,w=e.endRowRelative,0<=t||!v||!w){if((u=e.row+(v?t:0))<(s=e.endRow+(w?t:0)))return fn.kyt;if(r.Eyt(n,t,-1,1,-1)?(u-=_=v?x:0,s-=b=w?x:0):r.jyt(n,t,-1,1,-1)&&(u+=_=v?x:0,s+=b=w?x:0),r.jyt(f,u,-1,l=s-u,-1)?(u+=C=x,s+=C):r.Eyt(f,u,-1,l,-1)&&(u-=C=x,s-=C),s-=w?t:0,(u-=v?t:0)!==e.row||s!==e.endRow)return(0,fn.lJ)(e.source,cn,u,L.BAND_INDEX_CONST,s,L.BAND_INDEX_CONST,v,!1,w,!1,t,i)}}else if(2===o){if(d=e.columnRelative,m=e.endColumnRelative,a=e.column+(d?i:0),(c=e.endColumn+(m?i:0))<a)return fn.kyt;if(r.Eyt(n,-1,i,-1,1)?(a-=g=d?R:0,c-=y=m?R:0):r.jyt(n,-1,i,-1,1)&&(a+=g=d?R:0,c+=y=m?R:0),r.jyt(f,-1,a,-1,h=c-a)?(a+=p=R,c+=p):r.Eyt(f,-1,a,-1,h)&&(a-=p=R,c-=p),c-=m?i:0,(a-=d?i:0)!==e.column||c!==e.endColumn)return(0,fn.lJ)(e.source,cn,L.BAND_INDEX_CONST,a,L.BAND_INDEX_CONST,c,!1,d,!1,m,t,i)}return e}function H(n,t,i,e,r,f){n.Ryt(t,i,e,r,!0,!1,f)}function Yn(n,t,i){var e,r,f,o,u,s,a,c,l,e=Yn,r=t;if(8===t.type){if(t.value===i&&(!t.source||t.source===n.getSource()))return(0,fn.Syt)(g,t.source)}else if(10===t.type)(f=e(n,t.value,i))!==t.value&&(r=(0,fn.Ayt)(f));else if(9===t.type)s=e(n,t.value,i),a=t.value2&&e(n,t.value2,i),s===t.value&&a===t.value2||(r=(0,fn.rbt)(t.operatorType,s,a));else if(7===t.type){for(c=cn,l=t.arguments.length,u=0;u<l;u++)if((f=e(n,o=t.arguments[u],i))!==o){(c=[])[u]=f;break}if(c){for(u=0;u<l;u++)o=t.arguments[u],c[u]!==an&&c[u]!==cn||(c[u]=e(n,o,i));r=(0,fn.YJ)(t,c)}}return t.ensureSingle&&(r.ensureSingle=!0),r}Object.defineProperty(n,"__esModule",{value:!0}),n.adjustFormulaOnMoveSwap=n.CalcOperatorAdjustor=n.MoveSwapInfo=void 0,fn=t("CalcEngine"),u=t("Common"),on=t("./dist/plugins/sheetsCalc/calc-spreadjs.js"),L=t("./dist/plugins/sheetsCalc/calc.ns.js"),x=t("./dist/plugins/sheetsCalc/parser-sheets.js"),un=t("Core"),G=u.Common.lt.ht,t=u.Common.zf,N=t.Gmt,sn=Math.min,w=Math.max,an=void 0,cn=null,C=fn.Convert.BJ,g=fn.Errors.Reference,k="columnFormula",I="footerFormula",M=un.util.z0,e.prototype.Dyt=function(n){var t,i,n,i,t=this,i=t.yyt.Mf;return t.Oyt=i&&i.o5(),t.Oyt&&0<=n?(n=n-t.wyt+1,i=i.ix(t.wyt,n,!0),t.wyt-t.pyt+i):t.wyt-t.pyt},e.prototype._yt=function(n){var t,i,n,i,t=this,i=t.yyt.Mf;return t.Oyt=i&&i.o5(),t.Oyt&&0<=n?(n=n-t.Myt+1,i=i.ix(t.Myt,n),t.Myt-t.byt+i):t.Myt-t.byt},e.prototype.jyt=function(n,t,i,e,r){var f=this;return f.gyt===n&&(-1===f.pyt||f.pyt<=t&&t+e<=f.pyt+f.Sx)&&(-1===f.byt||f.byt<=i&&i+r<=f.byt+f.Cyt)},e.prototype.Eyt=function(n,t,i,e,r){var f,o,u,s,a,c,l,f=this,o=f.yyt.Mf,u=o&&o.o5(),s=f.wyt,a=f.Myt,c=f.Sx,l=f.Cyt;return u&&(c+=o.lT(s,c,!0),l+=o.lT(a,l)),f.yyt===n&&(-1===s||s<=t&&t+e<=s+c)&&(-1===a||a<=i&&i+r<=a+l)},e.prototype.intersectWith=function(n,t,i,e,r){var f,t,o,f=this;return f.yyt!==n?cn:(t=f.Byt(n,t,i,e,r),(o=f.Byt(n,f.pyt,f.byt,e,r)).intersectWith(t))},e.prototype.Byt=function(n,t,i,e,r){var f,o,u,s,f,o,u,s;return{row:-1===t?0:t,column:-1===i?0:i,rowCount:-1===t||-1===e?n.rowCount:e,columnCount:-1===i||-1===r?n.colCount:r,intersectWith:c}},Y=e,n.MoveSwapInfo=Y,a=function(n){switch(n){case un.PasteOperationOptions.add:return 3;case un.PasteOperationOptions.subtract:return 4;case un.PasteOperationOptions.multiply:return 5;case un.PasteOperationOptions.divide:return 6}},ln.gB=function(n,t,i,e,r,f,o,u,s,a,c){var l,h,v,d,w,m,C,p,_,l=i,h=ln,v=this.gB;if(i){if(10===(m=i.type))l=(0,fn.Ayt)(v.call(h,n,t,i.value,e,r,f,o,u,s,a,c));else if(1===m&&i.hmt()){if(d=sn((i.source||t).getRowCount(),L.MAX_ROW_COUNT),w=sn((i.source||t).getColumnCount(),L.MAX_COLUMN_COUNT),i.rowRelative&&(i.row+e<0||i.row+e>=d)||i.columnRelative&&(i.column+r<0||i.column+r>=w))return(0,fn.Syt)(g,i.source);l=i.offset(0,0,!1)}else if(1===m){if(d=sn((i.source||t).getRowCount(),L.MAX_ROW_COUNT),w=sn((i.source||t).getColumnCount(),L.MAX_COLUMN_COUNT),i.rowRelative&&!i.isFullColumn&&(i.row+e<0||i.row+e>d)||i.columnRelative&&!i.isFullRow&&(i.column+r<0||i.column+r>w)||i.endRowRelative&&!i.isFullColumn&&(i.endRow+e<0||i.endRow+e>d)||i.endColumnRelative&&!i.isFullRow&&(i.endColumn+r<0||i.endColumn+r>w))return(0,fn.Syt)(g,i.source,i.endSource);l=i.offset(0,0,!1,e,r)}else if(9===i.type)l=(0,fn.rbt)(i.operatorType,v.call(h,n,t,i.value,e,r,f,o,u,s,a,c),i.value2&&v.call(h,n,t,i.value2,e,r,f,o,u,s,a,c));else if(7===m){if(p=[],i.arguments&&0<i.arguments.length)for(_=0;_<i.arguments.length;_++)p[_]=v.call(h,n,t,i.arguments[_],e,r,f,o,u,s,a,c);l=(0,fn.YJ)(i,p)}else 13===m&&(l=i.offsetWhenCopy(n,t,e,r,f,o,u,s,a,c));i.ensureSingle&&(l.ensureSingle=!0)}return l},ln.copyFormula=function(T,V,Y,n,t,i,L,X,J,G,U,e,P){var r,f,H,$,o,B,u,W,s,a,c,l,h,v,d,w,m,C,p,_,g,b,q,z,K,Q,y,x,Z,nn,R,j,N,tn,en,k,I,A,O,O,O,O,E,rn,O,M,S,M,S,D,F,D,F,D,D,r=T.b3(),f=n.b3(),H=r.getSource(),$=H.getSheet(),o=f.getSource(),B=ln;if(r&&f){for(e&&(u=e.transpose,W=e.operationOptions),s=o&&o.getSheet().Ut.pj(),c=Y,l=t,h=i,v=L,d=X,(a=V)<0&&(a=0,v=sn(r.rC(),f.rC())),Y<0&&(c=0,d=sn(r.cC(),f.cC())),t<0&&(l=0),i<0&&(h=0),w=new fn.CalcSourceModel(r.op(),H),g=o.getSheet(),b=!G&&g.o5(),q=v,z=d,K=g.getRowCount(),Q=g.getColumnCount(),m=0;m<v;m++)for(C=0;C<d;C++)y=m+a,x=C+c,u&&(y=a+C,x=c+m),P&&un.util.HRe(y,x,$)||r.Lyt(w,y,x,m,C);for(Z={},nn=f.op(),p=m=0;m<v&&m+l<K;m++)if(R=m+l,b&&0===g.getRowHeight(R))v++;else{if(!J||!o.isHiddenRow(R,!0))for(_=C=0,d=z;C<d&&C+h<Q;C++)if(j=C+h,b&&0===g.getColumnWidth(j))d++;else{if((N=w.pB(p,_))||e){if(N===Z)continue;if(N=B.gB(H,o,N,R,j,tn=t+m-V-p,en=i+C-Y-_,t,i,q,z),k=w.sT(p,_),o){if(b&&k&&(0<n.lT(R,k.rowCount,!0)||0<n.lT(j,k.colCount,!1))){_++,o.t8.removeAnchor(R,j);continue}if(k&&!k.isDynamicArray){for(I=k.rowCount,A=k.colCount,0<(O=a-k.row)&&(I-=O),(O=v-m)<I&&(I=O),0<(O=c-k.col)&&(A-=O),(O=d-C)<A&&(A=O),E=0;E<I;E++)for(rn=0;rn<A;rn++)w.bB(m+E,C+rn,Z);f.setArrayFormula(R,j,I,A,nn.unparse(o,N,R,j),an,s)}else{if(O=w.Phe(p,_),U&&g&&O&&(g.Dhe=O),W&&(M=p+a,S=_+c,u&&(M=_+a,S=p+c),N=hn(N,T.getValue(M,S),f.pB(R,j),n.getValue(R,j),W))&&N.value.type===fn.ExpressionType.number&&N.value2.type===fn.ExpressionType.number){(M=(0,on.evaluateExpression)(n,N))instanceof fn.CalcError||n.setValue(R,j,M),_++;continue}if(N&&u&&vn(N),S=N?nn.unparse(o,N,R,j):an,D=n.tables,0<=R&&0<=j&&D&&(F=D.find(R,j)||{NTr:function(){return!1}}).NTr()&&(F.eTt=!0,D=D.pMt(R,j,1,1,S,N),delete F.eTt,!D)){_++;continue}o.setFormula(R,j,S,an),O&&g.Ut.setDefaultValue(R,j,S,cn,un.DefaultChangeValueType.Expression,cn,!0),(F=w.Fyt(p,_))&&(D=new fn.EvaluateContext(o,(0,fn.eV)(R,j),!1,an,an,f.oT(R,j,!0)),F=(F=f.Lbt.allowDynamicArray?(0,fn.h0t)(D,N,!1,0,0,!0,!0):(0,fn.Pyt)(D,N,!1,0,0,!1,!1))===N?an:F),f.Gyt(R,j,N,F,k,s),O&&(delete g.Dhe,D=f.oT(R,j))&&D.isDefault(O)}}else f.bB(R,j,N),f.Uyt(R,j,k)}else f&&f.pB(R,j)&&f.Gyt(R,j,an,an,an,s);_++}p++}}},ln.moveFormula=function(n,t,i,e,r,f,o,u,T){var s,a,c,V,Y,l,h,L,v,d,w,m,n,C,p,_,g,b,y,x,R,j,X,N,k,I,A,O,J,E,M,S,D,F,D,s,m,a=n.b3(),c=e.b3(),V=c.getSource(),Y=a.op();if(a&&c){for(l=e.getRowCount(),h=e.getColumnCount(),L=a.pj(),v=c.pj(),d=Y.Hyt(),t<0&&(t=0,o=sn(n.getRowCount(),l)),r<0&&(r=0),i<0&&(i=0,u=sn(n.getColumnCount(),h)),f<0&&(f=0),w=!(n===e&&n.name()===e.name()),n=u,C=m=o,(_=e.o5())&&(m+=e.lT(r,o,!0),n+=e.lT(f,u)),a.mF(t,i,o,u),H(a,t,i,o,u),d.fsr(a,t,i,o,u),c.mF(r,f,m,n),H(c,r,f,m,n),d.fsr(c,r,f,m,n),g=[],b=0;b<o;b++)for(A=b+t,y=0;y<u;y++)x=a.pB(A,O=y+i),R=a.sT(A,O),j=a.Fyt(A,O),N=(X=a.oT(A,O))&&X.isDefault(),x&&(g[b*u+y]={WK:x,$bt:R,eyt:j,Ghe:N},a.zyt(A,O,L),R&&(A!==R.row||O!==R.col)||a.rT.setFormula(A,O,cn,an));for(E=w?{}:null,k=b=0;b<C&&b+r<l;b++)if(M=b+r,_&&0===e.getRowHeight(M))C++;else{for(I=y=0,p=u;y<p&&f+y<h;y++)if(S=y+f,_&&0===e.getColumnWidth(S))p++;else{if(D=g[k*u+I]){if(x=D.WK,R=D.$bt,_&&R&&(0<e.lT(M,R.rowCount,!0)||0<e.lT(S,R.colCount,!1))){I++,V.t8.removeAnchor(M,S);continue}Y&&R&&!R.isDynamicArray&&R.row===t+b&&R.col===i+y&&(J=(0,un.Ec)(M,S,R.rowCount,R.colCount)),F=R&&!R.isDynamicArray?J:an,j=D.eyt,(N=D.Ghe)&&(e.Dhe=N),c.Vyt(v,M,S),c.bB(M,S,x),c.Uyt(M,S,F),c.Yyt(M,S,j),c.Uhe(M,S,N),(!F||F.row===M&&F.col===S)&&(D=c.getFormula(M,S),c.rT.setFormula(M,S,D,F),N)&&e.Ut.setDefaultValue(M,S,D,cn,un.DefaultChangeValueType.Expression,cn,!0),w&&(E[M+", "+S]=x),N&&delete e.Dhe}else G(c.pB(M,S))||(c.Vyt(v,M,S),c.bB(M,S,an),c.Uyt(M,S,an));I++}k++}T&&null!=(s=a.uT(!1))&&s.mB(t-1,i,1,u,0),d.Zyt(a,t,i,o,u),d.Zyt(c,r,f,m,n),m=(s=a.getSource().getSheet()).b8&&(s.parent||s).xyt(),d.Wyt(m,a.getSource(),t,i,c.getSource(),r,f,o,u,!0,E,T),!0==w&&d.Wyt(m,a.getSource(),t,i,c.getSource(),r,f,o,u,!0,E)}},ln.prototype.isAdjustCell=function(n){return n.preAdj||this.y3&&n===this.y3[0]},ln.prototype.isAdjust=function(n){return n.preAdj||this.y3&&n===this.y3[0]},ln.prototype.Qyt=function(n,t){var i=this,e,r;isNaN(t)||(i.y3||(i.y3={},i.Kyt={}),e=i.y3[t],r=i.Kyt[t],n&&!n.preAdj&&n!==e&&(e?r.nextAdj=n:i.y3[t]=n,n.preAdj=r,n.nextAdj=cn,i.Kyt[t]=n))},ln.prototype.Jyt=function(n,t){var i,e,e,r,i=this;isNaN(t)||(e=i.y3&&i.y3[t],n&&(n.preAdj||n===e)&&(e=n.preAdj,r=n.nextAdj,e?e.nextAdj=r:i.y3[t]=r,r?r.preAdj=e:i.Kyt[t]=e,n.preAdj=cn,n.nextAdj=cn))},ln.prototype.Xyt=function(n,t,i,e,r,f){var o,u,s,a,f,c,l,h,o=f.isInTable,u=f.isUndo,s,a=F;f.callFromTable?this.qyt(n,a,t,i,e,r,o,u):this.$Be(n,a,t,i,e,r,f),(h=l=c=f=0)===t&&(e&&r?l=i:e?f=i:r?h=i:c=i),d(n,a,t,i,f,c,l,h,e,r,o),Q(n,a,t,i,e,r),o||nn(n,a,t,i,e,r),rn(n,a,t,i,e,r,u)},ln.prototype.$Be=function(n,t,i,e,r,f,o){var u,s,a,c,l,h,v,d,o,w,m,C,p,_,g,b,o,T,y,x,s,R,j,u,N,N,k,R,I,A,O,E,M,S,V,D,Y,F,a=o.isUndo,c=o.isInTable,l=this,h=l.y3;if(h){for(o=n.Mbt,g=(0,fn.createMap)(),b={l:!0},(o=o.uT())&&(T=f?o.CFe:o.AFe).call(o,i,e,r);h[0];){if(y=void 0,_=(w=(C=h[0]).w3).pj(),p=w.getSource(),v=C.row,d=C.column,x=w.oT(v,d),U(g,w,v,d)||C!==x);else{if(s=w.pB(v,d),R=w.Fyt(v,d),s)if(j=!1,u=r?v:d,n===p&&i<=u&&(j=!0,u-=f?e:-e),G(s.aMt)?(m=t.call(l,p,v,d,s,n,i,e,r,f,an,c),R&&(y=t.call(l,p,v,d,R,n,i,e,r,f,an,c))):(s.Wx&&s.Wx.lt.l||(N=f?B(s,n,p,r):$(s,n,p),s.Wx={lt:b,ct:N}),0===(N=f?q(s.Wx.ct,i,u,n===p,j):W(s.Wx.ct,i,e,u,n===p,j,r))?m=s:s.Wx[N]?(m=s.Wx[N],R&&(y=R.eyt||t.call(l,p,v,d,R,n,i,e,r,f,an,c))):(m=t.call(l,p,v,d,s,n,i,e,r,f,an,c),y=R&&t.call(l,p,v,d,R,n,i,e,r,f,an,c),-1!==N&&(s.Wx[N]=m,R)&&(R.eyt=y))),x.QDt&&K(f,r,x,n,i,e),x.vyt(),!a&&x.isDefault()&&null!=(s=null==(u=w.rT.Mf)?void 0:u.Ut)&&s.qBe(v,d,m),k=w.sT(v,d),f||j||a||k&&!k.isDynamicArray?!ln.SaveFormulaChanges||j||a||w.rT.setFormula(v,d,w.getFormula(v,d),k,!0,L.SetFormulaTrigger.addDelRowCol):w.Vyt(w.pj(),v,d),k){if(p===n&&(R=f?e:-e,r?i<=k.row&&(k.row+=R):i<=k.col&&(k.col+=R)),v===k.row&&d===k.col)if(k.isDynamicArray)(I=w.dataTable[v][d]).WK=m,I.eyt=y;else for(A=v;A<v+k.rowCount;A++)for(O=d;O<d+k.colCount;O++)w.SB(A,O,m,k,A===v&&O===d,!f&&!j&&!a&&_),J(g,w,A,O,!0)}else(I=w.dataTable[v][d]).WK=m,I.eyt=y,ln.SaveFormulaChanges&&w.rT.setFormula(v,d,w.getFormula(v,d),an,an,L.SetFormulaTrigger.addDelRowCol);else(w.getRowExpression&&w.getRowExpression(v)||w.getColumnExpression&&w.getColumnExpression(d))&&w.gF(v,d,1,1)}l.Jyt(C,0)}for(b.l=!1;h[1];)_=(w=(C=h[1]).w3).pj(),v=C.row,w.getRowExpression&&(m=w.getRowExpression(v))&&w.SB&&(E=w.getSource(),w.SB(v,-1,t.call(l,E,v,-1,m,n,i,e,r,f),an,!0,X(v,i,_,n.id===E.id))),l.Jyt(C,1);for(;h[2];)_=(w=(C=h[2]).w3).pj(),d=C.column,w.getColumnExpression&&(m=w.getColumnExpression(d))&&w.SB&&(E=w.getSource(),w.SB(-1,d,t.call(l,E,-1,d,m,n,i,e,r,f),an,!0,X(d,i,_,n.id===E.id))),l.Jyt(C,2);for(;h[3];)S=(M=h[3]).name,m=(w=M.w3).$yt(S),V=t.call(l,w.getSource(),0,0,m,n,i,e,r,f,{isNameID:!0}),w.twt(S,V),l.Jyt(M,3);for(D in h)if(3<(Y=+D)&&h.hasOwnProperty(D))for(;h[D];)F=(I=h[D]).w3,m=t.call(l,F,0,0,I.expression,n,i,e,r,f),F.setExpression(I.id,I.name,m),l.Jyt(I,Y)}},ln.prototype.qyt=function(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,g,s,x,R,j,N,k,I,A,O,E,a=this,c=a.y3;if(c){for(p=(0,fn.createMap)();c[0];){if(C=(l=(w=c[0]).w3).pj(),m=l.getSource(),U(p,l,h=w.row,v=w.column));else{if(!(d=l.pB(h,v))||t===S&&m===n)(l.getRowExpression&&l.getRowExpression(h)||l.getColumnExpression&&l.getColumnExpression(v))&&l.gF(h,v,1,1);else if(d=t.call(a,m,h,v,d,n,i,e,r,f,an,o,u),_=l.sT(h,v)){if(m===n&&(g=f?e:-e,r?i<=_.row&&(_.row+=g):i<=_.col&&(_.col+=g)),h===_.row&&v===_.col)if(_.isDynamicArray)l.SB(h,v,d,_,!0,X(r?h:v,i,C,n.id===m.id));else for(b=h;b<h+_.rowCount;b++)for(y=v;y<v+_.colCount;y++)l.SB(b,y,d,_,b===h&&y===v,X(r?b:y,i,C,n.id===m.id)),J(p,l,b,y,!0)}else g=m.Mf,(s=!u&&(null==(s=l.oT(h,v))?void 0:s.isDefault()))&&(g.Dhe=s),l.SB(h,v,d,_,!0,X(r?h:v,i,C,n.id===m.id),cn,cn,u),s&&(x=m.nT,R=l.op().unparse(m,d,h,v),g.Ut.setDefaultValue(h,v,R,x,un.DefaultChangeValueType.Expression,cn,!0),delete g.Dhe)}a.Jyt(w,0)}for(;c[1];)C=(l=(w=c[1]).w3).pj(),h=w.row,l.getRowExpression&&(d=l.getRowExpression(h))&&l.SB&&(m=l.getSource(),l.SB(h,-1,t.call(a,m,h,-1,d,n,i,e,r,f),an,!0,X(h,i,C,n.id===m.id))),a.Jyt(w,1);for(;c[2];)C=(l=(w=c[2]).w3).pj(),v=w.column,l.getColumnExpression&&(d=l.getColumnExpression(v))&&l.SB&&(m=l.getSource(),l.SB(-1,v,t.call(a,m,-1,v,d,n,i,e,r,f),an,!0,X(v,i,C,n.id===m.id))),a.Jyt(w,2);for(;c[3];)N=(j=c[3]).name,d=(l=j.w3).$yt(N),k=t.call(a,l.getSource(),0,0,d,n,i,e,r,f,{isNameID:!0}),l.twt(N,k),a.Jyt(j,3);for(I in c)if(3<(A=+I)&&c.hasOwnProperty(I))for(;c[I];)E=(O=c[I]).w3,d=t.call(a,E,0,0,O.expression,n,i,e,r,f),E.setExpression(O.id,O.name,d),a.Jyt(O,A)}},ln.prototype.nwt=function(n){var t=this,i,e,r;H(n.getCalcSourceModel(),0,0,n.getRowCount(),n.getColumnCount()),t.qyt(n,S),d(n,S,0,0,0,0,0,0,!0,!1),Q(n,S,0,0,!0,!1)},ln.prototype.Wyt=function(n,t,i,e,r,f,o,T,V,u,s,a){var c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,j,R,N,k,R,c,I,A,O,E,M,S,D,F,l=this,h=P,v=new Y(t,i,e,r,f,o,T,V),_=(0,fn.createMap)();if(n&&Fn(n,v,u),en(t,v,u),Z(t,v,u),x={},b=l.y3){for(;b[0];){if(d=(w=b[0]).w3,m=w.row,C=w.column,g=d.pj(),U(_,d,m,C));else{if(p=d.pB(m,C),y=d.getSource(),p)if(R=an,s&&s[m+", "+C]?(y=t,R={crossSheetMoved:!0}):a&&(R={tableExpand:a}),p=h.call(l,y,m,C,p,v,u,R),R=void 0,(j=d.sT(m,C))&&!j.isDynamicArray)if(R=z(j),m===j.row&&C===j.col)for(x[R]=!0,N=m;N<m+j.rowCount;N++)for(k=C;k<C+j.colCount;k++)d.SB(N,k,p,j,N===m&&k===C,g),J(_,d,N,k,!0);else x[R]||(d.SB(m,C,p,j,!1,g),J(_,d,m,C,!0));else R=r.Mf,(c=null==(c=d.oT(m,C))?void 0:c.isDefault())&&(R.Dhe=c),d.SB(m,C,p,j,!0,g),c&&delete R.Dhe;else(d.getRowExpression&&d.getRowExpression(m)||d.getColumnExpression&&d.getColumnExpression(C))&&d.gF(m,C,1,1)}l.Jyt(w,0)}for(;b[1];)d=(w=b[1]).w3,m=w.row,g=d.pj(),d.getRowExpression&&(p=d.getRowExpression(m))&&d.ewt&&d.ewt(m,h.call(l,y,m,-1,p,v,u),an,g),l.Jyt(w,1);for(;b[2];)d=(w=b[2]).w3,C=w.column,g=d.pj(),d.getColumnExpression&&(p=d.getColumnExpression(C))&&d.iwt&&d.iwt(C,h.call(l,y,-1,C,p,v,u),an,g),l.Jyt(w,2);for(;b[3];)A=(I=b[3]).name,p=(d=I.w3).$yt(A),O=h.call(l,y,0,0,p,v,u),d.twt(A,O),l.Jyt(I,3);for(E in b)if(3<(M=+E)&&b.hasOwnProperty(E))for(;b[E];)F=(D=(S=b[E]).w3).getSource(),p=h.call(l,F,0,0,S.expression,v,u),D.setExpression(S.id,S.name,p),l.Jyt(S,M)}},ln.prototype.Zyt=function(n,t,i,e,r,f){for(var o,u,s,a,c,l,h,v,o=this,u=t+e,s=i+r,l=t;l<u;l++)if(n.dataTable[l])for(h=i;h<s;h++)a=n.rwt(l,h),c=n.pB(l,h),(a||c)&&(f?(a.oldRow=a.row,a.oldColumn=a.column,a.row=l,a.column=h):(o.Jyt(a,0),v=this.g_e(n,a,l,h),a&&c&&(a.row!==v.row||a.column!==v.column||a.isDefault())&&(v.oldRow=a.row,v.oldColumn=a.column,v.isDefault(a.isDefault())),a=v),o.Qyt(a,0))},ln.prototype.g_e=function(n,t,i,e){var r,t;return t&&t.aT&&t[3]&&(r={aT:[3],3:t[3]}),n.owt(i,e,0),t=n.oT(i,e,!0),r&&(t[3]=r[3],t.aT=r.aT),t},ln.prototype.awt=function(n,t,i){for(var e,r,f,e=this,r=t;-1!==r&&r<t+i;r++)(n.rwt(-1,r)||n.pB(-1,r))&&(n.owt(-1,r,2),f=n.uwt(r,!0),e.Qyt(f,2))},ln.prototype.swt=function(n,t,i){for(var e,r,f,e=this,r=t;-1!==r&&r<t+i;r++)(n.rwt(r,-1)||n.pB(r,-1))&&(n.owt(r,-1,1),f=n.cwt(r,!0),e.Qyt(f,1))},ln.prototype.fwt=function(n){for(var t,i,e,r,f,o,u,t=this,i=n.op().getAllSourceModels(),f=0;f<i.length;f++)if((o=i[f]).lwt)for(e=o.lwt(),u=0;u<e.length;u++)(r=e[u])&&r.isVolatile&&r instanceof fn.CellCalc&&!t.isAdjustCell(r)&&t.Qyt(r,0)},ln.prototype.fsr=function(n,t,i,e,r){var n,f,n=n.getSource(),f;(n.asr&&n.asr()).osr(t,i,e,r,function(n,t){n.ubt&&t.forEach(function(n){n.r_t()})})},ln.prototype.onBeforeAddRemoveRows=function(n,e,t,r,f){[n,t].forEach(function(n){var t,i;n&&(t=n.rC(),i=n.cC(),r&&f?(n.b_t(e,0,f,i),n.mF(e,0,f,i),n.mF(e+f,0,t-e-f,i,an,!0)):n.mF(e,0,t-e,i,an,!0),n.hwt(e,t-e),H(n,e,-1,t-e,-1,r=!r&&ln.SaveFormulaChanges?2:r))})},ln.prototype.onAfterAddRemoveRows=function(n,e,r,f,t){var o,i,o=this,i;[n,t.rhCalcModel].forEach(function(n){var t,i;n&&(t=n.rC(),i=n.cC(),f?n.gF(e,0,r,i):t+=r,o.Zyt(n,e,0,t-e,i,!0),o.swt(n,e,t-e),o.fwt(n))}),o.Xyt(n.getSource(),e,r,!0,f,t),1!==n.op().calculationMode&&n.op().recalculateAll(!1)},ln.prototype.onAfterAddRemoveColumns=function(n,e,r,f,t){var o,i,o=this,i;[n,t.chCalcModel].forEach(function(n){var t,i;n&&(t=n.rC(),i=n.cC(),f?n.gF(0,e,t,r):i+=r,o.Zyt(n,0,e,t,i-e,!0),o.awt(n,e,i-e),o.fwt(n))}),o.Xyt(n.getSource(),e,r,!1,f,t),1!==n.op().calculationMode&&n.op().recalculateAll(!1)},ln.prototype.onBeforeAddRemoveColumns=function(n,e,t,r,f){[n,t].forEach(function(n){var t,i;n&&(t=n.rC(),i=n.cC(),r&&f?(n.b_t(0,e,t,f),n.mF(0,e,t,f),n.mF(0,e,t+f,i-e-f,an,!0)):n.mF(0,e,t,i-e,an,!0),n.dwt(e,i-e),H(n,-1,e,-1,i-e,r=!r&&ln.SaveFormulaChanges?2:r))})},ln.prototype.onAfterRemoveName=function(n,t){var n=n.vwt(t,!1);n&&(n.updateListening(!0,!1),n.vyt(),n.updateListeningOnRemoved())},ln.prototype.adjustFormulaOnRemoveName=Yn,ln.prototype.invalidName=function(n,t){var i,n;t&&(n=(i=n.getCalcSourceModel()).vwt(t.toUpperCase(),!0))&&n.mB()},ln.prototype.onAfterChangeTableColumn=function(n,t){var i,e,r,f,o,u,s,a,c,l,h,v,i=this,u=i.y3;if(u)for(s=(0,fn.createMap)();u[0];){if(U(s,e=(a=u[0]).w3,r=a.row,f=a.column));else{if(o=e.pB(r,f),c=e.pj(),o)if(o=ln.adjustExpressionOnChangeTableColumn(o,n,t,r,f),(l=e.sT(r,f))&&!l.isDynamicArray)for(l=(0,un.Ec)(r,f,l.rowCount,l.colCount),h=r;h<r+l.rowCount;h++)for(v=f;v<f+l.colCount;v++)e.SB(h,v,o,l,h===r&&v===f,c),J(s,e,h,v,!0);else e.SB(r,f,o,l,!0,c);else(e.getRowExpression&&e.getRowExpression(r)||e.getColumnExpression&&e.getColumnExpression(f))&&e.gF(r,f,1,1)}i.Jyt(a,0)}},ln.adjustExpressionOnChangeTableColumn=function(n,t,i,e,r){var f,o,u,s,a,c,l,h,v,d,w,o,u,s,f=ln.adjustExpressionOnChangeTableColumn;if(9===n.type){if(o=n.value,u=n.value2,s=f(o,t,i,e,r),a=u&&f(u,t,i,e,r),o!==s||u!==a)return(0,fn.rbt)(n.operatorType,s,a)}else if(7===n.type){for(c=!1,l=[],h=0;h<n.arguments.length;h++)d=f(v=n.arguments[h],t,i,e,r),c=c||v!==d,l.push(d);if(c)return(0,fn.YJ)(n,l)}else if(10===n.type){if((o=n.value)!==(u=f(o,t,i,e,r)))return(0,fn.Ayt)(u)}else if(13===n.type){if(n=(s=n).offset(0,0,!0),s.ubt&&(n.ubt=s.ubt,-1===(h=s.abt.getColumnIndexInTable(s.ubt))))return fn.kyt;if(s.sbt&&(n.sbt=s.sbt,-1===(h=s.abt.getColumnIndexInTable(s.sbt))))return fn.kyt}return n},ln.prototype.onAfterRemoveTable=function(n,t){for(var i,e,r,f,o,u,s,a,c,l,h,v,d,i=this,u=0;u<n.length;u++)(s=n[u]).osr(function(n){n.r_t(),n.vyt()});if(a=i.y3)for(c=(0,fn.createMap)();a[0];){if(U(c,e=(l=a[0]).w3,r=l.row,f=l.column));else{if(o=e.pB(r,f))if(o=ln.adjustExpressionOnRemoveTable(o,n,r,f,t),(h=e.sT(r,f))&&!h.isDynamicArray)for(h=(0,un.Ec)(r,f,h.rowCount,h.colCount),v=r;v<r+h.rowCount;v++)for(d=f;d<f+h.colCount;d++)e.SB(v,d,o,h,v===r&&d===f),J(c,e,v,d,!0);else e.SB(r,f,o,h,!0);else(e.getRowExpression&&e.getRowExpression(r)||e.getColumnExpression&&e.getColumnExpression(f))&&e.gF(r,f,1,1)}i.Jyt(l,0)}},ln.adjustExpressionOnRemoveTable=function(n,t,i,e,r){var f,o,u,s,a,c,l,h,v,d,w,o,u,m,C,p,_,g,f=ln.adjustExpressionOnRemoveTable;if(9===n.type){if(o=n.value,u=n.value2,s=f(o,t,i,e,r),a=u&&f(u,t,i,e,r),o!==s||u!==a)return(0,fn.rbt)(n.operatorType,s,a)}else if(7===n.type){for(c=!1,l=[],h=0;h<n.arguments.length;h++)d=f(v=n.arguments[h],t,i,e,r),c=c||v!==d,l.push(d);if(c)return(0,fn.YJ)(n,l)}else if(10===n.type){if((o=n.value)!==(u=f(o,t,i,e,r)))return(0,fn.Ayt)(u)}else if(13===n.type)for(m=n,h=0;h<t.length;h++)if(m.baseTable===t[h])return r?fn.kyt:(C=m.getRange(-1===i?0:i,-1===e?0:e,!0),p=-1===i||1===m.referencePortions(),_=1===C.rowCount&&1===C.colCount,g=m.source,_?(0,fn.knt)(g,cn,p?C.row-i:C.row,C.col,p,!1):(0,fn.lJ)(g,cn,p?C.row-i:C.row,C.col,C.row+C.rowCount-1,C.col+C.colCount-1,p,!1,p,!1));return n},ln.SaveFormulaChanges=!0,i=ln,n.CalcOperatorAdjustor=i,(o=fn.CalcService.prototype).mwt=function(){return new i},(t=m=m||{}).outToOut="0_0",t.outToCover="0_1",t.outToInside="0_2",t.outToPart="0_3",t.outToCross="0_4",t.outNoMove="0_9",t.coverToOut="1_0",t.coverToCover="1_1",t.coverToCross="1_4",t.coverNoMove="1_9",t.insideToOut="2_0",t.insideToInside="2_2",t.insideToPart="2_3",t.insideToCross="2_4",t.insideNoMove="2_9",t.partToOut="3_0",t.partToInside="3_2",t.partToPart="3_3",t.partToCross="3_4",t.partNoMove="3_9",t.crossToOut="4_0",t.crossToCover="4_1",t.crossToInside="4_2",t.crossToPart="4_3",t.crossToCross="4_4",t.crossNoMove="4_9",n.adjustFormulaOnMoveSwap=P},"./dist/plugins/sheetsCalc/parser-sheets.js":function(T,d,n){var t,v,b,A,m,y,x,R,i,n,e,w,C,j,c,p,V,o,u,a,Y,l,r,f,n,n,s,h;function L(n){return i(n+1).split("")}function _(n,t){var i=t+1;return n<0?n%i+i:t<n?n%i:n}function X(n){return new A.ErrorSource(n)}function J(n,t,i,e,r,f,o){return 3===o||0<=i&&0<=e||1===o&&0<=i||2===o&&0<=e}function G(n,t,i,e,r){var f,f,o,o,o,f=y.BAND_INDEX_CONST,f={Ky:f,iw:f,gwt:!0,pwt:!0,bwt:!1,ywt:0,wwt:!0},o=t?$(n,i,e,0):H(n,0,r);if(o.DX?(f.Ky=o.Mwt,f.gwt=o.Cwt):(f.iw=o.Mwt,f.pwt=o.Cwt),f.ywt=o.ywt,f.bwt=o.bwt,o.bwt&&!(o.ywt>=n.length)){if(!t&&o.DX||t&&!o.DX)return{bwt:!1};if(o=n[f.ywt],(t||!(0,A.isNumber)(o)&&"$"!==o)&&(!t||"C"!==o&&"c"!==o))return{bwt:!1};o=t?$(n,i,e,f.ywt):H(n,f.ywt,r),f.ywt=o.ywt,!o.bwt||!t&&!o.DX||t&&o.DX?f.bwt=!1:(f.ywt<n.length&&(f.wwt=!1),t?(f.iw=o.Mwt,f.pwt=o.Cwt):(f.Ky=o.Mwt,f.gwt=o.Cwt),f.bwt=!0)}return f}function U(n){return(0,A.Swt)(n)||95===n.charCodeAt(0)}function P(n,t,i){for(var e=n,r=t[n],n=!1;e<i&&!U(r);)++e<i&&(r=t[e]);if(e<i){for(;e<i&&U(r);)++e<i&&(r=t[e]);e<i&&(n=!0)}return n}function H(n,t,i){var e,r,f,o,u,s,a,c,l,h,v,e={Cwt:!0,bwt:!1},r=n.length;if(!(r<=t||("$"===n[t]&&(e.Cwt=!1,t++),r<=t)))if(u=n[f=t],(o=0,A.isNumber)(u)&&"0"!==u){for(e.DX=!0;f<r&&(0,A.isNumber)(u);)++f<r&&(u=n[f]);if(7<f-t)return e;for(s=f-1,a=0;t<=s;s--,a++)o+=(n[s].charCodeAt(0)-48)*p[a];if(o<=d.maxRowCount)e.Mwt=o-1,e.ywt=f,e.bwt=!0}else if((0,A.Swt)(u)){for(e.DX=!1;f<r&&(0,A.Swt)(u);)++f<r&&(u=n[f]);if(3<(c=f-t)||P(f,n,r))return e;for(h=l=f-1;t<=h;h--){if(!(65<=(v=n[h].charCodeAt(0))&&v<=90||97<=v&&v<=122))return e;o+=((32|v)-96)*w[l-h]}if(o<=d.maxColumnCount)e.Mwt=o-1,e.ywt=f,e.bwt=!0}return e}function $(n,t,i,e){var r,f,o,u,s,a,c,t,r,f={ywt:e,Mwt:y.BAND_INDEX_CONST,DX:!0,Cwt:!1,bwt:!1},o=n.length;if(!(o<=e)){if("R"===(s=n[u=e])||"r"===s)f.DX=!0,a=t;else{if("C"!==s&&"c"!==s)return f;f.DX=!1,a=i}if(u++,o<=++e)f.ywt=e,f.Mwt=a,f.Cwt=!0,f.bwt=!0;else if("["===(s=n[u])&&(e++,u++,f.Cwt=!0),!(o<=e||(c=!1,s=n[u],f.Cwt&&"-"===s&&(e++,u++,c=!0),o<=e)))if(s=n[u],(0,A.isNumber)(s)){for(;u<o&&(0,A.isNumber)(s);)++u<o&&(s=n[u]);if(t=parseInt(n.slice(e,u).join(""),10),f.Cwt){if(o<=u||"]"!==n[u])return f;u++}t<=(f.DX?d.maxRowCount:d.maxColumnCount)&&(f.Mwt=f.Cwt?(t=c?-t:t)+a:t-1,f.ywt=u,f.bwt=!0)}else if(!f.Cwt)f.ywt=e,f.Mwt=a,f.Cwt=!0,f.bwt=!0}return f}function B(n,t,i,e){var r,f,o,u,o,s,s,r=n.row||0,f=n.column||0,o=i.type;if(i.source){if(!(u=q(n,e,i.source,i.endSource)))return void e.push("#","R","E","F","!")}else!i.source&&n.addSheetName&&1===o&&(2===n.addSheetName?e.push("!"):q(n,e,n.source,C));8===o||5===o?(i.bwr&&(2===i.bwr||n.lyt||(0,A.W9t)(n.source,i.value))&&e.push(A.XLETAPrefix),i.bwr?(o=i.value,(s=(s=(0,A.getMapping)()&&(0,A.getMapping)().builtInFunctionsMapping)&&s[o])&&s.alias&&(o=s.alias),e.push(o)):i.value2?e.push(i.value2.name):e.push(i.value.toString())):i.value&&i._error?e.push(i.value.toString()):i.hmt()?g(n.useR1C1,r,f,i.row,i.column,i.rowRelative,i.columnRelative,e):W(n.source,n.useR1C1,r,f,i.row,i.column,i.endRow,i.endColumn,i.rowRelative,i.columnRelative,i.endRowRelative,i.endColumnRelative,e,i.Tyt())}function g(n,t,i,e,r,f,o,u,s){var a,a,a=d.maxRowCount-1;(0===(s=s||0)||1===s)&&-a<e&&e<=2*a&&(e=_(e+=f?t:0,a)),a=d.maxColumnCount-1,J(t,i,e,r=(0===s||2===s)&&-a<r&&r<=2*a?_(r+=o?i:0,a):r,f,o,s)?n?2!==s&&(u.push("R"),0<=e&&(t!==e||!f)&&(f?u.push("["+(e-t)+"]"):u.push(++e+"")),r<0)||1!==s&&(u.push("C"),i===r&&o||(o?u.push("["+(r-i)+"]"):u.push(++r+""))):(0<=r&&(o||u.push("$"),u.push.apply(u,L(r))),e<0||(e++,f||u.push("$"),u.push(e+""))):u.push(A.Errors.Reference.toString())}function W(n,t,i,e,r,f,o,u,s,a,c,l,h,v){3===(v=v||0)&&(r=0,o=d.maxRowCount-1,v=1),g(t,i,e,r,f,s,a,h,v);var s=y.BAND_INDEX_CONST;t&&r===o&&f===u&&(o===s||u===s)||o===s&&u===s||(h.push(":"),g(t,i,e,o,u,c,l,h,v))}function q(n,t,i,e){if(n.getExternalSourceToken){if(i){var i=(0,A.Y3e)(n,n.getExternalSourceToken(i).split(""),e&&n.getExternalSourceToken(e).split(""));if(!(0<i.length))return!1;t.push.apply(t,i)}return t.push("!"),!0}return!1}function N(n){var t=new A.Expression(8);return t.value=n,t}function z(n){var t=n;return t=n&&3<=n.length&&"["===n[0]&&"0"===n[1]&&"]"===n[2]?3===n.length?"":n.substring(3):t}function K(n,t,i){var e,n,r,f,o,u,n=n.source;return e=n&&(r=n.G3,f=n.S8,o=n.T8,r)&&(u=0<=t&&t<f&&o<=i||f<=t&&0<=i&&i<o)?n:e}function k(){return f.call(this,8e3)||this}function Q(n,t,i,e,r){return 0===t._type&&0===t.Twt||!e&&0===t._type&&4===t.Twt&&(!r||i<n.length-2&&":"===n[i+1].Awt&&0===n[i+2]._type&&4===n[i+2].Twt)}function Z(n,t,i,e,r){return t<=n.startRow()&&i<=n.startColumn()&&t+e>n.endRow()&&i+r>n.endColumn()}function I(){return s.call(this,13)||this}function nn(n,t){this.abt.Iwt(n,this,t)}function O(){return h.call(this,7900)||this}function tn(n,t,i){var e,r,f,i,o,u,o,s,a,c,l,h,v,v,d,e=i,r=0,f=t[r],i=hn(n,t,r,f),o=i.nM;if(!o){if(u=n.keepUnknownFormulas)return;S()}for(e.baseTable=o,r=i.xwt,f=t[++r],o=r;" "===f;)f=t[++r];for("@"!==f&&"["!==f&&(f=t[r=o]),c=a=!(s=1),l=t.length;0!==s&&r<l;)if("["===f&&(s++,f=t[++r]),"#"===f)a&&s<=1&&S(),v=(h=ln(t,r,f,s)).Nwt,r=h.xwt,f=h.kwt,s=h.Dwt,a?2===e.hbt&&3===v||2===v&&3===e.hbt?e.hbt=6:3===e.hbt&&8===v||3===v&&8===e.hbt?e.hbt=12:S():e.hbt=v,a=!0;else if("@"===f){for((1<s||a)&&S(),a=!0,e.hbt=1,f=t[++r];" "===f;)f=t[++r];"["===f&&"#"===t[r+1]&&"this row"===E(t,r+2,r+10).toLowerCase()&&(a=!1),","===f&&S()}else{for(v=r;!R(f)&&"]"!==f&&"["!==f;)if("'"===f&&r++,","===f){for(f=t[++r],d=r;" "===f;)f=t[++r];if("["===f){r=d,f=",";break}}else f=t[++r];if(v<r&&((c||"["===f&&1<s)&&S(),r=(h=en(e,t,r,f,s,v)).xwt,f=h.kwt,s=h.Dwt,c=!0),"]"===f){if(0===--s)break;r>=t.length&&S(),f=t[++r]}","===f&&(f=t[++r])}a||(e.hbt=n._wt?1:16),c||(e.lbt=1)}function E(n,t,i){return n.slice(t,i).join("")}function en(n,t,i,e,r,f){var o,u,s,a,c,l,h,h,f,v,h,o=n,u=[],a=!1,c=!1;if(1<r)a=!0,r--,u=t.slice(f,i),":"===(e=t[++i])&&(c="["===(e=t[++i]),s=(h=an(t,i,e,r)).sbt,i=h.xwt,e=h.kwt,r=h.Dwt);else if("["===e){for(c=!0,e=t[l=i-1];" "===e;)e=t[--l];":"!==e&&S(),u=rn(u=t.slice(f,l)),s=(h=an(t,i,e=t[i],r)).sbt,i=h.xwt,e=h.kwt,r=h.Dwt}else o.hbt!==C&&16!==o.hbt||(a=!0),0<(l=(h=t.slice(f,i)).indexOf(":"))?(u=h.slice(0,l),"["!==(s=h.slice(l+1))[0]&&S()):u=h;if(f=on(o,u,a),o.ubt=u.join(""),o.sbt=o.ubt,s?(v=on(o,s,c),o.lbt=4,o.sbt=s.join("")):(v=f,o.lbt=2),v<f&&(h=f,f=v,v=h),o.ubt=n.abt.getColumnName(f),o.sbt=n.abt.getColumnName(v),++i<t.length)for(e=t[i];" "===e;)e=t[++i];return{xwt:i,kwt:e,Dwt:r}}function rn(n){for(var t=n.length-1;0<=t&&" "===n[t];)t--;for(;0<=t&&" "!==n[t];)t--;return 0<=t?n.slice(t+1,n.length-t-1):n}function fn(n){for(var t=0,i=n.length,e=0;t<i&&" "===n[t];)t++;for(e=t,t=i-1;e<t&&" "===n[t];)t++;return e<=t?n.slice(e,t+1):n}function on(n,t,i){var e,r,f,i;if(t&&un(t,i)){for(e=[],r=0,f=t.length;r<f;r++)"'"===t[r]&&r<f-1&&r++,e.push(t[r]);return t=e,(i=n.abt.getColumnIndexInTable(t.join("")))<0&&S(),i}return-1}function un(n,t){var i,e,r;if(t)return 1;if(i="","#"!==(e=i=n[0])&&"@"!==i&&" "!==i&&","!==i&&":"!==i&&"["!==i&&"]"!==i){for(r=1;r<n.length;r++){if(","===(i=n[r])||":"===i||"["===i&&"'"!==e||"]"===i&&"'"!==e||"@"===i&&"'"!==e||"#"===i&&"'"!==e)return;e=i}return 1}}function M(n){for(var t,i,e,t=[],e=0;e<n.length;e++)"["!==(i=n[e])&&"]"!==i&&"@"!==i&&"#"!==i&&"'"!==i||t.push("'"),t.push(i);return t.join("")}function sn(n){var t,i,t="";if("#"===(t=n[0])||" "===t||"@"===t||" "===t||","===t||":"===t||"["===t||"]"===t)return 1;for(i=1;i<n.length;i++)if(" "===(t=n[i])||","===t||":"===t||"["===t||"]"===t||"@"===t||"#"===t)return 1}function an(n,t,i,e){var r,f,f,r=!1;if("["===i)for(r=!0,e++,i=n[++t];" "===i;)i=n[++t];for(f=t;"]"!==i&&(","!==i||1<e);)"'"===i&&t++,i=n[++t];return t<=f&&S(),f=n.slice(f,t),1<e&&e--,{sbt:f=r?f:fn(f),xwt:t,kwt:i,Dwt:e}}function cn(n){var t,i,t=(0,A.getMapping)()&&(0,A.getMapping)().tableFunctionsMapping;if(!R(t))for(i in t)if(t[i].toLowerCase()===n)return i.toLowerCase();return n}function ln(n,t,i,e){for(var r,f,o,u,s,a,r=14,f=t;"]"!==i;)"'"===i&&t++,i=n[++t];for(o=cn(o=E(n,f,t).toLowerCase().trim()),u=!1,s=0;s<c.length;s++)if(o===(a=c[s])){r=l[o],u=!0;break}if(u||S(),++t>=n.length)e--;else{for(i=n[t];" "===i;)i=n[++t];if(","===i){for(e<=1&&S(),i=n[++t];" "===i;)i=n[++t];"["===i&&(e++,i=n[++t])}1<e&&e--}return{Nwt:r,xwt:t,kwt:i,Dwt:e}}function hn(n,t,i,e){for(var r,f,o,u,f=0,o=t.length;"["!==e&&i<o;)e=t[++i];return{nM:r=0<i?(u=E(t,0,i),n.getTableByName(u)):n.getTableByIndex(n.row,n.column)||n.source.lsr,xwt:i,kwt:e}}function S(){throw e().Exp_FormulaInvalid}function vn(n,t,i){var e,r,f,o,u,s,a,e=(0,A.getMapping)()&&(0,A.getMapping)().tableFunctionsMapping,r=(0,A.sR)().d2t,f=e?e["#All"]:r.All.name,o=e?e["#This row"]:r.thisRow.name,u=e?e["#Headers"]:r.Headers.name,s=e?e["#Data"]:r.Data.name,a=e?e["#Totals"]:r.Totals.name;switch(n){case 1:return i?"["+o+"]":"@";case 2:return t?"["+u+"]":u;case 3:return t?"["+s+"]":s;case 8:return t?"["+a+"]":a;case 6:return"["+u+"], ["+s+"]";case 12:return"["+s+"], ["+a+"]"}return t?"["+f+"]":f}function dn(n,t){var i,e,r,f,o,u,s,a,i,c,l;for(n.unshift(new A.FormulaToken("=",1,0,0,0)),f=[],o=0,r=n.length-1;0<r;r--)n[r].lp===n[r-1].lp&&n[r].Awt===n[r-1].Awt||(f[o]=n[r],o++);for(f[o]=n[r],f.reverse(),u=[],a=s=0;a<f.length;a++,s++)e=wn(f[a]),u[s]=f[a],(i=a+1<f.length?f[a+1].lp:t.length)>f[a].lp+e&&(i=new A.FormulaToken(t.slice(f[a].lp+e,i),7,f[a].lp+e),f[a].ywt=f[a].lp+e-1,u[++s]=i);for(c=0;c<u.length;c++)l=u[c].Awt.trim(),3===u[c].Twt?u[c].Awt='"'+u[c].Awt+'"':"("===l||"{"===l?(u[c]._type=1,u[c].Twt=1):")"!==l&&"}"!==l||(u[c]._type=1,u[c].Twt=2);return u}function wn(n){return 1===n._type&&"ARRAY"===n.Awt?1:0===n._type&&3===n.Twt?(n.Ewt||n.Awt).length+2:0===n._type&&12===n.Twt?n.Awt.length+3:n.Awt.length}function D(n,t,i){var t,e;n&&t&&((e=n[t=t.getName&&t.getName()||"!"])||(e=n[t]=[],n.sheets||(n.sheets=[]),n.sheets.push(t)),e.push(i))}function F(n,t,i,e,r,f){var o,u,o,s;if(n){for(;10===n.type;)n=n.value;if(!(2<=(n=12===n.type?n.value:n).type&&n.type<=6))if(1===n.type)o=n.getRange(r,f),!e.source||n.source&&n.source!==e.source||t.push(o),D(i,n.source||e.source,o);else if(13===n.type)o=n.getRange(r,f),n.source===e.source&&o&&t.push(o),D(i,n.source||e.source,o);else if(8===n.type)n.jwt||(n.jwt=!0,o=j,n.source?n.source.op()&&(o=new A.EvaluateContext(n.source,(0,A.eV)(r,f))):o=e,F(o.getName(n.value),t,i,o,r,f),n.jwt=C);else if(9===n.type)F(n.value,t,i,e,r,f),n.value2&&F(n.value2,t,i,e,r,f);else if(7===n.type)for(s=0;s<n.arguments.length;s++)F(n.arguments[s],t,i,e,r,f)}}function mn(n,t,i,e,r,f,o,u,s){var f,t,a,c;n.setParserOption(f),f=[],t=t.split(""),R(s)&&(s=v.SheetArea.viewport);try{a=!!u||i.op().useR1C1,c=i.Uw(s).getParserContext(!o&&a,(0,A.eV)(e,r),{sheetArea:s}),f=n.parseToTokens(c,t,!1)}catch(n){}return Cn(n,f=dn(f,t),t,i,e,r,o,u,s)}function Cn(n,t,i,e,r,f,o,u,s){var a,c,l,h,u;return void 0===s&&(s=v.SheetArea.viewport),c=C,l=e.Uw(s),h=e.op(),u=!!u||h.useR1C1,h?(a=new m.SheetParserContext(e,!o&&u,(0,A.eV)(r,f),{sheetArea:s}),c=new A.EvaluateContext(l,(0,A.eV)(r,f),!1)):a=new A.ParserContext(j,!1,(0,A.eV)(0,0)),a.ignoreError=!0,pn(n,l,a,c,t,i,r,f)}function pn(n,t,i,e,r,f,o,u){for(var s,a,c,l,h,v,d,w,m,C,p,_,g,b,y,x,R,j,N,k,I,s=[],c=0;c<r.length;c++)try{if("["===(a=r[c]).Awt||"#"===a.y4[0]||3===a.Twt)s.push({index:a.lp,endIndex:a.ywt,text:a.Ewt||a.Awt,type:a._type,subType:a.Twt,canDrag:!1,ranges:a.ranges,value:a.Awt});else if(c=_n(n,i,r,c,l=[]),d=v=h=void 0,0<l.length){for(w=0;w<l.length;w++)if((m=l[w])instanceof A.FormulaToken)s.push({index:m.lp,endIndex:m.ywt,text:f.slice(m.lp,m.ywt+1).join(""),type:m._type,subType:m.Twt,canDrag:h,ranges:[],value:m.Awt});else if(m.WK){if(p=(C=m.WK).type,_=C.source,g=f.slice(m.lp,m.ywt+1).join(""),b=[],y={},h=!0,x=C.getRange&&C.getRange(o,u),8===p)d=v=!(h=!1),e&&(R=e,F(j=(R=C.source?new A.EvaluateContext(C.source,(0,A.eV)(o,u),!1):R).getName(C.value),b,y,e,o,u));else if(13===p||22===p)d=!(h=!1),_&&t&&_.Mf===t.Mf&&x?b.push(x):b=null,D(y,_,x);else if(1===p)if(d=!0,C.endSource)for(k=C.endSource,I=_.getSources(k),w=0;w<I.length;w++){if(I[w]===t){b.push(x);break}D(y,I[w],x)}else D(y,_||t,x),(!_||t&&_.Mf===t.Mf)&&b.push(x);else d=!1,b=null;b&&0<b.length||d?s.push({index:m.lp,endIndex:m.ywt,text:g,type:0,subType:7,canDrag:h,ranges:b,value:g,sheetRanges:y,sheetArea:_&&_.nT||t.nT,isName:v}):s.push({index:m.lp,endIndex:m.ywt,text:g,type:a._type,subType:a.Twt,canDrag:h,ranges:b,value:g,sheetRanges:y,isName:v})}}else s.push({index:a.lp,endIndex:a.ywt,text:a.Awt,type:a._type,subType:a.Twt,canDrag:!1,ranges:a.ranges,value:a.Awt})}catch(n){s.push({index:a.lp,endIndex:a.ywt,text:a.Awt,type:a._type,subType:a.Twt,canDrag:!1,ranges:a.ranges,value:a.Awt})}return s}function _n(n,t,i,e,r){var f,n,t,n,o,o,i,f=i[e];return f&&"function"!=typeof f&&0===f._type&&(t=n.resolveToken(t,i,n=[],e)-1,1===(o=(n=n[0]).type)||13===o||8===o||5===o||22===o&&n.source)?(o=i[t],i={lp:f.lp,ywt:o.ywt,WK:n},r.push(i),t):e}t=this&&this.__extends||(r=function(n,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,t){n.__proto__=t}:function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}))(n,t)},function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=n}r(n,t),n.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Object.defineProperty(d,"__esModule",{value:!0}),d.getExpressTokenImp=d.Vgt=d.fillBlankToTokens=d.getValidaColumnName=d.StructureReferenceResolver=d.obt=d.StructReferenceColumnSpecifier=d.StructReferencePortions=d.SheetReferenceResolver=d.validateSheetName=d.maxColumnCount=d.maxRowCount=void 0,v=n("Core"),b=n("Common"),A=n("CalcEngine"),m=n("./dist/plugins/sheetsCalc/calc-spreadjs.js"),y=n("./dist/plugins/sheetsCalc/calc.ns.js"),x=n("./dist/plugins/sheetsCalc/external-reference.js"),R=b.Common.lt.ht,i=v.util.Vf,n=new b.Common.ResourceManager(v.SR),e=n.getResource.bind(n),d.maxRowCount=v.XmlConstants.Io,d.maxColumnCount=v.XmlConstants.xo,w=[1,26,676],C=void 0,j=null,c=["#all","#data","#headers","#totals","#this row"],p=[1,10,100,1e3,1e4,1e5,1e6,1e6],d.validateSheetName=A.Cmt,f=A.TokenResolver,t(k,f),k.prototype.resolveToken=function(n,t,i,e){var r,f,o,u,s,a,c,l,h,v,d,w,l,m,C,w,C,h,l,m,h,w,l,p,_,g,r=n.useR1C1,f=n.row||0,o=n.column||0,s=i.length,a=i[e],c=a.Awt,l=a._type,h=a.Twt;if(0!==l&&6!==h)return!1;if(0===l&&0===h&&e<s-2&&":"===i[e+1].Awt&&12===i[e+2].Twt&&i[e+2].Awt.indexOf(":")<0||0===l&&12===h){if(m=l=void 0,C=c.lastIndexOf(":"),w=c.lastIndexOf("]"),(c=b.Common.zf.fJ(c,"'")&&b.Common.zf.dT(c,"'")?c.substring(1,c.length-1):c)&&(w<C?(l=c.substring(0,C-1),m=c.substring(C)):("'"===(l=c).charAt(0)&&(l=l.substring(1,l.length-1)),0===h&&(m=i[e+2].Awt,e+=2,"'"===m.charAt(0))&&(m=m.substring(1,m.length-1)))),e++,w=!!l,(l=z(l))&&(v=(v=n.getExternalSource("",l))||X(l),m=z(m))&&(v instanceof x.ExternalSource?(d=v.getPeerSource(m)).Dfe=!0:d=(d=n.getExternalSource("",m))||X(m)),(a=i[e])&&"["===a.y4[0])return!1;if(!a)return N(c);c=a.Awt}if(C=e===s-1?j:i[e+1],Q(i,a,e,r,!0)){if(h=n&&n.source&&n.source.Lbt&&n.source.Lbt.allowDynamicArray,!(l=G(a.y4,r,f,o,h)).bwt&&!w)return!1;if(a.Twt=7,l.bwt&&l.wwt){if(m=l.Ky,h=l.iw,w=l.gwt,l=l.pwt,e<s-2&&5===C._type&&":"===C.Awt&&Q(i,C=i[e+2],e+2,r,!1)&&(p=G(C.y4,r,f,o)).bwt&&m===y.BAND_INDEX_CONST==(p.Ky===y.BAND_INDEX_CONST)&&h===y.BAND_INDEX_CONST==(p.iw===y.BAND_INDEX_CONST))return f=m===y.BAND_INDEX_CONST?0:f,o=h===y.BAND_INDEX_CONST?0:o,{index:e+3,expr:(0,A.lJ)(v,d,m-(w?f:0),h-(l?o:0),p.Ky-(p.gwt?f:0),p.iw-(p.pwt?o:0),w,l,p.gwt,p.pwt,f,o)};if(m===y.BAND_INDEX_CONST||h===y.BAND_INDEX_CONST){if(r)return m-=m!==y.BAND_INDEX_CONST&&w?f:0,h-=h!==y.BAND_INDEX_CONST&&l?o:0,{index:e+1,expr:(0,A.lJ)(v,d,m,h,m,h,w,l,w,l,f,o)};if(!v)return!1;u=N(c)}if(!u)return R(v)&&(v=K(n,f,o)),{index:e+1,expr:u=(0,A.knt)(v,d,_=m-(w?f:0),g=h-(l?o:0),w,l)}}else u=N(c)}else if(6===a.Twt)(u=new A.Expression(5)).value=A.CalcError.parse(a.Awt);else{if(!v||1===a._type)return!1;u=N(c)}return v&&(u.source=v),d&&(u.endSource=d),{index:e+1,expr:u}},k.prototype.unparse=function(n,t,i,e){var r=i&&i.type;return(1===r||8===r||5===r)&&(B(n,t,i,e),!0)},d.SheetReferenceResolver=k,(n=o=d.StructReferencePortions||(d.StructReferencePortions={}))[n.ThisRow=1]="ThisRow",n[n.Headers=2]="Headers",n[n.Data=3]="Data",n[n.Totals=8]="Totals",n[n.HeadersAndData=6]="HeadersAndData",n[n.DataAndTotals=12]="DataAndTotals",n[n.All=14]="All",n[n.NotSpecific=16]="NotSpecific",(n=u=d.StructReferenceColumnSpecifier||(d.StructReferenceColumnSpecifier={}))[n.All=1]="All",n[n.NotSpecific=1]="NotSpecific",n[n.SingleColumn=2]="SingleColumn",n[n.ColumnRange=4]="ColumnRange",s=A.Expression,t(I,s),I.prototype.tableName=function(){return this.abt.tableName()},Object.defineProperty(I.prototype,"baseTable",{get:function(){return this.abt},set:function(n){this.abt=n,this.source=n.source()},enumerable:!1,configurable:!0}),I.prototype.a0r=function(){var n=this.abt.x0r(this.ubt);return-1===n?0:n},I.prototype.columnReferenceStart=function(){return this.a0r()+this.abt.startColumn()},I.prototype.u0r=function(){var n=this.abt.x0r(this.sbt);return-1===n?this.abt.Tx:n},I.prototype.columnReferenceEnd=function(){return this.u0r()+this.abt.startColumn()},I.prototype.referencePortions=function(){return this.hbt},I.prototype.referenceColumnSpecifier=function(){return this.lbt},I.prototype.getRange=function(n,t,i,e){var r,f,o,u,s,a,c,l,h,v,d,w,m,C,p,r,p,r,p,_,f=this,o=f.abt,v=o.startRow(),d=o.endRow(),w=o.hasTotalsRow(),m=o.hasHeadersRow();switch(f.hbt){case 3:case 16:u=m?v+1:v,a=w?d-1:d;break;case 2:if(m)a=u=v;else{if(!i)return j;a=u=v-1}break;case 8:if(w)a=u=d;else{if(!i)return j;a=u=d+1}break;case 1:v+=m?1:0,d-=w?1:0,a=u=n,C=!1,e&&e.tables&&o&&o.Mf&&o.Mf.rt&&(p=o.Mf.rt.Lvt)&&(r=(r=e.tables.find(n,t))||e.tables.find(n,t-1))!==o&&r&&r.xkr&&r.xkr(n,t)&&(p=null!=(r=p.Skr)?r:v,o.$Gr)&&o.$Gr(p)&&(a=u=p,C=!0),!C&&o.xkr&&o.xkr(n,t)&&o.Mf&&(p=(r=o.Mf).rt&&r.rt.Lvt&&r.rt.Lvt.Skr,a=u=R(p)?v:p);break;case 6:u=v+(i&&!m?-1:0),a=w?d-1:d;break;case 12:u=m?v+1:v,a=d+(i&&!w?1:0);break;default:u=v+(i&&!m?-1:0),a=d+(i&&!w?1:0)}if(22===f.type){if(1===f.lbt)s=0;else if(s=f.abt.getColumnIndexInTable(f.ubt),c=f.abt.getColumnIndexInTable(f.sbt),-1===s||-1===c)return j}else s=f.columnReferenceStart(),c=f.columnReferenceEnd();return _=o.endColumn(),1===f.lbt&&(c=_),_<s||_<c?(f._error=!0,j):a<u||!i&&u<v||!i&&d<a?j:(0,A.Rwt)(u,s,l=a-u+1,h=c-s+1)},I.prototype.offsetWhenInsertRemoveColumn=function(n,t,i,e){var r,f,o,r=this,f=r.offset(0,0,!0);if(!i){if(r.ubt&&-1===(o=r.abt.getColumnIndexInTable(r.ubt)))return A.kyt;if(r.sbt&&-1===(o=r.abt.getColumnIndexInTable(r.sbt)))return A.kyt}return f.ensureSingle=r.ensureSingle,f.wsr=r.wsr,f},I.prototype.offsetWhenCopy=function(n,t,i,e,r,f,o,u,s,a){var t,c,l,h,v,i,e,r,f,d,w,c=this,l=new m.SheetParserContext(t.Mf,t.Lbt.useR1C1,(0,A.eV)(i,e)),h=l.getTableByIndex(i,e),v=c.offset();return h&&(i=i-r,e=e-f,r=o-r,f=u-f,d=void 0,(d=(n===t?l:w=new m.SheetParserContext(n.Mf,n.Lbt.useR1C1,(0,A.eV)(i,e))).getTableByIndex(i,e))!==h)&&d===c.abt&&Z(d,r,f,s,a)&&Z(h,o,u,s,a)&&(v.baseTable=h),null!=(t=n.Mf)&&t.Y1r&&v.Bwt(n.Mf.Y1r),v.ensureSingle=c.ensureSingle,v.wsr=c.wsr,v},I.prototype.Bwt=function(n){var t,i,n,t=this;2===t.lbt&&n&&((i=((i=t.abt.getColumnIndexInTable(t.ubt))+n)%(n=t.abt.endColumn()-t.abt.startColumn()+1))<0&&(i+=n),t.ubt=t.sbt=t.abt.getColumnName(i))},I.prototype.offset=function(n,t,i){var e,r,e=this,r=new I;return r.baseTable=e.baseTable,r.ubt=e.ubt,r.sbt=e.sbt,r.hbt=e.hbt,r.lbt=e.lbt,r.ensureSingle=e.ensureSingle,r.wsr=e.wsr,r},I.prototype.Lwt=function(n,t){var i=this.abt;return n>=i.startRow()&&t>=i.startColumn()&&n<=i.endRow()&&t<=i.endColumn()},a=I,d.obt=a,h=A.TokenResolver,t(O,h),O.prototype.resolveToken=function(n,t,i,e){var r,i,f,o,r,u,s,r,i,r=i[e],i=i[e+1];if(0===r._type){if(o=f=void 0,0===r.Twt||7===r.Twt)f=r.Awt;else{if(12!==r.Twt||!i||0!==i._type||0!==i.Twt||"["!==i.y4[0])return j;f=(r="'"===(r=r.Awt)[0]?r.substr(1,r.length-2):r)+i.Awt,o=!0}if("]"===f.charAt(f.length-1))try{return u=new a,tn(n,f.split(""),u),u.baseTable?(u.abt.Mf.NMi&&((s=u).type=22,s.Iwt=nn),o?{index:e+2,expr:u}:u):new A.Expression(0)}catch(n){}else if(r=n.getTableByName&&n.getTableByName(f))return i=O.create(r),r.Mf.NMi&&(i.type=22,i.Iwt=nn),i}return j},O.prototype.unparse=function(n,t,i,e){var i,r,f,o,u,s,t,a,o,f,r,f,o;if(13!==i.type&&22!==i.type)return!1;if(r=(i=i).abt.Gwt,f=R(r)?i.abt.tableName():r,n.Sbt)o=i.getRange(n.row,n.column,!0),B(n,t,u=(0,A.lJ)(i.source,j,o.row,o.col,o.row+o.rowCount-1,o.col+o.colCount-1,!1,!1,!1,!1),e);else{if(t=e.length,22===i.type&&i.baseTable.Mf.xT)s=!0;else if(16===i.hbt&&1===i.lbt)return e.push(f),void(n.lyt&&e.push("[]"));(a=n.source===i.abt.source()&&i.Lwt(n.row,n.column))&&!n.lyt&&!i.abt.Mf.NMi||(o=R(r)?i.abt.tableName():r,(f=i.abt.Mf)&&f.NMi&&!(0,A.Cmt)(o.split(""))&&(o=(0,A.Y3e)(n,o.split(""),null).join("")+"!"),e.push(o)),e.push("["),16!==i.hbt&&(r=vn(i.hbt,1!==i.lbt,n.lyt),e.push(r)),1!==i.lbt&&(1===i.hbt&&!n.lyt||16===i.hbt||(6===i.hbt||12===i.hbt?e.push(", "):e.push(",")),(f=i.ubt)?f=M(f):s=!0,s||(4===i.lbt?(o=i.sbt)?(o=M(o),e.push("[",f,"]:[",o,"]")):s=!0:1===i.hbt&&!n.lyt&&!sn(f)||16===i.hbt?e.push(f):e.push("[",f,"]"))),s?(e.length=t,e.push("#REF!")):e.push("]")}return!0},O.create=function(n,t,i,e,r){void 0===t&&(t=o.NotSpecific),void 0===i&&(i=u.NotSpecific);var f=new a;return f.baseTable=n,f.hbt=t,0<=e&&(f.ubt=n.getColumnName(e)),0<=r&&(f.sbt=n.getColumnName(r)),f.lbt=i,f},d.StructureReferenceResolver=O,d.getValidaColumnName=M,l={"#all":14,"#data":3,"#headers":2,"#totals":8,"#this row":1},d.fillBlankToTokens=dn,d.Vgt=mn,d.getExpressTokenImp=pn},"./dist/plugins/sheetsCalc/sheetsCalc.entry.js":function(n,t,i){var e,r,e=this&&this.__createBinding||(Object.create?function(n,t,i,e){void 0===e&&(e=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(n,e,r)}:function(n,t,i,e){n[e=void 0===e?i:e]=t[i]}),r=this&&this.__exportStar||function(n,t){for(var i in n)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||e(t,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i("./dist/plugins/sheetsCalc/calc.ns.js"),t),r(i("./dist/plugins/sheetsCalc/parser-sheets.js"),t),r(i("./dist/plugins/sheetsCalc/calc-spreadjs.js"),t),r(i("./dist/plugins/sheetsCalc/formulaOperatorAdjustor.js"),t),r(i("./dist/plugins/sheetsCalc/worksheet-formula.js"),t),i("./dist/plugins/sheetsCalc/workbook-formula.js")},"./dist/plugins/sheetsCalc/workbook-formula.js":function(n,t,i){var e,X,t,r,w,v,J,y,R,f,d,i,x,j,N,k,m,I,G,U,A,P,O,E,M,c,S,H,i;function D(n){n.forEach(function(n){var t;delete n.Uw().G3})}function C(n,a,c,l){X.GC$.each(n,function(n,t){var i,e,r,f,o,u,t,s,i,i=t.getName(),e=t.getRow(),r=t.getColumn(),f=t.getExpression(),o=t.getComment(),u=t.getFormatter&&t.getFormatter(),t=t.getSheetTabName&&t.getSheetTabName();f&&(i={name:i,formula:s=u||a.unparse(c,f,e,r,!1,!0),sheetTabName:t,row:e,col:r},o&&(i.comment=o),l.push(i))})}function $(n,t){var n,i,e,n=I(n);if("str"===t)i=n;else if("b"===t)i="1"===n;else if("e"===t){switch(e=N,n){case"#DIV/0!":e=7;break;case"#N/A":e=42;break;case"#NAME?":e=29;break;case"#NULL!":e=0;break;case"#NUM!":e=36;break;case"#REF!":e=23;break;case"#VALUE!":e=15}i=e!==N?{error:n,code:e}:N}else i=n===N?N:parseFloat(n);return i}e=this&&this.__assign||function(){return(e=Object.assign||function(n){for(var t,i,e,r,i=1,e=arguments.length;i<e;i++)for(r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)},Object.defineProperty(t,"__esModule",{value:!0}),X=i("Core"),t=i("Common"),r=i("CalcEngine"),w=i("./dist/plugins/sheetsCalc/calc-spreadjs.js"),v=i("./dist/plugins/sheetsCalc/calc-spreadjs.js"),J=i("./dist/plugins/sheetsCalc/external-reference.js"),y=i("./dist/plugins/sheetsCalc/calc-extra-save.js"),R=i("./dist/plugins/sheetsCalc/worksheet-formula.js"),f=w.SpreadSource,d=t.Common.zf.Gmt,i=new t.Common.ResourceManager(X.SR),x=i.getResource.bind(i),j=void 0,N=null,k=t.Common.lt.ht,m=X.mt.o1,I=X.mt.c1,G=X.mt.xr,U=X.mt.go,A=X.Util.Sr,P=X.IndexHelper.$i,O=X.Util.mr,E=X.mt.n1,M=X.Util.io,c=X.mt.St,S=X.XFileConstants.mo,H=X.XFileConstants.Ki,(i=X.Workbook.prototype).Qp=function(n){var t,i,t=this,i=t.Lp;t.Lp=new r.CalcService,t.Lp.useR1C1=1===t.options.referenceStyle,t.Lp.allowDynamicArray=t.options.allowDynamicArray,t.Lp.iterativeCalculation=t.options.iterativeCalculation,t.Lp.iterativeCalculationMaximumIterations=t.options.iterativeCalculationMaximumIterations,t.Lp.calculationMode=t.options.calculationMode,t.Lp.iterativeCalculationMaximumChange=t.options.iterativeCalculationMaximumChange,n&&i&&t.Lp.cloneFrom(i),t.yC=new f(t),t.wC=t.Lp.getGlobalSourceModel(t.yC)},i.addCustomFunction=function(n){this.Uwt(n)},i.Uwt=function(n){if(!(n&&n instanceof r.Functions.Function))throw new Error(x().Exp_InvalidCustomFunction);n.name=d(n.name),this.Amt[n.name]=n},i.getCustomFunction=function(n){return n?this.Amt[d(n)]:j},i.internalGetCustomFunctions=function(){return e({},this.Amt)},i.removeCustomFunction=function(n){n&&delete this.Amt[d(n)]},i.clearCustomFunctions=function(){this.Amt={}},i.addCustomName=function(n,t,i,e,r,f){this.zwt(this.hyt,n,t,i,e,!1,r,f)},i.Vwt=function(n){return!this.hyt[d(n)]},i.isValidCustomName=function(n){return n&&X.mt.P0(n)&&this.Vwt(n)},i.pp=function(n,t,i,e,r,f,o,u){var s,a,s=this;if(!t||!i)throw new Error(x().Exp_InvalidCustomName);u&&s.Lp&&c(i)?(a=u.Ywt(i,e,r),n[d(t)]=new v.FormatterNameInfo(t,i,u.name(),a,e,r)):s.zwt(n,t,i,e,r,f,o)},i.zwt=function(n,t,i,e,r,f,o,u,s){var a=this;if(!t||!i||!f&&!a.isValidCustomName(t))throw new Error(x().Exp_InvalidCustomName);a.$_r(n,t,i,e,r,{ignoreError:f,comment:o,isReadOnly:u,backup:s})},i.$_r=function(n,t,i,e,r,f){var o,u,s,a,c,f,l,l,h,l,c,o=this;if(o.Lp){if(u=f.ignoreError,s=f.comment,a=f.isReadOnly,c=f.backup,f=f.ignoreModelChange,l=(l=(0,X.jf)(this))?l.Uw():N,h=void 0,u)try{h=o.Lp.parse(l,i,e,r,!1,!0,!0,j,!0)}catch(n){}else h=o.Lp.parse(l,i,e,r,j,j,j,j,!0);l=void 0,c?(l=c).SB(h,j,e,r,{ignoreModelChange:!0}):l=new v.NameInfo(t,h,e,r,s,a,o),n[d(t)]=l,f||o.$Dr({type:"setCustomName",name:t,value:{formula:i,comment:s,isReadOnly:a,baseRow:e,baseCol:r}}),h&&(0,R.addNameInName)(o,h,l),u||((c={})[t]=t,this.Zwt(c,!0))}},i.Wwt=function(n,t,i,e,r,f,o,u){var s,i,n,s=this;if(!t||!i||!o&&!s.isValidCustomName(t))throw new Error(x().Exp_InvalidCustomName);s.Lp&&(i=n[d(t)]=new v.NameInfo(t,e,r,f,u,j,s),e&&(0,R.addNameInName)(s,e,i),o||((n={})[t]=t,this.Zwt(n,!0)))},i.getCustomName=function(n){return n?this.hyt[d(n)]:j},i.dBe=function(e,r,n,t,i,f){var o,o,u,s,a,o,o,c,l,h,o,o,v,o,u=this;if(t=null!=t?t:0,i=null!=i?i:0,u.Lp){if(s=u.hyt[d(e)])if(a=void 0,n&&(o=(o=(0,X.jf)(this))?o.Uw():N,a=u.Lp.parse(o,n,t,i,j,j,j,j,!0)),r&&e!==r){if(!u.isValidCustomName(r))throw new Error(x().Exp_InvalidCustomName);if(c=[],l=[],h=[],(o=u.vBe)&&o.forEach(function(n,t){var i=!1;n.forEach(function(n){n.value!==e||n.source||(l.push(n),i=!0),n.value!==r||n.source||h.push(n)}),i&&c.push(t)}),2===(o=null==(o=u.wC)?void 0:o.rBe(e,r,0<l.length,0<h.length)))throw new Error(x().Exp_CustomNameBothInUse);u.suspendCalcService(),(s=u.hyt[d(e)]).btV(r),u.hyt[d(e)]&&(delete u.hyt[d(e)],u.$Dr({type:"setCustomName",name:e,value:N})),u.hyt[d(r)]=s,u.q_r(s),l.forEach(function(n){n.value=r}),c.forEach(function(n){u.q_r(n)}),u.wC.updateNameCalc(r,!0),a?(v=u.hyt[d(r)],u.removeCustomName(r),u.zwt(u.hyt,r,n,t,i,!1,f,s.isReadOnly(),v)):(s.X_r(f),u.q_r(s)),3!==o||a||((o={})[r]=r,this.Zwt(o,!0)),u.resumeCalcService()}else a?(u.suspendCalcService(),v=u.hyt[d(e)],u.removeCustomName(e),u.zwt(u.hyt,e,n,t,i,!1,f,s.isReadOnly(),v),u.resumeCalcService()):(s.X_r(f),u.q_r(s));null!=(o=(0,X.jf)(this))&&o.zw()}},i.q_r=function n(t){this.$Dr({type:"setCustomName",name:t.getName(),value:{expr:t.getExpression(),baseRow:t.getRow(),baseCol:t.getColumn(),comment:t.getComment(),isReadOnly:t.isReadOnly()}})},i.xO=function(n){return n?this.bp[d(n)]:j},i.getCustomNames=function(){var i=[];return X.GC$.each(this.hyt,function(n,t){i.push(t)}),i},i.Qwt=function(){var i=[];return X.GC$.each(this.bp,function(n,t){i.push(t)}),i},i.removeCustomName=function(n){var t,i,t;n&&(i=this.hyt[d(n)],null!=(t=this.vBe)&&t.delete(i),delete this.hyt[d(n)],i&&this.$Dr({type:"setCustomName",name:n,value:N}),(t={})[n]=n,this.Zwt(t,!1))},i.o3=function(n){var t;n&&(delete this.bp[d(n)],(t={})[n]=n,this.Zwt(t,!1))},i.clearCustomNames=function(){this.aEr()},i.aEr=function(n){var t,i,e,t=this.hyt;if(this.vBe)for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e=t[i],this.vBe.delete(e));this.hyt={},null!=n&&n.ignoreModelChange||this.$Dr({type:"clearCustomName"}),this.Zwt(t,!1)},i.getNameInfos=function(){return this.hyt},i.setNameInfos=function(n){k(n)||(this.hyt=n)},i.Kwt=function(){var n=this.bp;this.bp={},this.Zwt(n,!1)},i.Zwt=function(n,t){var i,e,n;if(n){for(e in i=this.wC,n)i&&i.updateNameCalc(e,t);this.Lp&&!this.Lp.IsSuspended()&&(n=this.getActiveSheet())&&(n.suspendPaint(),this.Lp.recalculateAll(!1),n.resumePaint()),this.ki(X.Events.CustomNameChangedInternal,{})}},i.calculate=function(n,t){var i,e,r,f,o,u,s,a,c,l,h,v,d,n,i=this,e=i.op();if(e){switch(f=!(r=j),n){case X.CalculationType.rebuild:r=!0;break;case X.CalculationType.minimal:f=r=!1;break;case X.CalculationType.regular:r=!1}if(this.suspendPaint(),k(t)){if(e.suspend(!0),r)for(o=void 0,o=i.sheets||[],(0,R.resetCustomName)(i.hyt,N,e,i),(0,R.resetFormatStringCustomName)(i,i.bp,e),u=0;u<o.length;u++)for(a=(s=o[u]).Uw(),(0,R.resetCustomName)(s.hyt,a,e,i),l=(c=a.getCalcSourceModel()).getAllNodes(),h=0;h<l.length;h++)(d=(v=l[h]).calc)&&v.WK&&(0,R.adjustOneFormula)(e,d);e.resume(r,!f,!0)}else(s=i.getSheetFromName(t))?s.c3n(r,f):0<i.sheets.length&&(n=w.formulaToRanges(i.sheets[0],t,0,0,!0)[0]||w.formulaToRanges(i.sheets[0],t,0,0)[0])&&(s=i.getSheetFromName(n.sheetName)).c3n(r,f,n.ranges[0]);this.resumePaint()}},i.getCalcService=function(){return this.Lp},i.op=function(){return this.Lp},i.suspendCalcService=function(n){this.Lp&&this.Lp.suspend(n)},i.resumeCalcService=function(n){this.Lp&&this.Lp.resume(n)},i.getCircularReference=function(){return this.Lp.HBe()},i.updateExternalReference=function(n,t,i,e){this.suspendPaint(),this.suspendCalcService(),this._p._6(n,t,i,e),this.resumeCalcService(!1),this.resumePaint()},i.getExternalReferences=function(n){return this._p.myt(n)},X.Workbook.ch("calc",{priority:1e3,init:function(){this.Amt={},this.hyt={},this.bp={},this._p=new J.ExternalReferenceManager},toJson:function(n){var t,i,i,s,i,e,r,a,t,c,t=this,i=t.Amt;X.GC$.isEmptyObject(i)||(n.customFunctions=i),i=t._p.toJSON(t),X.GC$.isEmptyObject(i)||(n.externalReference=i),s=[],i=[],e=t.getCustomNames(),r=t.Qwt(),a=t.Lp,t=(0,X.Sp)(this),c=t?t.Uw():N,e&&a&&(X.GC$.each(e,function(n,t){var i,e,r,f,o,t,u,i,i=t.getName(),e=t.getRow(),r=t.getColumn(),f=t.getExpression(),o=t.isReadOnly(),t=t.getComment();f&&(i={name:i,formula:u=a.unparse(c,f,e,r,!1,!0,2),row:e,col:r},t&&(i.comment=t),"boolean"==typeof o&&(i.isReadOnly=o),s.push(i))}),C(r,a,c,i),0<s.length&&(n.names=s),0<i.length)&&(n.formatStringNames=i)},wh:function(n,t,o){var i,e,e,r,f,u,s,e,r,a,f,c,f,l,h,v,f,e,i=this,e=i.Amt;X.GC$.isEmptyObject(e)||(n.workbook.lossless.customFunctions=e),X.Util.ko(o)&&null!=o&&o.saveR1C1Formula&&(n.workbook.lossless.frc=1),i._p&&(r=(e=i._p.wh(n)).externalReferencesNode,f=e.externalLinks,0<(u=e.count))&&(n.workbook.c_.push(r),n.externalLinks=f),s=[],e=m(n.workbook,"definedNames"),r=i.getCustomNames(),a=i.Lp,f=(0,X.Sp)(this),c=f?f.Uw():N,f=i.yC,l=f&&f.getUsedCustomNames()||{},r&&0<r.length&&a&&(e||n.workbook.c_.push(e={n_:"definedNames",c_:[]}),h=e.c_,v=!o||!1!==o.includeUnusedNames,X.GC$.each(r,function(n,t){var i,e,r,t,f,i,t,i=t.getName(),e=t.getExpression(),r=t.isReadOnly(),t=t.getComment();e&&(v||l[i])&&(f=a.unparse(c,e,0,0,!1,!0,2),i=X.Util.xAe({name:i,comment:t,isReadOnly:r},f),o&&o.includeCalcModelCache&&(t=(0,y.exprToJSON)(e),s.push(t),i.e=s.length-1),h.push(i))})),0<s.length&&(n.workbook.lossless.exprs=s),f=[],(e=i.Qwt())&&0<e.length&&a&&(C(e,a,c,f),0<f.length)&&(n.workbook.lossless.formatStringNames=f),n.workbook.lossless.idMap=(0,y.dbt)(a)},preFromSJSFormat:function(n,T,V){var t,i,e,r,f,o,u,s,a,c,l,h,v,u,d,w,m,C,p,_,g,b,y,x,R,j,N,k,I,A,O,E,M,S,S,E,D,F,Y,L,t=G(n.workbook,"externalReferences"),i=n.externalLinks;if(t&&i&&t.c_&&0<t.c_.length){for(r in e={},i)if(i.hasOwnProperty(r)){if(f=i[r],o={},u=G(f,"externalBook")){if(a=[],(s=G(u,"sheetNames"))&&s.c_&&s.c_.length){for(c=0,l=s.c_.length;c<l;c++)(h=s.c_[c])&&(v=h.val)&&(v=X.mt.kfe(v),a.push(v));o.sheetNames=a}if(u=G(u,"sheetDataSet")){if(d={},w=U(u,X.XFileConstants.bo))for(m=0,C=w.length;m<C;m++)if(_=+(p=w[m]).sheetId,g=!!p.refreshError,b=d[v=a[_]]={},g&&(b.isNew=!0),y=U(p,"row"))for(x=0,R=y.length;x<R;x++)if((j=y[x])&&(k=b[N=j.r-1]=b[N]||{},I=U(j,"cell")))for(A=0,O=I.length;A<O;A++)M=void 0,(E=I[A])&&((S=E.r)&&(M=P(S)),S=E.t,D=void 0,(E=G(E,"v"))&&(D=$(E,S)),k[M]=D);o.data=d}}o.option=f.option,e[r]=o}for(F={},L=(Y=t.c_).length,c=0;c<L;c++)F[c+1]=e[Y[c][H]];this._p=new J.ExternalReferenceManager(F)}},yh:function(r,i,e){var f,t,o,u,n,s,a,c,l,h,v,d,w,m,C,C,p,_,g;function b(){var n,n;return t||(n=(n=(0,X.jf)(f)||f.sheets[0])?n.Uw():N,t=n&&n.getParserContext(!1)),t}if(o=(f=this).Lp,u=e&&!e.fullRecalc,n=X.Util.wo(e,f.v2),o&&(o.suspend(),o.lb=u),f.clearCustomNames(),(s=f.sheets).forEach(function(n){n.Uw().G3=!0}),a=r.workbook.lossless,e&&(e.$wt=(0,y.vbt)(o,a)),(c=i.workbookNames)&&0<c.length&&c.forEach(function(n){var t=E(n.name),i=I(n),e=E(n.comment),r=n.isReadOnly;a&&a.exprs&&a.exprs[n.e]?f.Wwt(f.hyt,(0,R.convertBuiltInNameToDisplayName)(t),""+O(E(i)),(0,y.exprFromJSON)(a.exprs[n.e],b()),0,0,!0,e,!0):i&&f.zwt(f.hyt,(0,R.convertBuiltInNameToDisplayName)(t),""+O(E(i)),0,0,!0,e,r)}),f.Kwt(),l=a&&a.formatStringNames)for(h=0;h<l.length;h++)v=l[h],k(v.sheetTabName)&&f.pp(this.bp,v.name,v.formula,v.row,v.col,!0,v.comment,j,!0);if(f.clearCustomFunctions(),d=a&&a.customFunctions)for(w in d)d.hasOwnProperty(w)&&(m=d[w],C=(0,X.getTypeFromString)(m.typeName))&&((C=new C).fromJSON(m),f.Uwt(C));n||(p=[],_=r.workbook.rels&&r.workbook.rels.c_,(g=G(r.workbook,S).c_).forEach(function(n){var t,t,n,n,n,i,e,t=M(E(n.name)),t=f.getSheetFromName(t)||f.Gm(t),n=n[H],n=A(_,n),n=n&&n.Target;t&&n&&(i=f.getSheetRelsName(n),e=void 0,e=(-1<n.indexOf("xl/chartsheets")?r.chartsheets:r.sheets)[i],p.push({sheet:3===t._gi?t.getTemplate():t,sheetData:e}))}),p.forEach(function(n){var t=n.sheet,n=n.sheetData;t&&t.nameFunctionFromSJSFormat&&t.nameFunctionFromSJSFormat(n,i,e)}),p.forEach(function(n){var t=n.sheet,n=n.sheetData;t&&t.formulaFromSJSFormat&&t.formulaFromSJSFormat(n,i,e)})),e.incrementLoadTask.addTask(function(n,t,i){o&&(u?o.resumeWithoutCalc():o.resume(!1,!1,!o.calcOnDemand),delete o.lb),D(s)},[o,r,e],u?j:x().STEP.startCalc,function(){return u?X.STEP_RATE.end:X.STEP_RATE.loadFileData+X.STEP_RATE.parseFile+X.STEP_RATE.loadSheetDataWithCalc+X.STEP_RATE.loadSheetFormulaWithCalc})},Mb:function(r,i,e){var f,o,u,n,s,t,a,c,l,h,v,d,w,m,m,C,p,_,f=this,o=f.Lp,u=e&&!e.fullRecalc,n=X.Util.wo(e,f.v2);if(o&&(o.suspend(),o.lb=u),f.clearCustomNames(),(s=f.sheets).forEach(function(n){n.Uw().G3=!0}),t=r.workbook.lossless,(a=i.workbookNames)&&0<a.length&&a.forEach(function(n){var t=E(n.name),i=I(n),e=E(n.comment),n=n.isReadOnly;i&&f.zwt(f.hyt,(0,R.convertBuiltInNameToDisplayName)(t),""+O(E(i)),0,0,!0,e,n)}),f.Kwt(),c=t&&t.formatStringNames)for(l=0;l<c.length;l++)h=c[l],k(h.sheetTabName)&&f.pp(this.bp,h.name,h.formula,h.row,h.col,!0,h.comment,j,!0);if(f.clearCustomFunctions(),v=t&&t.customFunctions)for(d in v)v.hasOwnProperty(d)&&(w=v[d],m=(0,X.getTypeFromString)(w.typeName))&&((m=new m).fromJSON(w),f.Uwt(m));n||(C=[],p=r.workbook.rels&&r.workbook.rels.c_,(_=G(r.workbook,S).c_).forEach(function(n){var t,t,n,n,n,i,e,t=M(E(n.name)),t=f.getSheetFromName(t)||f.Gm(t),n=n[H],n=A(p,n),n=n&&n.Target;t&&n&&(i=f.getSheetRelsName(n),e=void 0,e=(-1<n.indexOf("xl/chartsheets")?r.chartsheets:r.sheets)[i],C.push({sheet:3===t._gi?t.getTemplate():t,sheetData:e}))}),C.forEach(function(n){var t=n.sheet,n=n.sheetData;t&&t.nameFunctionFromSJSFormat&&t.nameFunctionFromSJSFormat(n,i,e)}),C.forEach(function(n){var t=n.sheet,n=n.sheetData;t&&t.formulaFromSJSFormat&&t.formulaFromSJSFormat(n,i,e)})),e.incrementLoadTask.addTask(function(n,t,i){var e;o&&(u?o.resumeWithoutCalc():(o.resume(!1,!1,!o.calcOnDemand),delete o.tMt,(e=f.getActiveSheet())&&e.zw()),delete o.lb),D(s)},[o,r,e])},preFromJson:function(n,t,i){this._p=new J.ExternalReferenceManager(n.externalReference)},fromJson:function(n,t,i){var e,r,f,o,u,s,a,c,l,h,v,d,w,m,C,p,_,g,g,b,y,x,e=this,r=e.Lp,f=n.noRecalc||i&&i.doNotRecalculateAfterLoad;if(r&&(r.suspend(),r.lb=f),e.clearCustomNames(),a=[],s=n.sheets)for(l in s)"string"==typeof l&&(h=s[l],u=e.getSheetFromName(h.name||l))&&(u.Uw().G3=!0);if(v=n.names)for(d=0;d<v.length;d++)w=v[d],e.zwt(this.hyt,(0,R.convertBuiltInNameToDisplayName)(w.name),w.formula,w.row,w.col,!0,w.comment,w.isReadOnly);if(m=n.formatStringNames)for(d=0;d<m.length;d++)w=m[d],k(w.sheetTabName)&&e.pp(this.bp,w.name,w.formula,w.row,w.col,!0,w.comment);if(e.clearCustomFunctions(),C=n.customFunctions)for(p in C)C.hasOwnProperty(p)&&(_=C[p],g=(0,X.getTypeFromString)(_.typeName))&&((g=new g).fromJSON(_,t),e.Uwt(g));if(s){for(l in o=0,s)"string"==typeof l&&(h=s[l],u=e.getSheetFromName(h.name||l))&&(a.push(u),u.nameFunctionsFromJSON(h,t,i),o++);for(c=a.length,o=0;o<c;o++)(u=a[o]).formulaFromJSON(s[u.name()],t,i)}for(r&&(f?r.resumeWithoutCalc():(r.resume(!1,!1,!r.calcOnDemand),delete r.tMt),delete r.lb),b=0,y=a;b<y.length;b++)delete(x=(u=y[b]).Uw()).G3},Yp:function(n,t,i){var u,s,a,e,c,r,l,f,o,h,v,d,w,m,C,p,_,g,g,u=this,s=u.Lp,a=n.noRecalc||i&&i.doNotRecalculateAfterLoad;if(s&&(s.suspend(),s.lb=a),u.clearCustomNames(),r=n.sheets,l=[],r)for(o in r)"string"==typeof o&&(h=r[o],c=u.getSheetFromName(h.name||o))&&(c.Uw().G3=!0);if(v=n.names)for(d=0;d<v.length;d++)w=v[d],u.zwt(this.hyt,(0,R.convertBuiltInNameToDisplayName)(w.name),w.formula,w.row,w.col,!0,w.comment,w.isReadOnly);if(m=n.formatStringNames)for(d=0;d<m.length;d++)w=m[d],k(w.sheetTabName)&&u.pp(this.bp,w.name,w.formula,w.row,w.col,!0,w.comment);if(u.clearCustomFunctions(),C=n.customFunctions)for(p in C)C.hasOwnProperty(p)&&(_=C[p],g=(0,X.getTypeFromString)(_.typeName))&&((g=new g).fromJSON(_,t),u.Uwt(g));if(r){for(o in e=0,r)"string"==typeof o&&(h=r[o],c=u.getSheetFromName(h.name||o))&&(l.push(c),c.nameFunctionsFromJSON(h,t,i),e++);for(f=l.length,e=0;e<f;e++)(c=l[e]).formulaFromJSON(r[c.name()],t,i)}i.incrementLoadTask.addTask(function(n,t,i){var e,r,f,o;for(s&&(a?s.resumeWithoutCalc():(s.resume(!1,!1,!s.calcOnDemand),delete s.tMt,(e=u.getActiveSheet())&&e.zw()),delete s.lb),r=0,f=l;r<f.length;r++)delete(o=(c=f[r]).Uw()).G3},[s,n,i])}})},"./dist/plugins/sheetsCalc/worksheet-formula.js":function(r,n,t){var i,f,g,e,A,v,b,w,O,y,C,d,_,t,x,R,o,X,u,J,G,m,p,j,N,t,s;function U(n){return"="===n.charAt(0)}function P(n){var t,i;return{left:n.indexOf("["),right:n.indexOf("]")}}function H(n){var n=P(n),t=n.left,n=n.right;return 0<=t&&t<n}function $(n){var t=P(n),i=t.left,t=t.right,n=n.indexOf("@");return i<n&&n<t}function B(n){return U(n)&&$(n)}function W(n){return U(n)&&H(n)}function q(n,t){var i,e;if(n.NMi){if(W(t=t.trim()))return 1;if(0<=t.indexOf("{{")&&0<=t.indexOf("}}"))for(i=t.split(/{{|}}/),e=0;e<i.length;e++)if(W(i[e].trim()))return 1}}function z(n,t,i,e){return i===y&&(i=n.getActiveRowIndex()),n.NMi.nMt(t,i,e)}function K(n){return n.columnRelative}function Q(n){return n.endColumnRelative}function Z(n){return n.rowRelative}function nn(n){return n.endRowRelative}function k(n){return n.op()}function h(n){return n.toUpperCase()===o?u:n}function tn(){var n=this;n.eMt?n.eMt=!1:(n.Amt={},n.hyt={},n.iMt?n.iMt.clearAll():n.T3=new v.SheetSource(n,g.SheetArea.colHeader),n.rMt?n.rMt.clearAll():n.A3=new v.SheetSource(n,g.SheetArea.rowHeader),n.oMt?n.oMt.clearAll():n.qgt=new v.SheetSource(n,g.SheetArea.viewport))}function en(n,t){var n,i,n=n.Uw(),i;(n&&n.t8.Rme(-1,-1,-1,-1)).forEach(function(n){n.isValid||(t.spillCells=t.spillCells||{},t.spillCells[n.minX+","+n.minY]=1)})}function a(n,t,i,e,r,f){var n=n.iT(t,i,e,r,f),t=n&&n.formulas;return t&&0<t.length}function rn(n,t,i,e,r,f,o){var u=a(n,t,i,e,r,3);return!u&&f&&(r=n.getColumnCount(2),u=a(n,t,0,e,r,2)),!u&&o&&(e=n.getRowCount(1),u=a(n,0,i,e,r,1)),u}function fn(n){for(var t,i,e,r,f,t=[],i=[],e=0;e<n.length;e++)f=""+(r=n[e]).row+r.col+r.rowCount+r.colCount+r.sheetName,t.indexOf(f)<0&&(t.push(f),i.push(r));return i}function on(n,t){var n=n.formulaLoad/n.total;return t?.4*n+.5:.3*n+.4}function un(n,t,i,e,r,f){var o,u,s,a,c,a,c,o=e.Uw(),u=n&&n.formula;u&&(s=void 0,"object"==typeof u&&(a=e.b3(f),(c=e.Xbt[u.si]).baseRow===t&&c.baseColumn===i?(u=c.formula,c.n1e=!0):c.n1e?(s=a.pB(c.baseRow,c.baseColumn))?(s.aMt=u.si,e.Lp.tMt&&e.Lp.tMt[o.id+","+c.baseRow+","+c.baseColumn]&&(e.Lp.tMt[o.id+","+t+","+i]={id:o.id,row:t,col:i})):(u=c.formula,c.baseRow=t,c.baseColumn=i):(u=c.formula,c.n1e=!0,c.baseRow=t,c.baseColumn=i)),(a=n.arrayInfo)&&!a.isDynamicArray?e.uMt(t,i,j(a.rowCount,10),j(a.colCount,10),u,!0,f):(c=o.getCalcSourceModel(),a&&o.t8.xji(a.row,a.col,a.rowCount,a.colCount,!a.isInvalid),e.zI(t,i,u,s,!0,f,!0,!a,y,!0),a&&c.Uyt(t,i,a)))}function I(n,t,i,e,r,f,o){var u,s,a,c,l,h,v,d,u,f,u=r&&r.incrementLoadTask;if(u&&!u.isTerminated){for(s=u.isBusyFunc,a=f=f||0,n.suspendPaint(),c=30,l=new Date;a<i;){if(h=t[a])for(v=0;v<e;v++)un(h[v],a,v,n,!0,o);if(a++,s&&s())break;if(30<(d=new Date)-l)break}n.resumePaint(),(u=(r=r||{})&&r.incrementalLoading)&&(u.loadStatus.formulaLoad+=a-f,f=on(u.loadStatus,r.doNotRecalculateAfterLoad),n.parent&&n.parent.ki(g.Events.ProgressChanged,{loadStatus:u.loadStatus,progress:f,sheet:n}),u.loading)&&u.loading(f,{sheet:n}),a<i&&r.incrementLoadTask.pushTask(I,[n,t,i,e,r,a])}}function c(n,t,i,e,r){for(var f,o,u,f=0;f<i;f++)if(o=t[f])for(u=0;u<e;u++)un(o[u],f,u,n,!0,r)}function sn(n,t){var i,e,r,f,o,u;if(t)for(i in t)if(t.hasOwnProperty(i))for(r in e=t[i])e.hasOwnProperty(r)&&(o=+i,u=+r,(f=e[r]).f)&&R(n.getValueIgnoreDefault(o,u))&&!n.getFormula(o,u)&&!n.getBindingPath(o,u)&&n.Ut.setDefaultValue(o,u,m(f.f),y,g.DefaultChangeValueType.Expression)}function an(n,t,i,e,r,f,o){var u,s,a,s,c,l,h,v,d,h,h,u=n.Uw(),s=n.Ut,a=s.ap||0,s=s.fp||0;t===y||(c=m(t.f),l=t.g,(h=t.r)!==y&&(v=G(h).toJSON()),0<=l&&(c=(c&&(h={formula:c},v&&(h.lastRow=v.rowCount+v.row-1,h.lastColumn=v.colCount+v.col-1,h.baseRow=v.row,h.baseColumn=v.col,v=O),f[l]||(f[l]=h,f.nextIndex=Math.max(f.nextIndex,l+1))),{si:l}),(h=n.Xbt[c.si]).baseRow===i&&h.baseColumn===e?(c=h.formula,h.n1e=!0):h.n1e?(d=r.pB(h.baseRow,h.baseColumn))?(d.aMt=c.si,n.Lp.tMt&&n.Lp.tMt[u.id+","+h.baseRow+","+h.baseColumn]&&(n.Lp.tMt[u.id+","+i+","+e]={id:u.id,row:i,col:e})):(c=h.formula,h.baseRow=i,h.baseColumn=e):(c=h.formula,h.n1e=!0,h.baseRow=i,h.baseColumn=e)),R(c))||(1==+t.a&&v&&(v.isDynamicArray=!0,o)&&o.spillCells&&o.spillCells[i+","+e]&&(v.isInvalid=!0),c=p(c),v&&!v.isDynamicArray?a<=i&&e<s?n.uMt(i,e,j(v.rowCount,10),j(v.colCount,10),c,!0,2):i<a&&s<=e?n.uMt(i,e,j(v.rowCount,10),j(v.colCount,10),c,!0,1):a<=i&&s<=e&&n.uMt(i,e,j(v.rowCount,10),j(v.colCount,10),c,!0,3):(v&&u.t8.xji(v.row,v.col,v.rowCount,v.colCount,!v.isInvalid),!d&&o&&o.exprs&&o.exprs[t.x]&&(d=(0,w.exprFromJSON)(o.exprs[t.x],u.getParserContext(!1)),o.exprs[t.x].nw)&&(d.sMt=!0),a<=i&&e<s?n.zI(i,e,c,d,!0,2,!0,!v):i<a&&s<=e?n.zI(i,e,c,d,!0,1,!0,!v):a<=i&&s<=e&&n.zI(i,e,c,d,!0,3,!0,!v,y,!0),v&&r.Uyt(i,e,v)))}function E(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,o,o,s,a=(f&&f.incrementLoadTask).isBusyFunc,c=o=o||0;for(n.suspendPaint(),n.suspendCalcService(),h=30,(l=f.openMode===g.OpenMode.incremental)&&(v=new Date),d=n.Xbt=n.Xbt||{nextIndex:0},w=n.b3(3);c<i;){if(m=t[c])for(C=0;C<e;C++)an(n,m[C],c,C,w,d,r);if(c++,!u&&a&&a())break;if(l&&(p=new Date,!u)&&30<p-v)break}n.resumeCalcService(),n.resumePaint(),f.loadStatus.formulaLoad+=c-o,l&&(o=f.loadStatus.formulaLoad/f.loadStatus.total,o=+(f.fullRecalc?.3*o+.5:.4*o+.6).toFixed(5),f.incrementLoadTask.progress)&&f.incrementLoadTask.progress({progress:o,sheetName:n.name(),step:_.I5(x().STEP.loadSheetFormula,[n.name()])}),c<i&&f.incrementLoadTask.pushTask(E,[n,t,i,e,r,f,c])}function cn(i,e,r,f){var n=g.Worksheet.fh;n&&C(n,function(n,t){var t=t.fromJsonAfterFormula;t&&t.call(i,e,r,f)})}function ln(i,e,r,f){var n=g.Worksheet.fh;n&&C(n,function(n,t){var t=t.fromJsonAfterSJSFormula;t&&t.call(i,e,r,f)})}function hn(t,i,e,n,r,f){var o,u,s,a,c,l,h,v,o=g.Worksheet.fh,u=!1,s=[],a=n.getReferenceSheetNames(),c=t&&t.v2,l=function(n,t){return n[t]===y||0===n[t]},h=function(n){var e;a.hasOwnProperty(n)&&(u=!0,e=(0,g._f)(t,n),l(c.sheetsState,n))&&l(c.refSheetsState,n)&&e&&(c.refSheetsState[n]=1,c.getSheet(n,function(i){var n,n,n=e.NMi;n?(n.yh(i,r,f),R(i.order)||(n.E0i=i.order),(n=(0,g.Ip)(n,i.lossless.addition,t.dataManager()))&&s.push(n)):(e.yh(i,r,f,!0),R(i.order)||(e.E0i=i.order)),o&&C(o,function(n,t){t.refSheetLazyLoaded&&t.refSheetLazyLoaded.call(e,i,r,f)})}))};for(v in a)h(v);u&&o&&C(o,function(n,t){t.afterRefSheetLazyLoaded&&t.afterRefSheetLazyLoaded.call(i,e,r,f)}),0<s.length&&f&&f.fullRecalc&&Promise.all(s).then(function(){t.suspendPaint(),t.mp[0].Mf.recalcAll(!0),t.resumePaint()})}function M(n,t,i,e){var r,f,o,o;if(n)for(r in n)(o=(f=n[r]).WK)!==y&&(e&&e.vBe&&e.vBe.delete(f),o=i.unparse(t,o,0,0),f.WK=i.parse(t,o,0,0,y,!0,y,y,!0),e)&&S(e,f.WK,f)}function vn(n,t,i){var e,r,f,o,u,s,e=n.getActiveSheet();if(e&&t)for(r in t)t.hasOwnProperty(r)&&(o=Cn(e,(f=t[r]).Zc,f.FY,f.jpt),(u=f.WK)!==y)&&(n.vBe&&n.vBe.delete(f),s=e.Uw(),f.WK=i.parse(s,o,f.FY,f.jpt,!1,!0,!0,y,!0),S(n,f.WK,f))}function S(n,t,i){var e=n.vBe=n.vBe||(0,A.createMap)();t.forEachNodes(function(n){var t;8===n.type&&((t=e.get(i))||(t=(0,A.createSet)(),e.set(i,t)),t.add(n))})}function dn(e,r){return function(n){var t,i,t,t=n.w3.rT;t&&t.Mf.xT||(i=(t?t.Mf:r).name(),t=(t?t.Mf:r)._id,e[t+" "+n.row+" "+n.column]={row:n.row,col:n.column,rowCount:1,colCount:1,sheetName:i})}}function wn(n){var t,i,t=[];for(i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t}function D(n,r,t,i,f,e,o,u){e&&n.lossless&&([n.lossless.colHeaderData,n.lossless.rowHeaderData].forEach(function(n,t){var t,n,i,e;n&&n.dataTable&&(n=n.dataTable,i=r.getRowCount(t=t+1),e=r.getColumnCount(t),o&&!u?I(r,n,i,e,f,0,t):c(r,n,i,e,t))}),n.lossless.defaultData)&&sn(r,n.lossless.defaultData),o&&!u?f.incrementLoadTask.pushTask(ln,[r,n,i,f]):ln(r,n,i,f)}function l(n,t,i){n&&"function"==typeof n.onCustomNameFormulaChanged&&n.onCustomNameFormulaChanged([{nameInfo:t.nameInfo,oldExpr:i,newExpr:t.expr}])}function mn(n){var t=f([],n.sheets,!0);return n.mp&&0<n.mp.length&&n.mp.forEach(function(n){n.Mf&&t.push(n.Mf)}),t}function Cn(n,t,i,e){var r,n,f,n,o,u,r=!!n.NMi,n=n.getCell(i,e,3),f=(0,v.rangeToFormula)(n,i,e,3),n=t.trim();if(0<=(n="="===n.charAt(0)&&0<=n.indexOf("@")&&!B(n)?n.replace(/@/g,f):n).indexOf("{{")&&0<=n.indexOf("}}")){for(""===(o=n.split(/{{|}}/))[0]&&o.shift(),""===o[o.length-1]&&o.pop(),u=0;u<o.length;u++)-1===o[u].indexOf("=")?o[u]='"'+o[u]+'"':r&&B(o[u])?o[u]=o[u].replace(/=/g,""):(0<=o[u].indexOf("@")&&(o[u]=o[u].replace(/@/g,f)),o[u]=o[u].replace(/=/g,""),o[u]="IF(ISERROR(".concat(o[u],'), "#N/A", ').concat(o[u],")"));n="=CONCAT("+o.join(",")+")"}return n}function pn(n,t,i,e){var r,f,o,o,u,o=null==n?void 0:n.baseTable;n&&o&&16===n.hbt&&1===n.lbt?(r=o.range(),f=o.Mf&&o.Mf.name()):9===n.type?(pn(n.value,t,i,e),pn(n.value2,t,i,e)):(o=i.MX.evaluateExpression(n,t.getEvaluatorContext({row:0,col:0},!1),!1,!0,!0))instanceof A.CalcReference&&(f=o.getSource().getName(),0<o.getRangeCount())&&(r=(0,g.Ec)(o.getRow(u=0),o.getColumn(0),o.getRowCount(0),o.getColumnCount(0))),r&&e.push({sheetName:f,range:r})}function F(n,t){var i,e,r,n;return!t||(i=n.getRow(),e=n.getColumn(),(n=n.getExpression().getRange(i,e))&&!(n=n instanceof g.Range?n:new g.Range(n.row,n.col,n.rowCount,n.colCount)).containsRange(t))}function T(r,f,o,u,s,a){var n,c,l,h,v,d,t,i,e,w,m,h=!u&&r.Ut.pj(),v=!!a;if(r.parent&&r.parent.sheets)for(d=mn(r.parent),t=r.parent.getCustomNames(),i=r.parent.Qwt(),e=!R(r.parent.fMt)&&r.parent.wJt(),t&&C(t,function(n,t){F(t,a)&&(c=t.getExpression(),(l=V(null,r,f,o,u,s,c,v))!==c)&&t.SB(l,h,y,y,{ignoreModelChange:!0})}),i&&C(i,function(n,t){F(t,a)&&(c=t.getExpression(),(l=V(null,r,f,o,u,s,c,v))!==c)&&t.SB(l,h,y,y,{ignoreModelChange:!0})}),e&&C(e,function(n,t){F(t,a)&&(c=t.getExpression(),(l=V(null,r,f,o,u,s,c,v))!==c)&&t.SB(l,h,y,y,{ignoreModelChange:!0})}),w=function(i){var e;(n=d[i].getCustomNames())&&(e=[],C(n,function(n,t){F(t,a)&&(c=t.getExpression(),(l=V(d[i],r,f,o,u,s,c,v))!==c)&&(t.SB(l,h,y,y,{ignoreModelChange:!0}),e.push({nameInfo:t,oldExpr:c,newExpr:l}))}),0<e.length)&&"function"==typeof d[i].onCustomNameFormulaChanged&&d[i].onCustomNameFormulaChanged(e)},m=0;m<d.length;m++)w(m);else(n=r.getCustomNames())&&C(n,function(n,t){F(t,a)&&(c=t.getExpression(),(l=V(r,r,f,o,u,s,c,v))!==c)&&t.SB(l,h,y,y,{ignoreModelChange:!0})})}function V(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,w,m,C,p,_,l,v,h,d,h,d,l,v,g,b,y,x,R,j,N,k,a,j,I;if(o){if(s=t.Uw(),a=(0,A.Syt)(A.Errors.Reference,s),9===o.type){if(l=o.value,h=o.value2,v=V(n,t,i,e,r,f,l,u),d=h&&V(n,t,i,e,r,f,h,u),l!==v||h!==d)return(0,A.rbt)(o.operatorType,v,d)}else if(7===o.type){for(w=!1,m=[],C=void 0,p=0;p<o.arguments.length;p++)_=V(n,t,i,e,r,f,C=o.arguments[p],u),w=w||C!==_,m.push(_);if(w)return(0,A.YJ)(o,m)}else if(1===o.type&&o.hmt()){if(c=o.source||n&&n.Uw(),h=l=o.row,d=v=o.column,c&&c===s&&(f&&!o.rowRelative||!f&&!o.columnRelative)){if(f&&r)l+=i<=l?e:0;else if(!f&&r)v+=i<=v?e:0;else if(f){if(i+e<=l)l-=e;else if(i<=l)return a}else if(i+e<=v)v-=e;else if(i<=v)return a;if(l!==h||v!==d)return(0,A.knt)(s,O,l,v,o.rowRelative,o.columnRelative)}}else if(1===o.type){if(c=o.source||n&&n.Uw(),h=o.row,d=o.column,l=o.endRow,v=o.endColumn,g=o.rowRelative,b=o.columnRelative,y=o.endRowRelative,x=o.endColumnRelative,R=h,j=d,N=l,k=v,c&&c===s){if(f&&r)h+=!g&&i<=h?e:0,l+=!y&&i<=l?e:0;else if(!f&&r)d+=!b&&i<=d?e:0,v+=!x&&i<=v?e:0;else if(f&&!r){if(!g&&i<=h&&!y&&l<i+e)return a;if(g&&y||l<i)return o;if(!g)if(i+e<=h)h-=e;else if(!(h<i)){if(y)return a;i<h&&(h=i)}if(!y)if(i+e<=l)l-=e;else{if(g)return a;l<i+e&&(l=i-1)}}else{if(!b&&i<=d&&!x&&v<i+e)return a;if(b&&x||v<i)return o;if(!b)if(i+e<=d)d-=e;else if(!(d<i)){if(x)return a;i<d&&(d=i)}if(!x)if(i+e<=v)v-=e;else{if(b)return a;v<i+e&&(v=i-1)}}if(d!==j||v!==k||h!==R||l!==N)return(0,A.lJ)(s,O,h,d,l,v,g,b,y,x)}}else if(10===o.type){if((a=o.value)!==(j=V(n,t,i,e,r,f,a,u)))return(0,A.Ayt)(j)}else 13===o.type&&(c=o.source||n&&n.Uw())&&c===s&&!f&&(o=o.offsetWhenInsertRemoveColumn(i,e,r,u));return o}}function Y(n,t){var i,e,r,f,o,u,s,a,t,c,e,i=t.w3,e=i.getSource(),o=-1,u=-1;t.name?(f=t.name,a=t.id,R(a)?r=i.getNodeByName(f):(r={WK:t.expression},s=!0)):(o=t.row,u=t.column,r=i.getNode(o=void 0===o?-1:o,u=void 0===u?-1:u)),t=r.WK,c=r.$bt,e=n.unparse(e,t,o<0?0:o,u<0?0:u),c&&(!0!==n.allowDynamicArray||!0===n.allowDynamicArray&&!c.isDynamicArray)?o===c.row&&u===c.col&&i.setArrayFormula(c.row,c.col,c.rowCount,c.colCount,e):f?s?i.setFormula(a,f,e):i.setFormulaByName(f,e):i.setFormula(o,u,e,null,!0,!0),r.WK.lMt=t.lMt}function _n(n){for(var t,i,e,r,f,o,u,s,a,c,l,h,v,d,t=k(n),i,e,r,f=[n.b3(g.SheetArea.colHeader),n.b3(g.SheetArea.rowHeader),n.b3(g.SheetArea.viewport)],o=0;o<f.length;o++){if(!(u=f[o]))return;for(s=u.getAllNodes(),a=0;a<s.length;a++)if(l=(c=s[a]).calc)for(h=l.aT,v=0;v<h.length;v++)(d=l[h[v]])&&d.forEach(function(n){n&&n instanceof A.PathCalc&&Y(t,n)})}}function gn(n,t,i,e,r,f,o,u,s,a,c,l,h){b.CalcOperatorAdjustor.copyFormula(n,t,i,e,r,f,o,u,s,a,c,l,h)}function bn(n,t){var n=n.offset(0,0,!1,0,0);return n.rowRelative=n.endRowRelative=n.columnRelative=n.endColumnRelative=t,n}function L(n,t,i,e,r,f,o,u,s,a,c){var l,h,v,d,w,m,C,p,_,l,h,v,d,l,h,d,v,l;if(a){if(9===a.type){if(l=a.value,h=a.value2,v=L(n,t,i,e,r,f,o,u,s,l,c),d=h&&L(n,t,i,e,r,f,o,u,s,h,c),l!==v||h!==d)return(0,A.rbt)(a.operatorType,v,d)}else if(7===a.type){for(w=!1,m=[],C=void 0,p=0;p<a.arguments.length;p++)_=L(n,t,i,e,r,f,o,u,s,C=a.arguments[p],c),w=w||C!==_,m.push(_);if(w)return(0,A.YJ)(a,m)}else if(1===a.type){if(l=!Z(a)&&!K(a),h=!nn(a)&&!Q(a),v=t.Uw(),(!a.source||a.source===v)&&l&&h)return d=r.Uw(),l=new b.MoveSwapInfo(v,i,e,d,f,o,u,s),h=bn(a,!0),l.R0i=!0,(d=(0,b.adjustFormulaOnMoveSwap)(v,0,0,h,l,!0,{tableExpand:c}))===h?a:1===d.type&&bn(d,!1)||d}else if(10===a.type&&(v=a.value)!==(l=L(n,t,i,e,r,f,o,u,s,v,c)))return(0,A.Ayt)(l);return a}}function yn(n,t){var i,e,r,f,o,u,s,a,i=n.printInfo&&n.printInfo();if(i)for(e=t.split(","),r=0;r<e.length;r++)for(f=(0,v.formulaToRanges)(n,e[r],0,0),o=0;o<f.length;o++)for(u=f[o].ranges,s=0;s<u.length;s++)-1===(a=u[s]).col||-1===a.colCount?(i.repeatRowStart(a.row),i.repeatRowEnd(a.row+a.rowCount-1)):-1!==a.row&&-1!==a.rowCount||(i.repeatColumnStart(a.col),i.repeatColumnEnd(a.col+a.colCount-1))}function xn(n,t,i,e,r,f){var n=n[t];n&&(e=n.rT,R(r)||(e.Wbt=r),n.toJSON({data:i},f),delete e.Wbt)}function Rn(n,t,i,e,r,f){n&&(t&&!t.fullRecalc?n.resumeWithoutCalc():n.resume(!1,!1,!n.calcOnDemand),delete n.lb),delete i.G3,f.resumePaint()}i=this&&this.__assign||function(){return(i=Object.assign||function(n){for(var t,i,e,r,i=1,e=arguments.length;i<e;i++)for(r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)},f=this&&this.__spreadArray||function(n,t,i){if(i||2===arguments.length)for(var e=0,r=t.length,f;e<r;e++)!f&&e in t||((f=f||Array.prototype.slice.call(t,0,e))[e]=t[e]);return n.concat(f||Array.prototype.slice.call(t))},Object.defineProperty(n,"__esModule",{value:!0}),n.QB=n.XB=n.adjustOneFormula=n.hMt=n.convertFormatStringFormula=n.addNameInName=n.resetFormatStringCustomName=n.resetCustomName=n.dMt=n.convertBuiltInNameToDisplayName=void 0,g=t("Core"),e=t("Common"),A=t("CalcEngine"),v=t("./dist/plugins/sheetsCalc/calc-spreadjs.js"),b=t("./dist/plugins/sheetsCalc/formulaOperatorAdjustor.js"),w=t("./dist/plugins/sheetsCalc/calc-extra-save.js"),O=null,y=void 0,C=g.GC$.each,d=e.Common.zf.Gmt,_=e.Common.zf,t=new e.Common.ResourceManager(g.SR),x=t.getResource.bind(t),R=e.Common.lt.ht,o="_XLNM.PRINT_AREA",X="PRINT_AREA",u="Print_Area",J=g.mt.xr,G=g.range_parser._c,m=g.mt.n1,p=g.Util.mr,j=parseInt,N=g.UsedRangeUtil.updateUsedRangeByData,n.convertBuiltInNameToDisplayName=h,n.dMt=c,(t=g.Worksheet.prototype).resetCalc=function(){tn.call(this),this.eMt=!0},t.c3n=function(n,t,i){var e,r,f,o,u,s,a,c,l,h,e=this,r=k(e);if(r){if(this.suspendPaint(),r.suspend(!0),f=this.Uw().getCalcSourceModel(),R(i)){if(n)for(M(e.hyt,e.Uw(),r,e.parent),o=f.getAllNodes(),u=0;u<o.length;u++)(a=(s=o[u]).calc)&&s.WK&&Y(r,a);e.oMt.Cde(n,!t),e.iMt.Cde(n,!t),e.rMt.Cde(n,!t)}else if(!1!==n||t)for(-1===i.row&&(i.row=0,i.rowCount=e.getRowCount()),-1===i.col&&(i.col=0,i.colCount=e.getColumnCount()),c=0;c<i.rowCount;c++)for(l=0;l<i.colCount;l++)(a=(s=f.getNode(c+i.row,l+i.col))&&s.calc)&&s.WK&&(n&&Y(r,a),!1!==n||t&&a.isVolatile)&&a.vyt();h=!1,1===r.calculationMode&&(h=i?function(n){return n.w3===e.oMt&&i.contains(n.row,n.column)}:function(n){return n.w3===e.oMt||n.w3===e.iMt||n.w3===e.rMt}),r.resume(!1,!0,h),this.resumePaint()}},t.recalcAll=function(n){var t,i,e,r,f,o,u,s,a,c,l,t=k(this);if(t){if(this.suspendPaint(),t.suspend(!0),n)for(e=void 0,e=(i=this.parent)&&i.sheets||[this],M(i&&i.hyt,this.Uw(),t,self.parent),r=0;r<e.length;r++)for(o=(f=e[r]).Uw(),M(f.hyt,o,t,self.parent),s=(u=o.getCalcSourceModel()).getAllNodes(),a=0;a<s.length;a++)(l=(c=s[a]).calc)&&c.WK&&Y(t,l);t.resume(n),this.resumePaint()}},n.resetCustomName=M,n.resetFormatStringCustomName=vn,t.recalcRange=function(n,t,i,e){var r=k(this);r&&r.recalcRange(this.Uw(),n,t,i,e)},t.recalcRows=function(n){var t,i,e,r,t=k(this);if(t&&!t.ignoreDirty()&&0<n.length){if(t.suspend(),i=n.reduce(function(n,t){return Math.min(n,t)}),e=n.reduce(function(n,t){return Math.max(n,t)}),n.length*n.length>e-i)t.recalcRange(this.qgt,i,-1,e-i+1,-1);else for(r=0;r<n.length;r++)t.recalculate(this.qgt,n[r],-1);t.resume(!1)}},t.recalcCols=function(n){var t,i,t=k(this);if(t&&!t.ignoreDirty()){for(t.suspend(),i=0;i<n.length;i++)t.recalculate(this.qgt,-1,n[i]);t.resume(!1)}},t.gL=function(n,t,i){var i,e,r,i,e=k(this);e&&!e.ignoreDirty()&&(r=this.qgt,1===i?r=this.T3:2===i&&(r=this.A3),(i=null==(i=null==r?void 0:r.t8)?void 0:i.getAnchorInfo(n,t))&&(n=i.row,t=i.col),e.recalculate(r,n,t))},t.getCalcService=function(){return this.Lp||(this.Lp=new A.CalcService,this.Uw(g.SheetArea.colHeader).setCalcService(this.Lp),this.Uw(g.SheetArea.rowHeader).setCalcService(this.Lp),this.Uw().setCalcService(this.Lp),this.Lp.initParserContext(this.Uw())),this.Lp},t.op=function(){return this.getCalcService()},t.suspendCalcService=function(n){var t=k(this);t&&t.suspend(n)},t.resumeCalcService=function(n){var t=k(this);t&&t.resume(n)},t.Uw=function(n){return R(n)||3===n?this.qgt:1===n?this.T3:2===n?this.A3:O},t.b3=function(n){var t=this;return 1===n?(!t.iMt&&t.T3&&(t.iMt=t.op().getSourceModel(t.T3)),t.iMt):2===n?(!t.rMt&&t.A3&&(t.rMt=t.op().getSourceModel(t.A3)),t.rMt):(!t.oMt&&t.qgt&&(t.oMt=t.op().getSourceModel(t.qgt)),t.oMt)},t.vMt=function(n,t,i,e,r){var r=this.b3(r);return r&&r.mMt(n,t,i,e,!0,!0)},t.KT=function(n,t,i,e,r,f){var o=this.vMt(n,t,i,e,3);return!o&&r&&(e=this.getColumnCount(2),o=this.vMt(n,0,i,e,2)),!o&&f&&(i=this.getRowCount(1),o=this.vMt(0,t,i,e,1)),o},t.iT=function(n,t,i,e,r){var r=this.b3(r);return r&&r.mMt(n,t,i,e,!1,!0)},t.mT=function(n,t,i,e,r,f,o){var u,r,u=(r=void 0===r?!0:r)&&this.KT(n,t,i,e,f,o),r=!r&&rn(this,n,t,i,e,f,o);return!u&&!r||(this.jT(4,x().Exp_ChangePartOfArray),!1)},t.addCustomFunction=function(n){this.Uwt(n),this.recalcAll()},t.Uwt=function(n){if(!(n&&n instanceof A.Functions.Function))throw new Error(x().Exp_InvalidCustomFunction);n.name=d(n.name),this.Amt[n.name]=n},t.getCustomFunction=function(n){return n?this.Amt[d(n)]:O},t.internalGetCustomFunctions=function(){return i({},this.Amt)},t.removeCustomFunction=function(n){n&&(delete this.Amt[d(n)],this.recalcAll())},t.clearCustomFunctions=function(){this.Amt={},this.recalcAll()},t.Jbt=function(n){var t,i,t;return n?(i=(t=this).parent,!(t=t.getCustomFunction(n))&&i&&i.getCustomFunction?i.getCustomFunction(n):t):O},t.addCustomName=function(n,t,i,e,r,f){this.zwt(n,t,i,e,!1,r,f)},t.getCustomName=function(n){return n?this.hyt[d(n)]:y},t.dBe=function(e,r,n,t,i,f){var o,o,u,s,a,c,l,h,o,o,v,o,u=this;if(t=null!=t?t:0,i=null!=i?i:0,u.Lp){if(s=u.hyt[d(e)])if(a=void 0,n&&(a=u.Lp.parse(u.Uw(),n,t,i,y,y,y,y,!0)),r&&e!==r){if(!u.isValidCustomName(r))throw new Error(x().Exp_InvalidCustomName);if(c=[],l=[],h=[],(o=u.parent.vBe)&&o.forEach(function(n,t){var i=!1;n.forEach(function(n){var t,t;n.value===e&&(null==(t=n.source)?void 0:t.Mf)===u&&(l.push(n),i=!0),n.value===r&&(null==(t=n.source)?void 0:t.Mf)===u&&h.push(n)}),i&&c.push(t)}),2===(o=null==(o=u.b3())?void 0:o.rBe(e,r,0<l.length,0<h.length,null==(o=u.parent)?void 0:o.wC)))throw new Error(x().Exp_CustomNameBothInUse);u.suspendCalcService(),(s=u.hyt[d(e)]).btV(r),u.hyt[d(e)]&&(delete u.hyt[d(e)],u.$Dr({type:"setSheetScopeCustomName",name:e,value:O})),u.hyt[d(r)]=s,u.q_r(s),l.forEach(function(n){n.value=r}),c.forEach(function(n){u.q_r(n)}),u.b3().updateNameCalc(r,!0),a?(v=u.hyt[d(r)],u.removeCustomName(r),u.zwt(r,n,t,i,!1,f,s.isReadOnly(),v)):(s.X_r(f),u.q_r(s)),3!==o||a||((o={})[r]=r,this.Zwt(o,!0)),u.resumeCalcService()}else a?(u.suspendCalcService(),v=u.hyt[d(e)],u.removeCustomName(e),u.zwt(e,n,t,i,!1,f,s.isReadOnly(),v),u.resumeCalcService()):(s.X_r(f),u.q_r(s));u.zw()}},t.q_r=function(n){this.$Dr({type:"setSheetScopeCustomName",name:n.getName(),value:{expr:n.getExpression(),baseRow:n.getRow(),baseCol:n.getColumn(),comment:n.getComment(),isReadOnly:n.isReadOnly()}})},t.getCustomNames=function(){var i=[];return C(this.hyt,function(n,t){i.push(t)}),i},t.removeCustomName=function(n){var t,t,i,e,t;n&&(i=d(n),e=this.hyt[i],null!=(t=null==(t=this.parent)?void 0:t.vBe)&&t.delete(e),delete this.hyt[i],this.$Dr({type:"setSheetScopeCustomName",name:n,value:O}),(t={})[i]=i,this.Zwt(t,!1))},t.clearCustomNames=function(){this.aEr()},t.aEr=function(n){var t,i,e,r,f,o,e=this,r=e.hyt;if(null!=(t=this.parent)&&t.vBe)for(f in r)Object.prototype.hasOwnProperty.call(r,f)&&(o=r[f],null!=(i=this.parent))&&i.vBe.delete(o);e.hyt={},null!=n&&n.ignoreModelChange||this.$Dr({type:"clearCustomName"}),this.Zwt(r,!1)},t.createNameInfo=function(n,t,i,e,r){var f,o,f,o,f=this,o=k(f),f=f.Uw();return o&&f?(o=o.parse(f,t,e,r,y,y,y,y,!0),new v.NameInfo(n,o,e,r,i)):O},t.getNameInfos=function(){return this.hyt},t.setNameInfos=function(n){R(n)||(this.hyt=n)},t.Vwt=function(n){var t,i,t,t=this,i=!t.hyt[d(n)];return i=i&&(t=t.tables)?!t.findByName(n):i},t.isValidCustomName=function(n){return n&&g.mt.P0(n)&&this.Vwt(n)},n.addNameInName=S,t.zwt=function(n,t,i,e,r,f,o,u){var s;if(!n||!t||!r&&!this.isValidCustomName(n))throw new Error(x().Exp_InvalidCustomName);this.$_r(n,t,i,e,{ignoreError:r,comment:f,isReadOnly:o,backup:u})},t.$_r=function(n,t,i,e,r){var f,o,u,s,a,c,l,r,h,o,u,f=this,o=k(f),u=f.Uw();if(o&&u){if(s=r.ignoreError,a=r.comment,c=r.isReadOnly,l=r.backup,r=r.ignoreModelChange,h=void 0,s)try{h=o.parse(u,t,i,e,!1,!0,!0,y,!0)}catch(n){}else h=o.parse(u,t,i,e,y,y,y,y,!0);o=void 0,l?(o=l).SB(h,y,i,e,{ignoreModelChange:!0}):o=new v.NameInfo(n,h,i,e,a,c,f),f.hyt[d(n)]=o,r||f.$Dr({type:"setSheetScopeCustomName",name:n,value:{formula:t,comment:a,isReadOnly:c,baseRow:i,baseCol:e}}),h&&f.parent&&S(f.parent,h,o),s||((u={})[n]=n,this.Zwt(u,!0))}},t.Wwt=function(n,t,i,e,r,f,o,u){var s,t,a,t,a,s=this;if(!n||!t||!f&&!s.isValidCustomName(n))throw new Error(x().Exp_InvalidCustomName);t=k(s),a=s.Uw(),t&&a&&(t=s.hyt[d(n)]=new v.NameInfo(n,i,e,r,o,y,s),i&&s.parent&&S(s.parent,i,t),f||((a={})[n]=n,this.Zwt(a,!0)))},t.Zwt=function(n,t){var i,e,r,e=this.b3();if(e){for(r in n)e.updateNameCalc(r,t);null!=(i=this.parent)&&i.Zwt(n,t),this.recalcAll(!1)}this.ki(g.Events.CustomNameChangedInternal,{})},t.gMt=function(n){var t,i,t;return n?(i=(t=this).parent,!(t=t.getCustomName(n))&&i&&i.getCustomName?i.getCustomName(n):t):O},t.setFormula=function(n,t,i,e){this.zI(n,t,i,O,!1,e)},t.zI=function(n,t,i,e,r,f,o,u,s,a,c){var l,h,v,d,w,m,C,C,p,m,h,v,u,C,a,_,e,l=this;R(f)&&(f=3),n<0||n>=l.getRowCount(f)||t<0||t>=l.getColumnCount(f)?l.jT(0,x().Exp_IndexOutOfRange):(h=0<=n?n:0,v=0<=t?t:0,d=l.Uw(f),w=l.options.keepUnknownFormulas,(m=l.Lp).forceR1C1Formula&&3===f&&!l.isReportTemplateSheet?(C=m.useR1C1,m.useR1C1=!0,e=e||(i&&m?m.parse(d,i,h,v,!1,r,!1,w):O),m.useR1C1=C):e=e||(i&&m?m.parse(d,i,h,v,!!l.Vur,r,r,w):O),e&&u&&(e.ensureSingle=!0),C=l.tables,3===f&&0<=n&&0<=t&&C&&!(p=C.pMt(n,t,1,1,i,e))||(m=w&&i&&!e,h=l.b3(f),v=l.conditionalFormats,h&&(u=h.getFormula(n,t,y,!0),C=l.Ut,a||d.t8.Fgt(n,t),(a=R(l.Dhe)&&!i&&!R(C.getDefaultValue(n,t,f)))&&(l.Dhe=!(i||l.Q5e&&l.Q5e(n,t))),h.FE=!0,_=l.Dhe&&i===O,h.setFormula(n,t,i,e,r,_,!c&&C.pj(),s,w),a&&delete h.FE,delete l.Dhe,h.usedRange&&N(h.usedRange,n,t,u,i),m&&(e=h.getNode(n,t,!0))&&(e.qbt=i),!v||d&&!0===d.G3||v.dl(),l.hasFormula(n,t,f)&&C.JE(n,t,f),o?l.Lj(l,[{row:n,col:t}],0):l.Rj("formula",n,t,f,u,i)),l.Q1i&&l.Q1i(n,t,1,1,f),l.zw()))},t.eL=function(n,t,i,e,r,f,o,u){var s,a,c,l,h,v,d,s=this,a=this.op();if(n<0||n>=s.getRowCount()||t<0||t>=s.getColumnCount())s.jT(0,x().Exp_IndexOutOfRange);else if(l=s.b3(o))for(h=n;h<i+n;h++)for(v=t;v<e+t;v++)h===n&&v===t&&(s.zI(n,t,r,O,!1,o),c=l.pB(n,t),s.Xbt=s.Xbt||{nextIndex:0},d=s.Xbt.nextIndex,s.Xbt[d]={formula:a.unparse(this.qgt,c,n,t,!1,!0),baseRow:n,baseColumn:t,lastRow:n+i-1,lastColumn:t+e-1},s.Xbt.nextIndex++,c.aMt=d),s.zI(h,v," ",c,!0,o,!0,!0)},t.setArrayFormula=function(n,t,i,e,r,f){this.uMt(n,t,i,e,r,!1,f)},t.uMt=function(n,t,i,e,r,f,o,u){var s,a,c,l,a,h,v,d,w;if(void 0===o&&(o=3),s=this,n<0||n+i>s.getRowCount()||t<0||t+e>s.getColumnCount())s.jT(0,x().Exp_IndexOutOfRange);else if(s.Ut.eE(n,t,i,e))s.jT(0,x().Exp_ArrayFormulaSpan);else if(a=s.tables,!(3===o&&0<=n&&0<=t&&a)||(c=a.pMt(n,t,i,e,r))){if(l=s.b3(o),a=s.conditionalFormats,l){for(h=[],v=n;v<n+i;v++)for(h[v]=[],d=t;d<t+e;d++)h[v][d]=l.getFormula(v,d);for(l.setArrayFormula(n,t,i,e,r,f,s.Ut.pj(),u,!1),v=n;v<n+i;v++)for(d=t;d<t+e;d++)l.usedRange&&N(l.usedRange,v,d,h[v][d],r);if(a&&a.dl(),s.vf<1){for(w=[],v=n;v<n+i;v++)for(d=t;d<t+e;d++)w.push({row:v,col:d});s.SI(n,t,i,e,w,5,o,r)}}s.zw()}},t.getFormula=function(n,t,i,e){var i,r,i=this.b3(i);return!i||(r=i.oT(n,t))&&r.isDefault()?O:i.getFormula(n,t,e)},t.bMt=function(n,t,i){var i=this.b3(i);return i?i.pB(n,t):O},t.getFormulaInformation=function(n,t,i,e){var r,i,f,o,f,u,u,s,a,r={},i=this.b3(i);if(i){if(o=(f=i.oT(n,t))&&f.isDefault())return r;(f=i.pB(n,t))?(u=i.sT(n,t),r.hasFormula=!0,u&&(r.baseRange=new g.Range(u.row,u.col,u.rowCount,u.colCount)),r.isArrayFormula=u&&!u.isDynamicArray,n=u?u.row:n,t=u?u.col:t,e||(r.formula=this.Lp.unparse(this.qgt,f,n,t),r.formulaWithCulture=this.Lp.unparse(this.qgt,f,n,t,!0)),r.hasFormula=!!r.formula):(u=this.Uw().t8.getAnchorInfo(n,t))&&u.isValid&&(s=u.row,a=u.col,r.baseRange=new g.Range(u.row,u.col,u.rowCount,u.colCount),n===s&&t===a||(f=i.pB(s,a),e||(r.formulaWithCulture=this.Lp.unparse(this.qgt,f,s,a,!0)),r.hasFormula=!0,r.isDynamicArray=!0))}return r},t.VI=function(n,t,i,e,r,f){var o,u,s,a,c,l,h,v,d,w,m,C;for(i||(i=this,e=n,r=t,f=[]),o=i.qwt(e,r),u=this.name(),s=0;s<o.length;s++)if(!f[c=(a=o[s]).sheetName+"_"+a.row+"_"+a.col+"_"+a.rowCount+"_"+a.colCount]){if(f[c]=!0,(a.row<=n&&n<a.row+a.rowCount||-1===a.rowCount)&&(a.col<=t&&t<a.col+a.colCount||-1===a.colCount)&&u===a.sheetName)return!0;for(l=a.sheetName===u?i:i.parent.getSheetFromName(a.sheetName),h=a.rowCount,v=a.row,d=a.colCount,w=a.col,-1===h&&(h=l.getRowCount(),v=0),-1===d&&(d=l.getColumnCount(),w=0),m=v;m<h+v;m++)for(C=w;C<d+w;C++)if(this.VI(n,t,l,v,w,f))return!0}return!1},t.getCrossSheetReferences=function(e){for(var n,r,t,i,f,o,u,s,a,c,l,h,v,d,n=this,r=(0,A.createMap)(),t=n.getRowCount(),i=n.getColumnCount(),f=n.b3(),o=f.rT.id,s=function(n,t){var i,i,i=n.w3.getSource();i&&i.id!==o&&(e?(i=i.getName())&&0<i.length&&r.set(i,!0):r.set(t,n))},a=0;a<t;a++)for(c=0;c<i;c++)if((l=f.oT(a,c))&&l.aT)for(u=l.aT,h=0;h<u.length;h++)(v=l[u[h]])&&v.forEach(s);if((d=f.uT())&&d.aT)for(u=d.aT,h=0;h<u.length;h++)(v=d[u[h]])&&v.forEach(function(n){n&&n.content.forEach(s)});return r},t.getPrecedents=function(n,t){var i,e,e,r,f,n,f,i=[],e=this.b3();return e&&(e=e.Fyt(n,t)||e.pB(n,t),n=(f=(r=this.getFormulaInformation(n,t,3,!0)).baseRange)?f.row:n,f=f?f.col:t,this.yMt(e,n,f,i),i=fn(i)),i},t.getDependents=function(a,c){var l,n,h,l=[],n=this.parent&&this.parent.sheets||[this],h=this.name();return n.forEach(function(n){for(var t,i,e,r,f,o,u,s,t=n.getRowCount(),i=n.getColumnCount(),e=n.name(),r=0;r<t;r++)for(f=0;f<i;f++)for(o=n.getPrecedents(r,f),u=0;u<o.length;u++)if((s=o[u]).sheetName===h&&(-1===s.row||s.row<=a&&a+1<=s.row+s.rowCount)&&(-1===s.col||s.col<=c&&c+1<=s.col+s.colCount)){l.push({row:r,col:f,rowCount:1,colCount:1,sheetName:e});break}}),l},s={},t.qwt=function(n,t){var i,e,r,e,e,f,o,u,i={},e=this.b3().oT(n,t),r=this.b3().uT();if(e&&(e=e[0])&&e.forEach(dn(i,this)),r&&r[0])for(e=r["0c"],s.minX=t,s.minY=n,s.maxX=t,s.maxY=n,f=e.search(s),o=0;o<f.length;o++)(u=f[o].content).forEach(dn(i,this));return wn(i)},t.yMt=function(n,t,i,e){var r,f,f,o,u,s;if(n)switch(r=n.type){case A.ExpressionType.reference:case A.ExpressionType.structReference:f=n.getRange(t,i),e.push({row:f.row,col:f.col,rowCount:f.rowCount,colCount:f.colCount,sheetName:(n.source&&n.source.Mf?n.source.Mf:this).name()});break;case A.ExpressionType.operator:this.yMt(n.value,t,i,e),this.yMt(n.value2,t,i,e);break;case A.ExpressionType.expand:case A.ExpressionType.parentheses:this.yMt(n.value,t,i,e);break;case A.ExpressionType.name:f=this.gMt(n.value),this.yMt(f.getExpression(),t,i,e);break;case A.ExpressionType.function:for(o=n.arguments,u=0;u<o.length;u++)s=o[u],this.yMt(s,t,i,e)}},t.hasFormula=function(n,t,i,e){var i=this.b3(i);return!!i&&i.hasFormula(n,t,e)},t.wMt=function(){var n=this.b3();n&&n.MMt(function(n){n.CMt(),n.yB()})},t.clearFormula=function(n,t,i,e,r){var f,o,u,f=this;for(n<0&&(n=0,i=f.getRowCount()),t<0&&(t=0,e=f.getColumnCount()),o=0;o<i;o++)if(r(f,o+n))for(u=0;u<e;u++)f.setFormula(o+n,u+t,O)},t.nameFunctionsFromJSON=function(n,t,i,e){var r,f,o,u,s,s,a,c,l;if(n){if(r=this,f=n.customFunctions)for(o in f)f.hasOwnProperty(o)&&(u=f[o],s=(0,g.getTypeFromString)(u.typeName))&&((s=new s).fromJSON(u,t),r.Uwt(s));if((a=n.names)&&0<a.length){for(c=0;c<a.length;c++)l=a[c],r.zwt(h(l.name),l.formula,l.row,l.col,!0,l.comment,l.isReadOnly);r.wMt()}e&&e()}},t.formulaFromJSON=function(n,t,r){var f,o,u;n&&((f=this).Xbt=n.sharedFormulas,o=r&&r.ignoreFormula,u=r&&r.incrementalLoading,[n.colHeaderData,n.rowHeaderData,n.data].forEach(function(n,t){var t,n,i,e;n&&!o&&n.dataTable&&(n=n.dataTable,i=f.getRowCount(t=t+1),e=f.getColumnCount(t),u?I(f,n,i,e,r,0,t):c(f,n,i,e,t))}),n.defaultData&&sn(f,n.defaultData),u?r.incrementLoadTask.pushTask(cn,[f,n,t,r]):cn(f,n,t,r))},t.formulaFromSJSFormat=function(n,t,i,e){var r,f,o,u,s,a,f,c,l;n&&(f=(r=this).Uw(),o=!i||!1!==i.includeFormulas,u=g.Util.Mo(i),s=g.Util.wo(i,r.parent&&r.parent.v2),a=r.b3(3),f.G3=!0,o&&n.lossless&&n.lossless.tree&&i.$wt&&f.setReferenceSheetNames(n.lossless.referenceSheetNames),(f=J(n,g.XFileConstants.bo))?(c=f.rowCount,l=f.colCount,e?(o&&E(r,f,c,l,n.lossless,i,0,e),D(n,r,a,t,i,o,u,e)):(o&&i.incrementLoadTask.addTask(E,[r,f,c,l,n.lossless,i,0],_.I5(x().STEP.loadSheetFormula,[r.name()]),function(){var n=i.loadStatus.formulaLoad/i.loadStatus.total;return i.fullRecalc?s?.5:n*g.STEP_RATE.loadSheetFormulaWithCalc+g.STEP_RATE.loadSheetDataWithCalc+g.STEP_RATE.parseFile+g.STEP_RATE.loadFileData:s?.6:n*g.STEP_RATE.loadSheetFormula+g.STEP_RATE.loadSheetData+g.STEP_RATE.parseFile+g.STEP_RATE.loadFileData},r.name()),i.incrementLoadTask.addTask(D,[n,r,a,t,i,o,u]))):e?D(n,r,a,t,i,o,u,e):i.incrementLoadTask.addTask(D,[n,r,a,t,i,o,u]))},t.nameFunctionFromSJSFormat=function(n,t,i){var r,f,e,o,u,s,s,a,c;if(n){if(f=(r=this)?r.Uw():O,e=n.lossless&&n.lossless.customFunctions)for(o in e)e.hasOwnProperty(o)&&(u=e[o],s=(0,g.getTypeFromString)(u.typeName))&&((s=new s).fromJSON(u),r.Uwt(s));a=n.lossless&&n.lossless.definedNames,c=n.lossless&&n.lossless.nExpr,a&&0<a.length&&(a.forEach(function(n){var t=""+n.c_[0],i=m(n.name),e=m(n.comment);"_xlnm.Print_Titles"===i?yn(r,t):c&&c[n.e]?r.Wwt(h(i),p(m(t)),(0,w.exprFromJSON)(c[n.e],f.getParserContext(!1)),0,0,!0,e,"_xlnm.Print_Area"!==i):r.zwt(h(i),p(m(t)),0,0,!0,e,n.isReadOnly)}),r.wMt())}},t.SMt=function(n){var t=this,i=t.Lp;i&&!n||(t.Lp=n||new A.CalcService,t.Uw(g.SheetArea.colHeader).setCalcService(t.Lp),t.Uw(g.SheetArea.rowHeader).setCalcService(t.Lp),t.Uw(g.SheetArea.viewport).setCalcService(t.Lp),t.Lp.initParserContext(t.Uw()),i?(n.setSourceModel(t.T3,i.getSourceModel(t.T3)),n.setSourceModel(t.A3,i.getSourceModel(t.A3)),n.setSourceModel(t.qgt,i.getSourceModel(t.qgt))):(t.iMt=t.Lp.getSourceModel(t.T3),t.rMt=t.Lp.getSourceModel(t.A3),t.oMt=t.Lp.getSourceModel(t.qgt)),t.oMt.usedRange=new g.BaseUsedRange)},t.setCalc=function(n,t){this.Lp=n,this.qgt=t||this.qgt,this.oMt=n.getSourceModel(this.qgt),this.parent&&(this.parent.Lp=n)},t.YA=function(){this.ol(!1,1)},t.TMt=function(n,t){var i,e,r,f,o,u,s,a,c,l,h,v,d,w,m,C,p,_,i=this,e=n.changeType,r=n.row,f=n.rowCount,o=n.col,u=n.colCount,s=n.sheetArea,a=R(s)||s===g.SheetArea.viewport,c=i.b3(s),l=c.usedRange;c&&(v=(h=i.Ut).pj(),d=k(c),w=c.rT,m=d.Hyt(),C=d.MX.asyncManager,"addingRows"===e?i.mT(r,0,0,i.getColumnCount(),void 0,!0,!1)?n.onlyCheck||(p=a?i.b3(2):y,m.onBeforeAddRemoveRows(c,r,p),T(i,r,f,!0,!0),[c,p].forEach(function(n){n&&n.addRows(r,f)}),C.addRows(w,r,f)):n.canAdd=!1:"addRows"===e?(d.suspend(),p=a?i.b3(2):y,m.onAfterAddRemoveRows(c,r,f,!0,{isUndo:t,rhCalcModel:p}),d.resume(!1),v&&v.push({type:"addRows",row:r,rowCount:f,sheetArea:s}),l&&l.addHeadInfo(r,f,!0)):"deletingRows"===e?i.mT(r,0,f,i.getColumnCount(),void 0,!0,!1)?n.onlyCheck||(p=a?i.b3(2):y,d.DFe=v,m.onBeforeAddRemoveRows(c,r,p,!t,f),T(i,r,f,!1,!0),[c,p].forEach(function(n){n&&n.deleteRows(r,f,t)}),C.deleteRows(w,r,f)):n.canDelete=!1:"deleteRows"===e?(d.suspend(),p=a?i.b3(2):y,m.onAfterAddRemoveRows(c,r,f,!1,{isUndo:t,rhCalcModel:p}),d.resume(!1),v&&v.push({type:"deleteRows",row:r,rowCount:f,sheetArea:s}),delete d.DFe,l&&l.removeHeadInfo(r,f,!0)):"setRowCount"===e&&f!==r?(d.suspend(),p=i.b3(2),r<f?(c.gF(r+1,0,f-r,i.getColumnCount()),p.gF(r+1,0,f-r,i.getColumnCount()),c.rT.t8.Fgt(r+1,-1,f-r,-1)):(c.gF(f+1,0,r-f,i.getColumnCount()),p.gF(f+1,0,r-f,i.getColumnCount()),c.uge(f,r),p.uge(f,r)),d.AMt(2),d.resume(!1)):"setColumnCount"===e&&u!==o?(d.suspend(),_=i.b3(1),o<u?(c.gF(0,o+1,i.getRowCount(),u-o),_.gF(0,o+1,i.getRowCount(),u-o),c.rT.t8.Fgt(-1,o+1,-1,u-o)):(c.gF(0,u+1,i.getRowCount(),o-u),_.gF(0,u+1,i.getRowCount(),o-u),c.sge(u,o),_.sge(u,o)),d.AMt(3),d.resume(!1)):"addingColumns"===e?i.mT(0,o,i.getRowCount(),0,void 0,!1,!0)?n.onlyCheck||(_=a?i.b3(1):y,m.onBeforeAddRemoveColumns(c,o,_),T(i,o,u,!0,!1),[c,_].forEach(function(n){n&&n.addColumns(o,u)}),C.addColumns(w,r,f)):n.canAdd=!1:"addColumns"===e?(d.suspend(),_=a?i.b3(1):y,m.onAfterAddRemoveColumns(c,o,u,!0,{isUndo:t,chCalcModel:_}),d.resume(!1),v&&v.push({type:"addColumns",col:o,colCount:u}),l&&l.addHeadInfo(o,u,!1)):"deletingColumns"===e?i.mT(0,o,i.getRowCount(),u,void 0,!1,!0)?n.onlyCheck||(_=a?i.b3(1):y,d.DFe=v,m.onBeforeAddRemoveColumns(c,o,_,!t,u),T(i,o,u,!1,!1),[c,_].forEach(function(n){n&&n.deleteColumns(o,u,t)}),C.deleteColumns(w,r,f)):n.canDelete=!1:"deleteColumns"===e&&(d.suspend(),_=a?i.b3(1):y,m.onAfterAddRemoveColumns(c,o,u,!1,{isUndo:t,chCalcModel:_}),d.resume(!1),v&&v.push({type:"deleteColumns",col:o,colCount:u,sheetArea:s}),delete d.DFe,l)&&l.removeHeadInfo(o,u,!1))},t.IMt=function(n,t,i,e){var r,f,o,u,s,a,r=i.type,f=this;if(e){if("addRows"===r)i.changeType="addingRows",f.TMt(i),i.changeType="addRows",f.TMt(i);else if("deleteRows"===r)i.changeType="deletingRows",f.TMt(i),i.changeType="deleteRows",f.TMt(i);else if("addColumns"===r)i.changeType="addingColumns",f.TMt(i),i.changeType="addColumns",f.TMt(i);else if("deleteColumns"===r)i.changeType="deletingColumns",f.TMt(i),i.changeType="deleteColumns",f.TMt(i);else if("customName"===r)o=n.parse(f,i.newFormula,0,0),u=i.nameInfo.getExpression(),i.nameInfo.SB(o),l(f,i,u);else if("condition"===r){for(s=[],a=0;a<i.newFormulas.length;a++)o=n.parse(f,i.newFormulas[a],0,0),s.push(o);i.condition.setExpressions(s)}}else if("addRows"===r)i.changeType="deletingRows",f.TMt(i,!0),i.changeType="deleteRows",f.TMt(i,!0);else if("deleteRows"===r)i.changeType="addingRows",f.TMt(i,!0),i.changeType="addRows",f.TMt(i,!0);else if("addColumns"===r)i.changeType="deletingColumns",f.TMt(i,!0),i.changeType="deleteColumns",f.TMt(i,!0);else if("deleteColumns"===r)i.changeType="addingColumns",f.TMt(i,!0),i.changeType="addColumns",f.TMt(i,!0);else if("customName"===r)o=n.parse(f,i.formula,0,0),u=i.nameInfo.getExpression(),i.nameInfo.SB(o),l(f,i,u);else if("condition"===r){for(s=[],a=0;a<i.formulas.length;a++)o=n.parse(f,i.formulas[a],0,0),s.push(o);i.condition.setExpressions(s)}},t.xMt=function(n,t,i){var e,r,f,e=i.type,r=this;"addRows"===e?(i.changeType="deletingRows",r.TMt(i,!0),i.changeType="deleteRows",r.TMt(i,!0)):"deleteRows"===e?(i.changeType="addingRows",r.TMt(i,!0),i.changeType="addRows",r.TMt(i,!0)):"addColumns"===e?(i.changeType="deletingColumns",r.TMt(i,!0),i.changeType="deleteColumns",r.TMt(i,!0)):"deleteColumns"===e?(i.changeType="addingColumns",r.TMt(i,!0),i.changeType="addColumns",r.TMt(i,!0)):"customName"===e?(f=i.nameInfo.getExpression(),i.nameInfo.SB(i.expr),l(r,i,f)):"condition"===e&&i.condition.setExpressions(i.expressions)},t.NMt=function(n,t){var i,e,r,f,o,i=this,e=k(i),r=i.b3();if(e.suspend(),t)for(f=0;f<n.length;f++)(o=n[f]).type?i.IMt(e,r,o,t):o.newValue&&i.setFormula(o[0],o[1],o.formula);else for(f=n.length-1;0<=f;f--)(o=n[f]).type?i.IMt(e,r,o,t):o.newValue||i.setFormula(o[0],o[1],o.formula);e.resume(!1)},t.xj=function(n){var t,t,i,e,r,f,o,u,s,a,c,l,h,v,d,w,m,C,t=n[n.length-1],t=t&&t.sheetArea,i=R(t)||t===g.SheetArea.viewport,e=k(this),r=this.b3(t),f=this.Uw(t);for(e.suspend();n.length;)if((o=n.pop()).type)this.xMt(e,r,o);else{if(u=o[0],s=o[1],a=o[2],c=o[3],l=o[4],h=u.pB(s,a),d=[],v=i&&f.t8.getAnchorInfo(s,a)){for(w=v.row;w<v.row+v.rowCount;w++)for(d[w]=[],m=v.col;m<v.col+v.colCount;m++)d[w][m]=this.getValue(w,m);!v.isValid||c||l||f.t8.Fme(f.t8.Hme(s,a),!0,!1,!0)}if(u.kMt.apply(u,o),(C=i&&u&&u.usedRange)&&(N(C,s,a,h,c),v))for(w=v.row;w<v.row+v.rowCount;w++)for(m=v.col;m<v.col+v.colCount;m++)w===s&&m===a||N(C,w,m,d[w][m],c)}n&&n.Wme&&f.t8.Kme(n.Wme),e.resume(!1)},t.getReferenceRange=function(n){var t,i,e,r,f,o,n,u,t=this.Uw(),i=this.getCalcService(),e=i.parse(t,n,0,0,void 0,!0),o=e.baseTable;return e&&o&&n===o.name()?(r=o.range(),f=o.Mf&&o.Mf.name()):(n=i.MX.evaluateExpression(e,t.getEvaluatorContext({row:0,col:0},!1),!1,!0,!0))instanceof A.CalcReference&&(f=n.getSource().getName(),0<n.getRangeCount())&&(r=(0,g.Ec)(n.getRow(u=0),n.getColumn(0),n.getRowCount(0),n.getColumnCount(0))),{sheetName:f,range:r}},t.$Ae=function(n){var t,i,n,e,r,f,t=this.Uw(),i=this.getCalcService(),n=i.parse(t,n,0,0,void 0,!0),e=[],r=[],f={};return pn(n,t,i,e),e.forEach(function(n){var t=n.sheetName,n=n.range;f[t]||(f[t]={sheetName:t,ranges:[]},r.push(f[t])),f[t].ranges.push(n)}),r},t.dL=function(n,t,i,e){var r,f,f,r=this,f="string"==typeof e&&r.parent&&r.parent.xO(e);return f&&-1!==n&&-1!==t?(f=f.getExpression(),q(r,e)?z(r,f,n,t):(0,v.evaluateExpression)(r,f,n,t,{sheetArea:i})):y},t.TL=function(n,t,i){var e,r,f,e=this,r=e.parent;r.xO(i)||(f=Cn(e,i,n=-1===n?0:n,t=-1===t?0:t),r.pp(r.bp,i,f,n,t,!0,"",e.NMi))},t.NO=function(n,t,i,e){var r=this;return(q(r,n)?z:(0,v.evaluateExpression))(r,t,i,e)},n.convertFormatStringFormula=Cn,n.hMt=T,n.adjustOneFormula=Y,n.XB=gn,n.QB=L,g.Worksheet.ch("calc",{priority:1e3,init:tn,dispose:function(n){var n,n,t,i,t,t,t,t,i=this;!1!==n.clearCache&&(i.qgt=O,i.A3=O,i.T3=O,i.Lp=O,(t=i.oMt)&&(!0===n.isSheetDestroy?t.DMt():t._Mt(),i.oMt=O),(t=i.rMt)&&(!0===n.isSheetDestroy?t.DMt():t._Mt(),i.rMt=O),(t=i.iMt)&&(!0===n.isSheetDestroy?t.DMt():t._Mt(),i.iMt=O),t=null==(n=i.parent)?void 0:n.Lp)&&null!=(t=null==(n=t.MX)?void 0:n.asyncManager)&&t.clearNodesByName(i.name())},attach:function(n){var t=this;n instanceof g.Workbook?t.SMt(n.Lp):t.SMt()},onLayoutChanged:function(n){this.op().isAdjustSuspended()||this.TMt(n)},toJson:function(n,i){var s,t,e,a,t,c,r,f,o,u,s=this,t=s.Amt;g.GC$.isEmptyObject(t)||(n.customFunctions=t),e=i&&i.newWorkSheetName,a=[],t=s.getCustomNames(),c=k(s),r=s.b3(),f=r.rT,t&&c&&(!R(e)&&r&&f&&(f.Wbt=e),C(t,function(n,t){var i,e,r,f,o,t,u,i,i=t.getName(),e=t.getRow(),r=t.getColumn(),f=t.getExpression(),o=t.isReadOnly(),t=t.getComment();f&&(i={name:i,formula:u=c.unparse(s.Uw(),f,e,r,!1,!0,1),row:e,col:r},t&&(i.comment=t),"boolean"==typeof o&&(i.isReadOnly=o),a.push(i))}),0<a.length&&(n.names=a),delete f.Wbt),(o=i&&i.ignoreFormula)||(u=[s.oMt,s.iMt,s.rMt],[n.data,n.colHeaderData,n.rowHeaderData].forEach(function(n,t){xn(u,t,n,f,e,i)}),s.Xbt&&0<s.Xbt.nextIndex&&(n.sharedFormulas=s.Xbt))},fromJson:function(n,t,i,e){var r,f,r=this,f;i&&i.incrementalLoading||(r.clearCustomFunctions(),r.clearCustomNames()),e&&(r.nameFunctionsFromJSON(n,t,i),r.formulaFromJSON(n,t,i))},wh:function(n,t,o){var u,i,e,s,a,i,c,r,f,l,h,v,h,r,d,u=this,i=u.Amt;g.GC$.isEmptyObject(i)||(n.lossless.customFunctions=i),e=o&&o.newWorkSheetName,s=[],a=[],i=u.getCustomNames(),c=k(u),r=u.b3(),f=r.rT,l={},u.parent&&(h=u.parent.yC,l=h&&h.getUsedCustomNames()||{}),i&&c&&!u.NMi&&(!R(e)&&r&&f&&(f.Wbt=e),v=!o||!1!==o.includeUnusedNames,C(i,function(n,t){var i,e,r,t,f,i,t,i=t.getName(),e=t.getExpression(),r=t.isReadOnly(),t=t.getComment();i.toUpperCase()!==X&&e&&(v||l[i])&&(i={name:i,comment:t,isReadOnly:r,formula:f=c.unparse(u.Uw(),e,0,0,!1,!0,1)},o&&o.includeCalcModelCache&&!u.Tir&&(t=(0,w.exprToJSON)(e),s.push(t),i.e=s.length-1),a.push(i))}),0<a.length&&(n.lossless.definedNames=a),0<s.length&&(n.lossless.nExpr=s),delete f.Wbt),(h=o&&!1===o.includeFormulas)||((r=u.oMt)&&(f=r.rT,R(e)||(f.Wbt=e),r.wh(n,o),delete f.Wbt),d=[u.iMt,u.rMt],n.lossless&&[n.lossless.colHeaderData,n.lossless.rowHeaderData].forEach(function(n,t){xn(d,t,n,f,e)})),!h&&g.Util.ko(o)&&(o&&o.includeCalcModelCache&&!u.Tir&&(n.lossless.tree=(0,w.mbt)(u.b3())),f=u.Uw(),n.lossless.referenceSheetNames=f&&f.getReferenceSheetNames(),en(u,n.lossless))},yh:function(n,t,i,e){var r,f,o,u,s,a,c,r=this,f=r.parent,u=g.Util.wo(i,r.parent&&r.parent.v2),s=i&&!i.fullRecalc,a=r.Uw();r.suspendPaint(),f&&f.Lp&&((o=f.Lp).suspend(),o.lb=s),(c=g.Util.Mo(i))||(r.clearCustomFunctions(),r.clearCustomNames()),u&&(a.G3=!0,r.nameFunctionFromSJSFormat(n,t,i),r.formulaFromSJSFormat(n,t,i,e),e?hn(f,r,n,a,t,i):i.incrementLoadTask.addTask(hn,[f,r,n,a,t,i])),e?Rn(o,i,a,u,s,r):i.incrementLoadTask.addTask(function(n,t,i,e,r,f){Rn(n,t,i,e,r,f)},[o,i,a,u,s,r])},setName:function(n){var t,i,e;_n(this),(e=(i=k(t=this.b3())).MX.asyncManager).changeSourceName(n.oldName,n.newName)},beforeSetName:function(){this.b8&&(this.parent||this).xyt()},canAddingSpan:function(n){var t,i,e,r,f,o,t=this,i=n.sheetArea,e=n.row,r=n.col,f=n.rowCount,o=n.colCount;3!==i&&!R(i)||t.mT(e,r,f,o,!1)||(n.isAllow=!1)}}),g.Y8.ch("calc",{isInvalidFormula:function(t){var n,i,n=O,i=y;try{t.allowDynamicArray&&(R(v.SheetParserContext.wbt)&&(v.SheetParserContext.wbt=new g.Worksheet),(n=v.SheetParserContext.wbt).getCalcService())&&(i=n.getCalcService().allowDynamicArray,n.getCalcService().allowDynamicArray=!0),(0,v.formulaToExpression)(n,t.value)}catch(n){t.isInvalid=!0}finally{R(n)||R(i)||!n.getCalcService()||n.getCalcService().allowDynamicArray===i||(n.getCalcService().allowDynamicArray=i)}}})},Common:function(n){n.exports=GC.Spread},CalcEngine:function(n){n.exports=GC.Spread.CalcEngine},Core:function(n){n.exports=GC.Spread.Sheets}},e={},n=r("./dist/plugins/sheetsCalc/sheetsCalc.entry.js"),(((GC=void 0===GC?{}:GC).Spread=GC.Spread||{}).Sheets=GC.Spread.Sheets||{}).CalcEngine=n}();