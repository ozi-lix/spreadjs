const{ipcMain,app,BrowserWindow,Menu,globalShortcut}=require('electron'),path=require('path'),res=require('./appResource'),fontList=require('./fontList/index');let mainWindow,flashWindow,isSaving=!1;function createWindow(){function a(){if(app.mainWindow=mainWindow=new BrowserWindow({show:!1,webPreferences:{preload:path.join(__dirname,'app.min.js')}}),mainWindow.loadURL(`file://${__dirname}/web/content/index.html`),mainWindow.on('focus',()=>{globalShortcut.register('CommandOrControl+S',()=>{isSaving||mainWindow.webContents.send('save')})}),mainWindow.on('blur',()=>{globalShortcut.unregister('CommandOrControl+S')}),ipcMain.on('isSaving',(b,c)=>{isSaving=c}),'darwin'===process.platform){const b=Menu.buildFromTemplate([{label:app.name,submenu:[{role:'about',label:res.menu.about},{type:'separator'},{role:'quit',label:res.menu.quit}]},{label:res.menu.edit,submenu:[{role:'undo',label:res.menu.undo},{role:'redo',label:res.menu.redo},{type:'separator'},{role:'cut',label:res.menu.cut},{role:'copy',label:res.menu.copy},{role:'paste',label:res.menu.paste},{role:'selectall',label:res.menu.selectAll}]}]);Menu.setApplicationMenu(b)}else Menu.setApplicationMenu(null);/*@@info*/mainWindow.webContents.openDevTools();mainWindow.webContents.on('context-menu',(b,c)=>{if(b.preventDefault(),c.isEditable){var d=c.editFlags;const e=Menu.buildFromTemplate([{role:'undo',label:res.menu.undo,enabled:d.canUndo},{role:'redo',label:res.menu.redo,enabled:d.canRedo},{type:'separator'},{role:'cut',label:res.menu.cut,enabled:d.canCut},{role:'copy',label:res.menu.copy,enabled:d.canCopy},{role:'paste',label:res.menu.paste,enabled:d.canPaste},{role:'selectall',label:res.menu.selectAll,enabled:d.canSelectAll}]);e.popup(mainWindow)}}),mainWindow.on('closed',function(){mainWindow=null}),mainWindow.on('close',function(b){b.preventDefault(),b.sender.send('closing')})}flashWindow=new BrowserWindow({width:425,height:227,frame:!1,show:!1,thickFrame:!1,resizable:!1}),flashWindow.loadURL(`file://${__dirname}/start.html`),flashWindow.once('ready-to-show',()=>{flashWindow.show()}),flashWindow.on('closed',()=>{flashWindow=null}),function(){fontList.getFonts().then((b)=>{app.systemFonts=b,a()}).catch(()=>{a()})}()}app.on('ready',createWindow),app.on('window-all-closed',function(){'darwin'!==process.platform&&app.quit()}),app.on('activate',function(){null===mainWindow&&createWindow()}),ipcMain.on('ready',(a)=>{function b(){mainWindow&&(mainWindow.maximize(),mainWindow.show(),flashWindow&&flashWindow.close(),a.sender.send('shown'))}flashWindow?setTimeout(b,3e3):b()});
